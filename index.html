<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Den of Shadow üíÄ V10.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Nosifer&display=swap');
        
        * { touch-action: none; user-select: none; box-sizing: border-box; outline: none; }
        body { margin: 0; background: #000; color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; }
        canvas { display: block; width: 100vw; height: 100vh; image-rendering: auto; }

        /* Estiliza√ß√£o das Telas */
        .ui-screen { position: absolute; inset: 0; background: radial-gradient(circle at center, #200000 0%, #000 100%); z-index: 4000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; backdrop-filter: blur(10px); }
        
        .glass-panel { background: rgba(0,0,0,0.8); border: 1px solid #f00; padding: 40px; border-radius: 20px; box-shadow: 0 0 50px rgba(255,0,0,0.15); max-width: 500px; width: 90%; }

        .btn-main { padding: 15px 30px; font-size: 14px; background: transparent; border: 1px solid #800; color: #fff; cursor: pointer; font-family: 'Orbitron'; margin: 10px; width: 100%; letter-spacing: 2px; transition: all 0.3s; position: relative; overflow: hidden; }
        .btn-main:hover { background: #800; box-shadow: 0 0 20px #f00; transform: scale(1.02); }

        /* Configura√ß√µes */
        .config-group { margin: 20px 0; text-align: left; }
        .config-group label { font-size: 11px; color: #f00; text-transform: uppercase; margin-bottom: 8px; display: block; }
        select, input[type="range"] { width: 100%; background: #111; color: #fff; border: 1px solid #444; padding: 12px; border-radius: 5px; appearance: none; }

        /* HUD */
        #hud { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; display: none; width: 90%; max-width: 600px; pointer-events: none; }
        .hud-stats { display: flex; justify-content: space-between; background: rgba(0,0,0,0.8); padding: 15px; border-top: 2px solid #f00; border-radius: 0 0 10px 10px; }
        .bar-container { width: 140px; height: 6px; background: #222; margin-top: 5px; position: relative; }
        .bar-fill { height: 100%; width: 100%; background: #f00; transition: width 0.3s; box-shadow: 0 0 10px #f00; }
        
        #crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 4px; height: 4px; background: #fff; border-radius: 50%; box-shadow: 0 0 15px #f00; z-index: 1500; display: none; }

        #pause-btn { position: absolute; top: 30px; left: 30px; width: 45px; height: 45px; background: rgba(0,0,0,0.6); border: 1px solid #f00; border-radius: 50%; z-index: 3500; display: none; align-items: center; justify-content: center; font-size: 18px; }
    </style>
</head>
<body>

<div id="start-screen" class="ui-screen">
    <div class="glass-panel">
        <h1 style="font-family:'Nosifer'; color:#f00; margin-bottom:40px; font-size: 3rem;">V10.0</h1>
        <button class="btn-main" onclick="startGame()" id="txt-start">INICIAR</button>
        <button class="btn-main" onclick="showConfig(true)" id="txt-config">CONFIGURA√á√ïES</button>
    </div>
</div>

<div id="config-screen" class="ui-screen" style="display:none;">
    <div class="glass-panel">
        <h2 id="txt-config-title">AJUSTES</h2>
        
        <div class="config-group">
            <label id="txt-lang-label">Idioma</label>
            <select id="lang-select" onchange="changeLang(this.value)">
                <option value="pt">Portugu√™s</option>
                <option value="en">English</option>
                <option value="es">Espa√±ol</option>
                <option value="fr">Fran√ßais</option>
                <option value="de">Deutsch</option>
                <option value="jp">Êó•Êú¨Ë™û</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            </select>
        </div>

        <div class="config-group">
            <label id="txt-res-label">Resolu√ß√£o / Qualidade</label>
            <select id="res-select" onchange="G.res = parseFloat(this.value)">
                <option value="4">Baixa (Performance)</option>
                <option value="2">M√©dia</option>
                <option value="1" selected>Alta (Nativa)</option>
                <option value="0.5">Ultra (Super Sample)</option>
            </select>
        </div>

        <div class="config-group">
            <label id="txt-sens-label">Sensibilidade</label>
            <input type="range" min="0.5" max="4" step="0.1" value="1" oninput="updateSens(this.value)">
        </div>

        <button class="btn-main" onclick="showConfig(false)" id="txt-back">VOLTAR</button>
    </div>
</div>

<div id="pause-screen" class="ui-screen" style="display:none;">
    <div class="glass-panel">
        <h2 style="font-family:'Nosifer'; color:#f00;">PAUSA</h2>
        <button class="btn-main" onclick="togglePause()" id="txt-resume">CONTINUAR</button>
        <button class="btn-main" onclick="showConfig(true)" id="txt-config-pause">AJUSTES</button>
        <button class="btn-main" onclick="location.reload()" id="txt-exit">SAIR</button>
    </div>
</div>

<div id="pause-btn" onclick="togglePause()">‚öôÔ∏è</div>
<div id="crosshair"></div>

<div id="hud">
    <div class="hud-stats">
        <div>
            <div id="txt-hp-label" style="font-size:9px; color:#666;">HP</div>
            <div class="bar-container"><div id="hp-fill" class="bar-fill"></div></div>
        </div>
        <div>
            <div id="txt-room-label" style="font-size:9px; color:#666;">ROOM</div>
            <div id="room-txt" style="color:#fff; font-size: 18px;">0</div>
        </div>
        <div>
            <div id="txt-alma-label" style="font-size:9px; color:#666;">SOUL</div>
            <div class="bar-container"><div id="ammo-fill" class="bar-fill" style="background:#ff0; box-shadow: 0 0 10px #ff0;"></div></div>
        </div>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const I18N = {
    pt: { start: "INICIAR RITUAL", config: "CONFIGURA√á√ïES", back: "SALVAR E VOLTAR", resume: "CONTINUAR", exit: "ABANDONAR", hp: "VITALIDADE", alma: "ESS√äNCIA", room: "C√ÇMARA", res: "RESOLU√á√ÉO" },
    en: { start: "START RITUAL", config: "SETTINGS", back: "SAVE & BACK", resume: "RESUME", exit: "QUIT", hp: "VITALITY", alma: "ESSENCE", room: "CHAMBER", res: "RESOLUTION" },
    es: { start: "INICIAR", config: "AJUSTES", back: "VOLVER", resume: "CONTINUAR", exit: "SALIR", hp: "VITALIDAD", alma: "ALMA", room: "C√ÅMARA", res: "RESOLUCI√ìN" },
    fr: { start: "COMMENCER", config: "R√âGLAGES", back: "RETOUR", resume: "REPRENDRE", exit: "QUITTER", hp: "VITALIT√â", alma: "√ÇME", room: "CHAMBRE", res: "R√âSOLUTION" },
    de: { start: "STARTEN", config: "EINSTELLUNGEN", back: "ZUR√úCK", resume: "WEITER", exit: "BEENDEN", hp: "VITALIT√ÑT", alma: "SEELE", room: "KAMMER", res: "AUFL√ñSUNG" },
    jp: { start: "ÈñãÂßã", config: "Ë®≠ÂÆö", back: "Êàª„Çã", resume: "ÂÜçÈñã", exit: "ÁµÇ‰∫Ü", hp: "ÁîüÂëΩÂäõ", alma: "È≠Ç", room: "ÈÉ®Â±ã", res: "Ëß£ÂÉèÂ∫¶" },
    ru: { start: "–ù–ê–ß–ê–¢–¨", config: "–ù–ê–°–¢–†–û–ô–ö–ò", back: "–ù–ê–ó–ê–î", resume: "–ü–†–û–î–û–õ–ñ–ò–¢–¨", exit: "–í–´–•–û–î", hp: "–ñ–ò–ó–ù–¨", alma: "–î–£–®–ê", room: "–ö–ê–ú–ï–†–ê", res: "–†–ê–ó–†–ï–®–ï–ù–ò–ï" }
};

let curLang = 'pt';
const G = { play: false, paused: false, room: 0, hp: 100, ammo: 40, res: 1, sens: 0.0025, lastDmg: 0 };
const player = { x: 0, y: 0, angle: 0, pitch: 0, moveDir: { x: 0, y: 0 }, fov: Math.PI / 3 };
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const TILE_SIZE = 64, MAP_SIZE = 24;
let map = [], enemies = [], heals = [], bullets = [];

function changeLang(lang) {
    curLang = lang; const t = I18N[lang];
    document.getElementById('txt-start').innerText = t.start;
    document.getElementById('txt-config').innerText = t.config;
    document.getElementById('txt-config-pause').innerText = t.config;
    document.getElementById('txt-back').innerText = t.back;
    document.getElementById('txt-resume').innerText = t.resume;
    document.getElementById('txt-exit').innerText = t.exit;
    document.getElementById('txt-hp-label').innerText = t.hp;
    document.getElementById('txt-alma-label').innerText = t.alma;
    document.getElementById('txt-room-label').innerText = t.room;
    document.getElementById('txt-res-label').innerText = t.res;
}

function updateSens(val) { G.sens = 0.0025 * val; }
function showConfig(show) { document.getElementById('config-screen').style.display = show ? 'flex' : 'none'; }
function togglePause() { G.paused = !G.paused; document.getElementById('pause-screen').style.display = G.paused ? 'flex' : 'none'; }

function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    document.querySelectorAll('#hud, #crosshair, #pause-btn').forEach(el => el.style.display = 'block');
    if(!('ontouchstart' in window)) canvas.requestPointerLock();
    setupRoom();
    G.play = true;
    requestAnimationFrame(gameLoop);
}

function setupRoom() {
    map = Array(MAP_SIZE * MAP_SIZE).fill(0);
    for(let i=0; i<MAP_SIZE; i++) { map[i] = 1; map[i + (MAP_SIZE*(MAP_SIZE-1))] = 1; map[i * MAP_SIZE] = 1; map[i * MAP_SIZE + (MAP_SIZE-1)] = 1; }
    map[Math.floor(MAP_SIZE/2)] = 2; // Sa√≠da
    player.x = (MAP_SIZE/2) * TILE_SIZE; player.y = (MAP_SIZE - 4) * TILE_SIZE; player.angle = -Math.PI/2;
    spawnEntities();
}

function spawnEntities() {
    enemies = []; heals = [];
    let count = 3 + Math.floor(G.room * 0.5);
    for(let i=0; i<count; i++) {
        enemies.push({ 
            x: (6 + Math.random()*12)*TILE_SIZE, 
            y: (6 + Math.random()*12)*TILE_SIZE, 
            hp: 100, alive: true, rad: 25 
        });
    }
}

// Inputs
const keys = {};
window.onkeydown = e => { if(e.key === 'Escape') togglePause(); keys[e.key.toLowerCase()] = true; };
window.onkeyup = e => delete keys[e.key.toLowerCase()];
document.addEventListener('mousemove', e => {
    if(document.pointerLockElement === canvas && !G.paused) {
        player.angle += e.movementX * G.sens;
        player.pitch = Math.max(-400, Math.min(400, player.pitch - e.movementY * (G.sens*400)));
    }
});

function update() {
    if(!G.play || G.paused) return;

    // Movimento do Player
    let mx = 0, my = 0;
    if(keys['w']) { mx += Math.cos(player.angle); my += Math.sin(player.angle); }
    if(keys['s']) { mx -= Math.cos(player.angle); my -= Math.sin(player.angle); }
    if(keys['a']) { mx += Math.cos(player.angle-Math.PI/2); my += Math.sin(player.angle-Math.PI/2); }
    if(keys['d']) { mx += Math.cos(player.angle+Math.PI/2); my += Math.sin(player.angle+Math.PI/2); }

    let nx = player.x + mx*4.5, ny = player.y + my*4.5;
    if(map[Math.floor(ny/TILE_SIZE)*MAP_SIZE + Math.floor(nx/TILE_SIZE)] === 0) { player.x = nx; player.y = ny; }

    // Intelig√™ncia dos Inimigos (Separa√ß√£o e Colis√£o)
    enemies.forEach((en, i) => {
        if(!en.alive) return;
        let dx = player.x - en.x;
        let dy = player.y - en.y;
        let dist = Math.hypot(dx, dy);

        // Persegui√ß√£o
        if(dist > 30) {
            en.x += (dx/dist) * 1.5;
            en.y += (dy/dist) * 1.5;
        }

        // Colis√£o entre inimigos (Evita amontoamento)
        enemies.forEach((en2, j) => {
            if(i !== j && en2.alive) {
                let edx = en.x - en2.x;
                let edy = en.y - en2.y;
                let edist = Math.hypot(edx, edy);
                if(edist < 50) { // Raio de separa√ß√£o
                    en.x += edx/edist * 1.2;
                    en.y += edy/edist * 1.2;
                }
            }
        });

        // Dano ao Player (com cooldown)
        if(dist < 40 && Date.now() - G.lastDmg > 500) {
            G.hp -= 10;
            G.lastDmg = Date.now();
        }
    });

    if(G.hp <= 0) location.reload();
}

function draw() {
    // Background
    ctx.fillStyle = "#050000"; ctx.fillRect(0,0,canvas.width, canvas.height/2 + player.pitch);
    ctx.fillStyle = "#100000"; ctx.fillRect(0,canvas.height/2 + player.pitch, canvas.width, canvas.height);

    // Raycasting com Resolu√ß√£o Din√¢mica
    const step = G.res; 
    const numRays = Math.ceil(canvas.width / step);

    for(let i=0; i<numRays; i++) {
        let ang = (player.angle - player.fov/2) + (i * (player.fov/numRays));
        let d=0, hit=false, cos=Math.cos(ang), sin=Math.sin(ang);
        
        while(!hit && d < 1200) {
            d += 8;
            let tx=Math.floor((player.x+cos*d)/TILE_SIZE);
            let ty=Math.floor((player.y+sin*d)/TILE_SIZE);
            if(map[ty*MAP_SIZE+tx] > 0) {
                hit = true;
                let h = (TILE_SIZE * canvas.height) / (d * Math.cos(player.angle-ang));
                let color = map[ty*MAP_SIZE+tx] === 2 ? 200 : 130;
                let lum = Math.max(10, color - d/6);
                ctx.fillStyle = `rgb(${lum},0,0)`;
                ctx.fillRect(i*step, (canvas.height-h)/2 + player.pitch, step, h);
            }
        }
    }

    // Sprites Inimigos
    enemies.forEach(en => {
        if(!en.alive) return;
        let ang = Math.atan2(en.y-player.y, en.x-player.x) - player.angle;
        while(ang < -Math.PI) ang += Math.PI*2; while(ang > Math.PI) ang -= Math.PI*2;
        if(Math.abs(ang) < player.fov) {
            let d = Math.hypot(player.x-en.x, player.y-en.y);
            let sx = (0.5 * (ang/(player.fov/2)) + 0.5) * canvas.width;
            let sh = (60 * canvas.height) / d;
            ctx.fillStyle = "#000";
            ctx.shadowBlur = 15; ctx.shadowColor = "#f00";
            ctx.fillRect(sx-sh/2, (canvas.height-sh)/2 + player.pitch, sh, sh);
            ctx.shadowBlur = 0;
        }
    });

    // HUD Update
    document.getElementById('hp-fill').style.width = G.hp + "%";
    document.getElementById('room-txt').innerText = G.room;
}

function gameLoop() {
    if(G.play) { update(); draw(); }
    requestAnimationFrame(gameLoop);
}

window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
window.onresize();
changeLang('pt');
</script>
</body>
</html>
