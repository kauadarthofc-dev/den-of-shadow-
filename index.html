<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Den of Shadow ðŸ’€ Lord of Light</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        * { touch-action: none; user-select: none; box-sizing: border-box; outline: none; }
        body { margin: 0; background: #05050a; color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; }
        canvas { display: block; background: #000; }

        /* HUD LUXUOSA */
        #hud { position: absolute; top: 20px; left: 20px; z-index: 1000; display: none; flex-direction: column; gap: 10px; }
        .stat-container { background: rgba(0,0,0,0.8); padding: 8px; border-left: 4px solid #00eaff; border-radius: 5px; width: 220px; }
        .bar-bg { width: 100%; height: 10px; background: #222; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .bar-fill { height: 100%; transition: width 0.3s; }
        #hp-fill { background: #ff0040; box-shadow: 0 0 10px #ff0040; }
        #ammo-fill { background: #00eaff; box-shadow: 0 0 10px #00eaff; }

        /* Interface de Upgrades */
        .ui-screen { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        #cards-container { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; padding: 20px; }
        .card { 
            width: 180px; height: 260px; background: #1a1a2e; border: 2px solid #f1c40f; 
            border-radius: 10px; padding: 15px; cursor: pointer; text-align: center; transition: 0.2s;
        }
        .card:hover { transform: scale(1.05); background: #252545; }

        /* Controles Mobile */
        #mobile-hud { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 2000; }
        #joy-base { position: absolute; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%; pointer-events: auto; }
        #joy-stick { position: absolute; width: 50px; height: 50px; background: #00eaff; border-radius: 50%; left: 35px; top: 35px; }
        #atk-grid { position: absolute; bottom: 30px; right: 30px; display: grid; grid-template-columns: repeat(3, 70px); gap: 10px; pointer-events: auto; }
        .btn-atk { width: 70px; height: 70px; background: rgba(255,255,255,0.1); border: 2px solid #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 25px; }
    </style>
</head>
<body>

<div id="start-screen" class="ui-screen">
    <h1 style="color: #e74c3c; font-size: 40px;">DEN OF SHADOW</h1>
    <button class="btn-main" id="btn-play" style="padding: 15px 40px; font-size: 20px; background: #2ecc71; color: #fff; border: none; border-radius: 30px; cursor: pointer;">INICIAR</button>
</div>

<div id="upgrade-screen" class="ui-screen" style="display:none;">
    <h2 style="color:#f1c40f;">ESCOLHA SEU DESTINO</h2>
    <div id="cards-container"></div>
</div>

<div id="hud">
    <div class="stat-container"><div style="font-size: 10px;">VIDA</div><div class="bar-bg"><div id="hp-fill" class="bar-fill" style="width: 100%;"></div></div></div>
    <div class="stat-container" style="border-color:#f1c40f;"><div style="font-size: 10px;">MUNIÃ‡ÃƒO</div><div class="bar-bg"><div id="ammo-fill" class="bar-fill" style="width: 100%;"></div></div></div>
    <div style="font-weight: bold;">SALA: <span id="room-txt">0</span></div>
</div>

<canvas id="gameCanvas"></canvas>

<div id="mobile-hud">
    <div id="joy-base"><div id="joy-stick"></div></div>
    <div id="atk-grid">
        <div></div><div class="btn-atk" data-dir="up">â–²</div><div></div>
        <div class="btn-atk" data-dir="left">â—€</div><div class="btn-atk" data-dir="down">â–¼</div><div class="btn-atk" data-dir="right">â–¶</div>
    </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);

// ConfiguraÃ§Ã£o da Sala (Estilo Isaac)
const ROOM = { w: 1200, h: 800, wallSize: 60 };
const G = {
    play: false, room: 0,
    hp: 100, maxHp: 100, ammo: 100, maxAmmo: 100,
    currentWp: { dmg: 20, spd: 15, rate: 12 },
    enemiesDefeated: false
};

let player = { x: ROOM.w/2, y: ROOM.h/2, r: 25, spd: 6, iframe: 0 };
let enemies = [], projectiles = [], doors = [], particles = [];
const keys = new Set();
const mobAtk = { up: false, down: false, left: false, right: false };

function initRoom() {
    enemies = [];
    projectiles = [];
    doors = [];
    G.enemiesDefeated = false;

    // Reposiciona o player dependendo de onde ele veio (simplificado para o centro)
    player.x = ROOM.w/2;
    player.y = ROOM.h/2;

    if (G.room === 0) {
        G.enemiesDefeated = true; // Tutorial comeÃ§a limpo
    } else {
        spawnEnemies();
    }
}

function spawnEnemies() {
    let count = 3 + Math.floor(G.room * 0.5);
    for(let i=0; i<count; i++) {
        enemies.push({
            x: 200 + Math.random() * (ROOM.w - 400),
            y: 200 + Math.random() * (ROOM.h - 400),
            hp: 40 + G.room * 5, r: 30, spd: 2 + Math.random()
        });
    }
}

function spawnDoors() {
    // Portas aparecem em locais aleatÃ³rios nas paredes
    const sides = ['N', 'S', 'L', 'O'];
    const chosenSide = sides[Math.floor(Math.random() * sides.length)];
    
    let d = { side: chosenSide, w: 100, h: 40, x: 0, y: 0 };
    if(chosenSide === 'N') { d.x = ROOM.w/2 - 50; d.y = 0; }
    if(chosenSide === 'S') { d.x = ROOM.w/2 - 50; d.y = ROOM.h - 40; }
    if(chosenSide === 'L') { d.x = ROOM.w - 40; d.y = ROOM.h/2 - 50; d.w = 40; d.h = 100; }
    if(chosenSide === 'O') { d.x = 0; d.y = ROOM.h/2 - 50; d.w = 40; d.h = 100; }
    doors.push(d);
}

function drawTutorial() {
    if (G.room !== 0) return;
    ctx.save();
    ctx.font = "bold 25px Orbitron";
    ctx.fillStyle = "rgba(255,255,255,0.2)";
    ctx.textAlign = "center";
    
    // Desenho no chÃ£o
    ctx.fillText("WASD PARA ANDAR", ROOM.w/2, ROOM.h/2 - 120);
    ctx.fillText("SETAS PARA ATIRAR", ROOM.w/2, ROOM.h/2 + 150);
    ctx.fillText("LIMPE A SALA PARA ABRIR A PORTA", ROOM.w/2, ROOM.h/2 + 200);
    
    // Seta indicando a porta futura
    ctx.beginPath();
    ctx.strokeStyle = "rgba(0, 234, 255, 0.3)";
    ctx.setLineDash([10, 10]);
    ctx.moveTo(ROOM.w/2, ROOM.h/2);
    ctx.lineTo(ROOM.w/2, 100);
    ctx.stroke();
    ctx.restore();
}

function update() {
    if(!G.play) return;

    // Movimento com colisÃ£o de parede
    let mx = 0, my = 0;
    if(keys.has('w')) my = -1; if(keys.has('s')) my = 1;
    if(keys.has('a')) mx = -1; if(keys.has('d')) mx = 1;
    
    player.x = Math.max(ROOM.wallSize, Math.min(ROOM.w - ROOM.wallSize, player.x + mx * player.spd));
    player.y = Math.max(ROOM.wallSize, Math.min(ROOM.h - ROOM.wallSize, player.y + my * player.spd));

    // Tiro (Setas)
    let tx = 0, ty = 0;
    if(keys.has('arrowup')) ty = -1; if(keys.has('arrowdown')) ty = 1;
    if(keys.has('arrowleft')) tx = -1; if(keys.has('arrowright')) tx = 1;
    if(isMobile) { /* LÃ³gica mobile aqui */ }

    if((tx||ty) && G.ammo > 0 && Date.now() % G.currentWp.rate === 0) {
        projectiles.push({
            x: player.x, y: player.y,
            vx: tx * G.currentWp.spd, vy: ty * G.currentWp.spd,
            r: 8
        });
        G.ammo -= 0.5;
    }

    // Inimigos e ColisÃ£o
    enemies.forEach((en, i) => {
        let ang = Math.atan2(player.y - en.y, player.x - en.x);
        en.x += Math.cos(ang) * en.spd;
        en.y += Math.sin(ang) * en.spd;

        if(Math.hypot(player.x - en.x, player.y - en.y) < player.r + en.r && player.iframe <= 0) {
            G.hp -= 10; player.iframe = 60;
        }
    });

    // ProjÃ©teis
    projectiles.forEach((pr, i) => {
        pr.x += pr.vx; pr.y += pr.vy;
        enemies.forEach((en, j) => {
            if(Math.hypot(pr.x - en.x, pr.y - en.y) < en.r) {
                en.hp -= G.currentWp.dmg;
                projectiles.splice(i, 1);
                if(en.hp <= 0) enemies.splice(j, 1);
            }
        });
        // Remove se bater na parede
        if(pr.x < 0 || pr.x > ROOM.w || pr.y < 0 || pr.y > ROOM.h) projectiles.splice(i, 1);
    });

    // Checar se limpou a sala
    if(enemies.length === 0 && !G.enemiesDefeated) {
        G.enemiesDefeated = true;
        spawnDoors();
    }

    // Entrar na Porta
    doors.forEach(d => {
        if(player.x > d.x && player.x < d.x + d.w && player.y > d.y && player.y < d.y + d.h) {
            G.room++;
            initRoom();
        }
    });

    if(player.iframe > 0) player.iframe--;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Centralizar CÃ¢mera na Sala
    ctx.save();
    let scale = Math.min(canvas.width/ROOM.w, canvas.height/ROOM.h) * 0.9;
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.scale(scale, scale);
    ctx.translate(-ROOM.w/2, -ROOM.h/2);

    // Desenhar Quarto (Piso)
    ctx.fillStyle = "#1a1a1a";
    ctx.fillRect(0, 0, ROOM.w, ROOM.h);
    
    // Desenhar Tutorial no ChÃ£o
    drawTutorial();

    // Paredes
    ctx.fillStyle = "#0a0a0a";
    ctx.fillRect(0, 0, ROOM.w, ROOM.wallSize); // Cima
    ctx.fillRect(0, ROOM.h - ROOM.wallSize, ROOM.w, ROOM.wallSize); // Baixo
    ctx.fillRect(0, 0, ROOM.wallSize, ROOM.h); // Esquerda
    ctx.fillRect(ROOM.w - ROOM.wallSize, 0, ROOM.wallSize, ROOM.h); // Direita

    // Portas
    ctx.fillStyle = "#00eaff";
    doors.forEach(d => {
        ctx.shadowBlur = 15; ctx.shadowColor = "#00eaff";
        ctx.fillRect(d.x, d.y, d.w, d.h);
        ctx.shadowBlur = 0;
    });

    // Personagens
    enemies.forEach(en => {
        ctx.fillStyle = "#e74c3c";
        ctx.beginPath(); ctx.arc(en.x, en.y, en.r, 0, Math.PI*2); ctx.fill();
    });

    // Player
    ctx.fillStyle = player.iframe > 0 ? "#ff0" : "#00eaff";
    ctx.beginPath(); ctx.arc(player.x, player.y, player.r, 0, Math.PI*2); ctx.fill();

    // Tiros
    ctx.fillStyle = "#fff";
    projectiles.forEach(pr => {
        ctx.beginPath(); ctx.arc(pr.x, pr.y, pr.r, 0, Math.PI*2); ctx.fill();
    });

    ctx.restore();

    // HUD
    document.getElementById('hp-fill').style.width = G.hp + "%";
    document.getElementById('ammo-fill').style.width = G.ammo + "%";
    document.getElementById('room-txt').innerText = G.room;

    requestAnimationFrame(draw);
}

// BotÃ£o Iniciar
document.getElementById('btn-play').onclick = () => {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('hud').style.display = 'flex';
    if(isMobile) document.getElementById('mobile-hud').style.display = 'block';
    G.play = true;
    initRoom();
};

window.addEventListener('keydown', e => keys.add(e.key.toLowerCase()));
window.addEventListener('keyup', e => keys.delete(e.key.toLowerCase()));
window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
window.onresize();
draw();
</script>
</body>
</html>
