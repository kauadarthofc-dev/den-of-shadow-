<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Meme Defense: Procedural Edition</title>
    <style>
        body {
            background: #000;
            color: #0f0; /* Estilo Hacker/Meme */
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
        }

        #ui { padding: 15px; text-align: center; }
        .stats { font-size: 24px; text-shadow: 2px 2px #005500; }

        #game-container {
            display: flex;
            gap: 10px;
            background: #111;
            padding: 15px;
            border: 3px solid #0f0;
            border-radius: 10px;
        }

        /* Grades */
        .grid { display: grid; grid-template-columns: repeat(3, 80px); gap: 8px; }
        #defense-slots {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: #222;
            padding: 5px;
            border-right: 2px dashed #0f0;
        }

        #battlefield {
            width: 400px;
            height: 270px;
            background: #050505;
            position: relative;
            overflow: hidden;
        }

        .slot {
            width: 80px;
            height: 80px;
            background: #1a1a1a;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Sprites de Memes Pesquisados */
        .sprite {
            width: 70px;
            height: 70px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            image-rendering: pixelated;
            cursor: grab;
        }

        .enemy {
            position: absolute;
            width: 60px;
            height: 60px;
            right: -70px;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .bullet {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fff;
            box-shadow: 0 0 10px #fff;
            border-radius: 50%;
        }

        #buy-btn {
            margin-top: 20px;
            padding: 12px 30px;
            background: #0f0;
            color: #000;
            border: none;
            font-weight: bold;
            cursor: pointer;
            font-size: 18px;
        }
    </style>
</head>
<body>

    <div id="ui">
        <div class="stats">üí∞ DOGE COINS: <span id="money">100</span></div>
        <div id="wave-info">ORDEM PROCEDURAL: N√çVEL <span id="lvl-txt">1</span></div>
    </div>

    <div id="game-container">
        <div class="grid" id="inv">
            <div class="slot m-slot"></div><div class="slot m-slot"></div><div class="slot m-slot"></div>
            <div class="slot m-slot"></div><div class="slot m-slot"></div><div class="slot m-slot"></div>
            <div class="slot m-slot"></div><div class="slot m-slot"></div><div class="slot m-slot"></div>
        </div>

        <div id="defense-slots">
            <div class="slot d-slot" data-row="0"></div>
            <div class="slot d-slot" data-row="1"></div>
            <div class="slot d-slot" data-row="2"></div>
        </div>

        <div id="battlefield"></div>
    </div>

    <button id="buy-btn">COMPRAR MEME (20üí∞)</button>

    <script>
        // Imagens de Memes Reais de Pesquisa Pixel Art
        const MEMES = {
            players: [
                'https://i.imgur.com/8Nf7vS0.png', // Doge Lvl 1
                'https://i.imgur.com/vHq0L9I.png', // Grumpy Cat Lvl 2
                'https://i.imgur.com/uS3XmS5.png'  // Pepe Frog Lvl 3
            ],
            enemies: [
                'https://i.imgur.com/9v8S8v6.png', // Trollface
                'https://i.imgur.com/6E2hS2O.png'  // Forever Alone
            ]
        };

        let coins = 100;
        let gameLevel = 1;
        let enemiesKilled = 0;
        let dragged = null;

        function createMeme(lvl) {
            const div = document.createElement('div');
            div.className = 'sprite';
            div.style.backgroundImage = `url('${MEMES.players[lvl]}')`;
            div.dataset.lvl = lvl;
            div.dataset.lastShot = 0;
            div.draggable = true;
            div.ondragstart = () => { dragged = div; };
            return div;
        }

        document.querySelectorAll('.slot').forEach(slot => {
            slot.ondragover = e => e.preventDefault();
            slot.ondrop = () => {
                if (!slot.hasChildNodes()) {
                    slot.appendChild(dragged);
                } else {
                    const target = slot.firstChild;
                    if (target.dataset.lvl == dragged.dataset.lvl && target.dataset.lvl < 2) {
                        const newLvl = parseInt(target.dataset.lvl) + 1;
                        target.remove(); dragged.remove();
                        slot.appendChild(createMeme(newLvl));
                    }
                }
            };
        });

        document.getElementById('buy-btn').onclick = () => {
            if (coins >= 20) {
                const empty = Array.from(document.querySelectorAll('.m-slot')).find(s => !s.hasChildNodes());
                if (empty) {
                    coins -= 20;
                    empty.appendChild(createMeme(0));
                    document.getElementById('money').innerText = coins;
                }
            }
        };

        function spawnEnemy() {
            const row = Math.floor(Math.random() * 3);
            const en = document.createElement('div');
            en.className = 'enemy';
            // Alterna entre Trollface e outros conforme o n√≠vel procedural
            const type = gameLevel > 2 ? Math.floor(Math.random() * MEMES.enemies.length) : 0;
            en.style.backgroundImage = `url('${MEMES.enemies[type]}')`;
            en.dataset.hp = 80 + (gameLevel * 20);
            en.dataset.row = row;
            en.style.top = (row * 90 + 15) + 'px';
            document.getElementById('battlefield').appendChild(en);
        }

        setInterval(() => {
            // Movimento Procedural (fica mais r√°pido conforme o n√≠vel)
            const speed = 1.0 + (gameLevel * 0.2);
            document.querySelectorAll('.enemy').forEach(en => {
                let r = parseFloat(en.style.right) || -70;
                en.style.right = (r + speed) + 'px';
                if (r > 400) en.remove();
            });

            // Cad√™ncia de tiro controlada
            const now = Date.now();
            document.querySelectorAll('.d-slot').forEach(slot => {
                if (slot.hasChildNodes()) {
                    const meme = slot.firstChild;
                    const cooldown = 1400 - (meme.dataset.lvl * 300);
                    if (now - meme.dataset.lastShot > cooldown) {
                        const target = Array.from(document.querySelectorAll('.enemy'))
                                            .find(e => e.dataset.row == slot.dataset.row);
                        if (target) {
                            shoot(slot, target, (parseInt(meme.dataset.lvl) + 1) * 30);
                            meme.dataset.lastShot = now;
                        }
                    }
                }
            });

            if (Math.random() > 0.98 - (gameLevel * 0.005)) spawnEnemy();
        }, 50);

        function shoot(slot, target, dmg) {
            const b = document.createElement('div');
            b.className = 'bullet';
            b.style.top = (slot.dataset.row * 90 + 45) + 'px';
            b.style.left = '0px';
            document.getElementById('battlefield').appendChild(b);

            let pos = 0;
            const bInt = setInterval(() => {
                pos += 12;
                b.style.left = pos + 'px';
                const tPos = 400 - parseFloat(target.style.right);
                if (pos >= tPos - 20) {
                    clearInterval(bInt); b.remove();
                    target.dataset.hp -= dmg;
                    if (target.dataset.hp <= 0) {
                        target.remove();
                        coins += 15;
                        enemiesKilled++;
                        if (enemiesKilled % 5 === 0) {
                            gameLevel++;
                            document.getElementById('lvl-txt').innerText = gameLevel;
                        }
                        document.getElementById('money').innerText = coins;
                    }
                }
                if (pos > 400) { clearInterval(bInt); b.remove(); }
            }, 20);
        }
    </script>
</body>
</html>
