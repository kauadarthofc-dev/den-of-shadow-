<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Den of Shadow üíÄ</title>
    <style>
        :root {
            --common: #0080ff; --uncommon: #2ecc71; --rare: #f1c40f; 
            --epic: #9b59b6; --legendary: linear-gradient(45deg, #ff0000, #fffb00);
        }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #2c3e50; font-family: 'Comic Sans MS', cursive; }
        canvas { display: block; image-rendering: pixelated; touch-action: none; }

        /* UI HUD FOFA */
        #hud { position: absolute; top: 15px; left: 15px; pointer-events: none; z-index: 10; }
        .stat-box { background: rgba(255, 192, 203, 0.8); border: 3px solid #ff69b4; border-radius: 15px; padding: 5px 15px; margin-bottom: 5px; color: #fff; text-shadow: 1px 1px #000; font-size: 18px; display: flex; align-items: center; gap: 8px; }

        /* MENU INICIAL */
        #start-menu { position: absolute; inset: 0; background: radial-gradient(circle, #ffebf0 0%, #ffc0cb 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        #start-menu h1 { color: #ff1493; font-size: 50px; margin: 0; text-shadow: 3px 3px 0px #fff, 5px 5px 0px rgba(0,0,0,0.1); }
        #start-menu h1::after { content: ' üíÄ'; }
        
        .save-container { display: flex; gap: 20px; margin: 20px; }
        .save-slot { width: 80px; height: 80px; background: #fff; border: 4px solid #ff69b4; border-radius: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; position: relative; overflow: hidden; }
        .save-slot::before { content: 'üíÄ'; position: absolute; opacity: 0.1; font-size: 50px; }

        /* BOT√ïES MOBILE */
        .mobile-btn { position: absolute; pointer-events: auto; display: none; user-select: none; }
        #btn-fs { top: 10px; left: 50%; transform: translateX(-50%); background: #ff69b4; color: white; border: 2px solid white; border-radius: 10px; padding: 10px; z-index: 110; }
        #btn-swap { bottom: 50px; right: 40px; width: 90px; height: 90px; background: rgba(255,255,255,0.4); border: 4px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; }

        /* BOSS UI */
        #boss-ui { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 80%; display: none; }
        #boss-name { color: #ff0040; text-align: center; font-weight: bold; font-size: 22px; margin-bottom: 5px; }
        #boss-hp-bg { width: 100%; height: 20px; background: #444; border: 3px solid #fff; border-radius: 10px; overflow: hidden; }
        #boss-hp-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #ff0040, #ff8080); }

        #minimap-ui { position: absolute; top: 15px; right: 15px; width: 150px; height: 150px; background: rgba(0,0,0,0.4); border: 3px solid #fff; border-radius: 10px; }
        
        #footer { position: absolute; bottom: 10px; left: 10px; font-size: 14px; color: #ff1493; }
        #youtube { color: #ff0000; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div id="start-menu">
    <h1>Den of Shadow</h1>
    <p style="color: #ff69b4;">PC: WASD para mover | Clique para Atirar | Q troca Arma</p>
    <div class="save-container">
        <div class="save-slot" onclick="startGame(1)">1</div>
        <div class="save-slot" onclick="startGame(2)">2</div>
        <div class="save-slot" onclick="startGame(3)">3</div>
    </div>
    <button class="save-slot" style="width: 200px; height: 50px;">CONFIGURA√á√ïES</button>
    <div id="footer">
        kauadarthofc@gmail.com | <a id="youtube" href="https://youtube.com/@kaua_darth" target="_blank">üì∫ @kaua_darth</a>
    </div>
</div>

<div id="hud">
    <div class="stat-box">‚ù§Ô∏è <span id="hp-val">10/10</span></div>
    <div class="stat-box">üí∞ <span id="coin-val">0</span></div>
    <div class="stat-box">üî´ <span id="ammo-val">25</span></div>
    <div class="stat-box">üö™ SALA: <span id="room-val">0</span></div>
</div>

<canvas id="minimap-ui"></canvas>
<button id="btn-fs" class="mobile-btn" onclick="toggleFS()">TELA CHEIA</button>
<div id="btn-swap" class="mobile-btn" onclick="swapWeapon()">SWAP</div>

<div id="boss-ui">
    <div id="boss-name">BOSS</div>
    <div id="boss-hp-bg"><div id="boss-hp-bar"></div></div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
/** üíÄ DEN OF SHADOW - ENGINE PRINCIPAL üíÄ **/
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mCanvas = document.getElementById('minimap-ui');
const mCtx = mCanvas.getContext('2d');

let gameState = 'MENU';
let currentRoom = 0;
let isMobile = /Android|iPhone/i.test(navigator.userAgent);

// CONFIGURA√á√ïES DAS ARMAS (Conforme pedido)
const WEAPONS = [
    { name: 'Lan√ßa-Chamas', type: 'flame', dmg: 6, burn: 2, ammo: 25, maxAmmo: 25, rate: 60, sprite: 'üî•', desc: "Baforada de fogo cont√≠nua!" },
    { name: 'Shotgun', type: 'spread', dmg: 14, pellets: 3, ammo: 8, maxAmmo: 8, rate: 800, range: 150, sprite: 'üçï', desc: "Curto alcance, dano massivo." },
    { name: 'Magnum', type: 'bullet', dmg: 12, ammo: 15, maxAmmo: 15, rate: 400, sprite: 'üî´', desc: "Pistola confi√°vel." },
    { name: 'Cajado M√°gico', type: 'homing', dmg: 8, ammo: 20, maxAmmo: 20, rate: 500, sprite: 'üîÆ', desc: "Tiros que perseguem inimigos." }
];

const player = {
    x: 0, y: 0, w: 40, h: 55, hp: 10, maxHp: 10,
    coins: 0, weaponIdx: 0, weaponsOwned: [0, 1], // Inicia com Lan√ßa-chamas e Shotgun
    velX: 0, velY: 0, speed: 4.5, angle: 0,
    vampirismoCount: 0, animFrame: 0, moving: false,
    dead: false
};

let enemies = [];
let projectiles = [];
let particles = [];
let doors = [];
let boss = null;
let drops = [];

// CONTROLES
const keys = {};
window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;

if(isMobile) {
    document.querySelectorAll('.mobile-btn').forEach(b => b.style.display = 'flex');
}

function startGame(slot) {
    document.getElementById('start-menu').style.display = 'none';
    gameState = 'PLAYING';
    initRoom(0);
    animate();
}

function initRoom(n) {
    currentRoom = n;
    enemies = [];
    projectiles = [];
    doors = [];
    drops = [];
    player.x = 400; player.y = 300;
    
    // Gerar portas aleat√≥rias
    const sides = ['top', 'bottom', 'left', 'right'];
    let doorPos = sides[Math.floor(Math.random()*sides.length)];
    doors.push({ side: doorPos, x: 400, y: 300, open: false, type: 'next' });

    // Sala de Cura √† esquerda ap√≥s Boss
    if(n > 0 && n % 10 === 1) {
        doors.push({ side: 'left', x: 50, y: 300, open: true, type: 'heal' });
    }

    if(n > 0) spawnEnemies();
    if(n > 0 && n % 10 === 0) spawnBoss();
}

function spawnEnemies() {
    let count = 2 + Math.floor(currentRoom / 2);
    for(let i=0; i<count; i++) {
        let type = (currentRoom > 1) ? (Math.random() > 0.5 ? 'KAMIKAZE' : 'DASH') : 'KAMIKAZE';
        if(currentRoom === 1) type = 'KAMIKAZE'; // Kamikaze fora da sala 1
        
        enemies.push({
            x: Math.random() * 1500 + 1000,
            y: Math.random() * 1500 + 1000,
            type: type,
            hp: type === 'KAMIKAZE' ? 4 : 15,
            speed: type === 'KAMIKAZE' ? 1.2 : 2.5,
            color: type === 'KAMIKAZE' ? '#ff0000' : '#8e44ad',
            dead: false
        });
    }
}

function update() {
    if(player.hp <= 0) { player.dead = true; return; }

    // Movimento do Player (Sem travar ao atirar)
    player.moving = false;
    if(keys['KeyW'] || keys['ArrowUp']) { player.y -= player.speed; player.moving = true; }
    if(keys['KeyS'] || keys['ArrowDown']) { player.y += player.speed; player.moving = true; }
    if(keys['KeyA'] || keys['ArrowLeft']) { player.x -= player.speed; player.moving = true; }
    if(keys['KeyD'] || keys['ArrowRight']) { player.x += player.speed; player.moving = true; }

    // Colis√£o com bordas
    player.x = Math.max(50, Math.min(1950, player.x));
    player.y = Math.max(50, Math.min(1950, player.y));

    // Inimigos
    enemies.forEach((en, idx) => {
        if(en.dead) return;
        let dx = player.x - en.x;
        let dy = player.y - en.y;
        let dist = Math.hypot(dx, dy);
        
        // IA Kamikaze (Lento e Explosivo)
        if(en.type === 'KAMIKAZE') {
            en.x += (dx/dist) * en.speed;
            en.y += (dy/dist) * en.speed;
            if(dist < 40) { explode(en); en.dead = true; }
        } else {
            // Dash Enemy (Com asas visuais no draw)
            if(dist < 300) {
                en.x += (dx/dist) * en.speed;
                en.y += (dy/dist) * en.speed;
            }
        }

        // Colis√£o Player <-> Inimigo (Knockback)
        if(dist < 35) {
            player.hp -= 0.05; // Dano de contato leve
            en.x -= (dx/dist) * 20; // Empurra inimigo
        }
    });

    // Proj√©teis
    projectiles.forEach((p, pi) => {
        p.x += p.vx; p.y += p.vy;
        enemies.forEach(en => {
            if(!en.dead && Math.hypot(p.x - en.x, p.y - en.y) < 30) {
                en.hp -= p.dmg;
                if(p.type === 'flame') en.hp -= 2; // Dano de queima√ß√£o
                p.life = 0;
                if(en.hp <= 0) {
                    en.dead = true;
                    player.vampirismoCount++;
                    if(player.vampirismoCount >= 10) { player.hp = Math.min(player.maxHp, player.hp + 1); player.vampirismoCount = 0; }
                    if(Math.random() < 0.2) drops.push({x: en.x, y: en.y, type: 'coin'});
                }
            }
        });
    });
    projectiles = projectiles.filter(p => p.life-- > 0);

    updateHUD();
}

function explode(en) {
    // Dano de 2 HP no player e inimigos pr√≥ximos
    if(Math.hypot(player.x - en.x, player.y - en.y) < 100) player.hp -= 2;
    enemies.forEach(e => {
        if(!e.dead && Math.hypot(e.x - en.x, e.y - en.y) < 100) e.hp -= 2;
    });
    // Part√≠culas de explos√£o
    for(let i=0; i<10; i++) particles.push({x: en.x, y: en.y, vx: Math.random()*4-2, vy: Math.random()*4-2, life: 30, c: 'orange'});
}

function draw() {
    ctx.clearRect(0,0,canvas.width, canvas.height);
    
    // C√¢mera
    let camX = player.x - canvas.width/2;
    let camY = player.y - canvas.height/2;
    ctx.save();
    ctx.translate(-camX, -camY);

    // Cen√°rio (Bioma Azul/Verde - N√£o Preto)
    ctx.fillStyle = '#34495e';
    ctx.fillRect(-2000, -2000, 4000, 4000);
    ctx.strokeStyle = '#5d6d7e';
    for(let i=-2000; i<2000; i+=100) {
        ctx.beginPath(); ctx.moveTo(i, -2000); ctx.lineTo(i, 2000); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(-2000, i); ctx.lineTo(2000, i); ctx.stroke();
    }

    // Desenhar Player (Lord da Luz - Feminina)
    ctx.save();
    ctx.translate(player.x, player.y);
    // Corpo
    ctx.fillStyle = '#fff';
    ctx.shadowBlur = 15; ctx.shadowColor = 'cyan';
    ctx.fillRect(-15, -40, 30, 40);
    // Perninhas Fofas
    let legOffset = player.moving ? Math.sin(Date.now()*0.01)*8 : 0;
    ctx.fillStyle = '#ffb6c1';
    ctx.fillRect(-12, 0, 8, 10 + legOffset);
    ctx.fillRect(4, 0, 8, 10 - legOffset);
    // Arma
    ctx.rotate(player.angle);
    ctx.font = '30px Arial';
    ctx.fillText(WEAPONS[player.weaponIdx].sprite, 10, 0);
    ctx.restore();

    // Inimigos
    enemies.forEach(en => {
        if(en.dead) return;
        ctx.fillStyle = en.color;
        ctx.fillRect(en.x - 20, en.y - 20, 40, 40);
        // Rostos variados
        ctx.fillStyle = '#fff';
        ctx.fillRect(en.x-10, en.y-10, 5, 5); ctx.fillRect(en.x+5, en.y-10, 5, 5);
        if(en.type === 'DASH') { // Asas para o inimigo de dash
            ctx.fillStyle = '#fff';
            ctx.fillRect(en.x-35, en.y-10, 15, 5); ctx.fillRect(en.x+20, en.y-10, 15, 5);
        }
    });

    // Proj√©teis (Baforada de fogo ou balas)
    projectiles.forEach(p => {
        ctx.fillStyle = p.c;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.type === 'flame' ? 8 : 4, 0, Math.PI*2);
        ctx.fill();
    });

    ctx.restore();
    drawMinimap();
}

function drawMinimap() {
    mCtx.fillStyle = 'rgba(0,0,0,0.5)';
    mCtx.fillRect(0,0,150,150);
    // Player
    mCtx.fillStyle = 'cyan';
    mCtx.fillRect(75, 75, 4, 4);
    // Inimigos
    enemies.forEach(en => {
        if(en.dead) return;
        let mx = 75 + (en.x - player.x) * 0.05;
        let my = 75 + (en.y - player.y) * 0.05;
        if(mx > 0 && mx < 150 && my > 0 && my < 150) {
            mCtx.fillStyle = 'red';
            mCtx.fillRect(mx, my, 3, 3);
        }
    });
}

function updateHUD() {
    document.getElementById('hp-val').innerText = `${Math.ceil(player.hp)}/${player.maxHp}`;
    document.getElementById('coin-val').innerText = player.coins;
    document.getElementById('ammo-val').innerText = WEAPONS[player.weaponIdx].ammo;
    document.getElementById('room-val').innerText = currentRoom;
}

// TIRO
window.onmousedown = e => {
    if(gameState !== 'PLAYING') return;
    fire();
};

function fire() {
    let w = WEAPONS[player.weaponIdx];
    if(w.ammo <= 0) return;

    let vx = Math.cos(player.angle) * 8;
    let vy = Math.sin(player.angle) * 8;

    if(w.type === 'spread') {
        for(let i=-1; i<=1; i++) {
            projectiles.push({x: player.x, y: player.y, vx: vx, vy: vy + i*2, life: 20, dmg: w.dmg, c: 'yellow', type: 'bullet'});
        }
    } else if(w.type === 'flame') {
        projectiles.push({x: player.x, y: player.y, vx: vx + (Math.random()-0.5)*4, vy: vy + (Math.random()-0.5)*4, life: 15, dmg: w.dmg, c: 'orange', type: 'flame'});
    } else {
        projectiles.push({x: player.x, y: player.y, vx: vx, vy: vy, life: 60, dmg: w.dmg, c: 'white', type: 'bullet'});
    }
    w.ammo--;
}

function swapWeapon() {
    player.weaponIdx = (player.weaponIdx + 1) % player.weaponsOwned.length;
}

function toggleFS() {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
}

function animate() {
    if(gameState === 'PLAYING') {
        update();
        draw();
    }
    requestAnimationFrame(animate);
}

// Listener para dire√ß√£o do player
window.onmousemove = e => {
    let rect = canvas.getBoundingClientRect();
    let dx = e.clientX - canvas.width/2;
    let dy = e.clientY - canvas.height/2;
    player.angle = Math.atan2(dy, dx);
};

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
mCanvas.width = 150; mCanvas.height = 150;
</script>
</body>
</html>
