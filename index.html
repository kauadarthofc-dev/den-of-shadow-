<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Den of Shadow ðŸ’€</title>
    <style>
        * { touch-action: none !important; user-select: none; outline: none; -webkit-tap-highlight-color: transparent; }
        html, body { background: #2c3e50; margin: 0; padding: 0; overflow: hidden; height: 100%; width: 100%; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #fff; }
        canvas { display: block; image-rendering: pixelated; }

        .overlay { position: absolute; inset: 0; background: rgba(20, 30, 48, 0.98); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .btn-ui { padding: 15px 40px; background: #4ecca3; border: none; color: #1a1a2e; font-size: 20px; font-weight: bold; border-radius: 12px; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 0 #3b9a7a; }
        
        /* Mobile UI Optimization */
        #mobile-ui { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 1000; }
        #joy-zone { position: absolute; bottom: 5%; left: 5%; width: 130px; height: 130px; pointer-events: auto; }
        #joy-bound { width: 100%; height: 100%; border: 4px solid rgba(255,255,255,0.2); border-radius: 50%; background: rgba(255,255,255,0.05); }
        #joy-stick { width: 50px; height: 50px; background: #4ecca3; border-radius: 50%; position: absolute; left: 40px; top: 40px; }
        
        #atk-zone { position: absolute; bottom: 5%; right: 5%; pointer-events: auto; }
        .atk-btn { width: 75px; height: 75px; background: rgba(231,76,60,0.3); border: 3px solid #e74c3c; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 30px; }
        #btn-grid { display: grid; grid-template-columns: repeat(3, 80px); gap: 10px; }
        
        #swap-btn { position: absolute; bottom: 10%; right: 38%; width: 90px; height: 90px; background: #f1c40f; color: #000; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; pointer-events: auto; border: 4px solid #fff; font-size: 14px; }
        #fs-btn { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); padding: 10px 25px; background: rgba(0,0,0,0.6); border: 1px solid #fff; border-radius: 30px; pointer-events: auto; z-index: 2500; font-size: 12px; }

        /* Upgrade Cards */
        #card-screen { display: none; z-index: 3000; }
        .card { width: 180px; height: 260px; background: #16213e; border: 5px solid #fff; border-radius: 15px; margin: 10px; padding: 15px; cursor: pointer; transition: 0.2s; }
        .card:hover { transform: translateY(-10px); }
        .rar-50 { border-color: #3498db; color: #3498db; } /* Comum */
        .rar-25 { border-color: #2ecc71; color: #2ecc71; } /* Incomum */
        .rar-20 { border-color: #f1c40f; color: #f1c40f; } /* Raro */
        .rar-05 { border-color: #9b59b6; color: #9b59b6; } /* Epico */
        .rar-01 { border-color: #ff00ff; animation: rainbow 2s infinite linear; } /* Lendario */
        @keyframes rainbow { 0%{filter:hue-rotate(0deg)} 100%{filter:hue-rotate(360deg)} }

        #weapon-popup { position: absolute; bottom: 25%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); border: 2px solid #f1c40f; padding: 15px; border-radius: 10px; display: none; z-index: 500; }
    </style>
</head>
<body>

<div id="fs-btn" onclick="toggleFS()">TELA CHEIA â›¶</div>

<div id="start-screen" class="overlay">
    <h1 style="color:#ff4d6d; font-size:55px;">ðŸ’€ DEN OF SHADOW</h1>
    <p id="platform-hint" style="font-size:18px; color:#bdc3c7;"></p>
    <div class="btn-ui" id="btn-start">ENTRAR NO COVIL</div>
    <a href="mailto:kauadarthofc@gmail.com" style="margin-top:30px; color:#7f8c8d; text-decoration:none; font-size:13px;">kauadarthofc@gmail.com</a>
</div>

<div id="card-screen" class="overlay">
    <h2 style="color:#f1c40f">ESCOLHA SEU PODER</h2>
    <div id="cards-box" style="display:flex;"></div>
</div>

<div id="death-screen" class="overlay" style="display:none;">
    <h1 style="color:#e74c3c; font-size:60px;">FIM DA JORNADA</h1>
    <div class="btn-ui" onclick="location.reload()">TENTAR NOVAMENTE</div>
</div>

<div id="weapon-popup"></div>

<canvas id="game"></canvas>

<div id="mobile-ui">
    <div id="joy-zone"><div id="joy-bound"><div id="joy-stick"></div></div></div>
    <div id="atk-zone"><div id="btn-grid">
        <div></div><div class="atk-btn" data-dir="up">â–²</div><div></div>
        <div class="atk-btn" data-dir="left">â—€</div><div class="atk-btn" data-dir="down">â–¼</div><div class="atk-btn" data-dir="right">â–¶</div>
    </div></div>
    <div id="swap-btn">SWAP</div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

const Game = {
    started: false, room: 0, isHealRoom: false,
    roomW: 1600, roomH: 1200, camX: 0, camY: 0,
    hp: 6, maxHp: 6, kills: 0,
    weapon: 'magnum', triple: 0, ric: 0, dual: false, vamp: 0, pets: 0,
    hasFire: false, hasShotgun: false, hasStaff: false,
    inv: {
        magnum: { ammo: 8, max: 8, dmg: 10, color: "#0ff", name: "Magnum" },
        fire: { ammo: 45, max: 45, dmg: 6, color: "#ff4500", name: "Baforada" },
        shotgun: { ammo: 6, max: 6, dmg: 17, color: "#f1c40f", name: "Shotgun" },
        staff: { ammo: 15, max: 15, dmg: 22, color: "#9b59b6", name: "Cajado" }
    }
};

let enemies = [], projectiles = [], drops = [], pedestals = [], pets = [];
let p = { x: 800, y: 600, w: 40, h: 44, iframe: 0, timer: 0, legAn: 0, rel: false, relT: 0, dead: false };
const keys = new Set();
const atkDir = { up: false, down: false, left: false, right: false };
const joy = { active: false, x: 0, y: 0, sx: 0, sy: 0 };

if(isMobile) {
    document.getElementById('platform-hint').innerText = "Dica Mobile: Use o joystick e botÃµes de seta";
    document.getElementById('mobile-ui').style.display = 'block';
} else {
    document.getElementById('platform-hint').innerText = "Dica PC: WASD para mover | SETAS para atirar | Q troca arma";
}

function initRoom() {
    enemies = []; projectiles = []; drops = []; pedestals = [];
    p.x = Game.roomW/2; p.y = Game.roomH/2; p.iframe = 40;

    if(Game.room === 0) return; // Tutorial

    if(Game.room % 10 === 0) {
        enemies.push({ type:'boss', x:Game.roomW/2-100, y:300, hp:650+Game.room*60, max:650+Game.room*60, w:200, h:200, hit:0, t:0, name: `GUARDIÃƒO ${Game.room}` });
    } else if(!Game.isHealRoom) {
        let n = 3 + Math.floor(Game.room/2.5);
        for(let i=0; i<n; i++) {
            let ex, ey;
            do { ex = 150+Math.random()*(Game.roomW-300); ey = 150+Math.random()*(Game.roomH-300); } while(Math.hypot(ex-p.x, ey-p.y) < 500);
            let type = 'stalker';
            if(Game.room >= 2) type = Math.random() < 0.35 ? 'dasher' : 'stalker';
            if(Game.room >= 3 && Math.random() < 0.25) type = 'kamikaze';
            enemies.push({ type, x:ex, y:ey, hp:45+Game.room*10, w:55, h:55, hit:0, ft:0, dt:0, face: Math.floor(Math.random()*3) });
        }
    }

    if(Game.isHealRoom) drops.push({x:Game.roomW/2, y:Game.roomH/2, type:'big_heal'});
    if(Game.room === 5 && !Game.hasFire) pedestals.push({x:Game.roomW/2, y:400, type:'fire', info:"BAFORADA: 6 DMG + 2 QUEIMA (RÃPIDA)"});
    if(Game.room === 15 && !Game.hasShotgun) pedestals.push({x:Game.roomW/2, y:400, type:'shotgun', info:"SHOTGUN: 17 DMG (CURTO ALCANCE)"});
    if(Game.room === 25 && !Game.hasStaff) pedestals.push({x:Game.roomW/2, y:400, type:'staff', info:"CAJADO: 22 DMG (TELEGUIADO)"});
}

function fire(dx, dy) {
    const w = Game.inv[Game.weapon];
    if(p.rel || w.ammo <= 0) return;

    let n = (1 + Game.triple) * (Game.dual ? 2 : 1);
    let ang = Math.atan2(dy, dx);
    let cd = Game.weapon === 'fire' ? 3 : 15;

    if(p.timer % cd === 0) {
        for(let i=0; i<n; i++) {
            let a = ang + (i - (n-1)/2) * 0.15;
            if(Game.weapon === 'fire') {
                for(let j=0; j<2; j++) projectiles.push({x:p.x+20, y:p.y+20, dx:Math.cos(a)+(Math.random()-0.5)*0.5, dy:Math.sin(a)+(Math.random()-0.5)*0.5, type:'fire', life:25});
            } else if(Game.weapon === 'shotgun') {
                for(let j=-2; j<=2; j++) projectiles.push({x:p.x+20, y:p.y+20, dx:Math.cos(a+j*0.25), dy:Math.sin(a+j*0.25), type:'shotgun', life:20});
            } else {
                projectiles.push({x:p.x+20, y:p.y+20, dx:Math.cos(a), dy:Math.sin(a), type:Game.weapon, life:100});
            }
        }
        w.ammo--; if(w.ammo <= 0) p.rel = true;
    }
}

function update() {
    if(!Game.started || p.dead) return;

    // Movement
    let mx = joy.active ? joy.x : (keys.has('a')?-1:keys.has('d')?1:0);
    let my = joy.active ? joy.y : (keys.has('w')?-1:keys.has('s')?1:0);
    p.x = Math.max(40, Math.min(Game.roomW-80, p.x + mx * 5.5));
    p.y = Math.max(40, Math.min(Game.roomH-80, p.y + my * 5.5));
    if(mx !== 0 || my !== 0) p.legAn += 0.25;

    // Reload
    if(p.rel) { p.relT++; if(p.relT > 50){ Game.inv[Game.weapon].ammo = Game.inv[Game.weapon].max; p.rel=false; p.relT=0; }}

    // Attack
    let ax = (keys.has('arrowleft')?-1:keys.has('arrowright')?1:0);
    let ay = (keys.has('arrowup')?-1:keys.has('arrowdown')?1:0);
    if(atkDir.up) ay=-1; if(atkDir.down) ay=1; if(atkDir.left) ax=-1; if(atkDir.right) ax=1;
    if(ax||ay) fire(ax, ay);

    // Enemies
    enemies.forEach((e, i) => {
        let ang = Math.atan2(p.y-e.y, p.x-e.x);
        let dist = Math.hypot(p.x-e.x, p.y-e.y);

        if(e.type==='boss') {
            e.t++; e.x += Math.sin(e.t/50)*2;
            if(e.t % 80 === 0) for(let j=0; j<8; j++) projectiles.push({x:e.x+100, y:e.y+100, dx:Math.cos(j*0.8), dy:Math.sin(j*0.8), type:'magnum', life:100, enemy:true});
        } else {
            let spd = e.type==='kamikaze' ? 1.2 : 2.2;
            if(e.type==='dasher') {
                e.dt++;
                if(e.dt > 100) { e.x += Math.cos(ang)*11; e.y += Math.sin(ang)*11; if(e.dt > 115) e.dt=0; }
                else { e.x += Math.cos(ang)*spd; e.y += Math.sin(ang)*spd; }
            } else { e.x += Math.cos(ang)*spd; e.y += Math.sin(ang)*spd; }
        }

        if(p.iframe <= 0 && dist < 50) {
            if(e.type==='kamikaze') { Game.hp -= 2; e.hp = 0; }
            else Game.hp--;
            p.iframe = 60;
        }

        if(e.ft > 0 && p.timer % 30 === 0) { e.hp -= 2; e.ft--; e.hit=5; }
        if(e.hp <= 0) {
            if(e.type==='kamikaze') {
                enemies.forEach(o => { if(o!==e && Math.hypot(e.x-o.x, e.y-o.y) < 180) o.hp -= 150; });
            }
            Game.kills++;
            if(Game.vamp > 0 && Game.kills % 10 === 0) Game.hp = Math.min(Game.maxHp, Game.hp+1);
            if(Math.random() < 0.25) drops.push({x:e.x, y:e.y, type:'heal'});
            if(e.type==='boss') showUpgrades();
            enemies.splice(i,1);
        }
        if(e.hit > 0) e.hit--;
    });

    // Projectiles
    projectiles.forEach((pr, i) => {
        if(pr.type==='staff' && !pr.enemy) {
            let target = enemies[0];
            if(target) { let ta = Math.atan2(target.y-pr.y, target.x-pr.x); pr.dx += Math.cos(ta)*0.1; pr.dy += Math.sin(ta)*0.1; }
        }
        pr.x += pr.dx * 16; pr.y += pr.dy * 16; pr.life--;

        if(!pr.enemy) {
            enemies.forEach(e => {
                if(pr.x > e.x && pr.x < e.x+e.w && pr.y > e.y && pr.y < e.y+e.h) {
                    e.hp -= Game.inv[pr.type].dmg;
                    if(pr.type==='fire') e.ft = 5; e.hit=5;
                    if(Game.ric > 0 && !pr.rd) { pr.dx *= -1; pr.dy *= -1; pr.rd=true; } else projectiles.splice(i,1);
                }
            });
        } else if(Math.hypot(pr.x-p.x, pr.y-p.y) < 30 && p.iframe <= 0) { Game.hp--; p.iframe=60; projectiles.splice(i,1); }
        if(pr.life <= 0) projectiles.splice(i,1);
    });

    // Pedestals & Drops
    let hMsg = "";
    pedestals.forEach((ped, i) => {
        let d = Math.hypot(p.x-ped.x, p.y-ped.y);
        if(d < 150) hMsg = ped.info;
        if(d < 60) {
            if(ped.type === 'fire') Game.hasFire = true;
            if(ped.type === 'shotgun') Game.hasShotgun = true;
            if(ped.type === 'staff') Game.hasStaff = true;
            pedestals.splice(i,1);
        }
    });
    document.getElementById('weapon-popup').innerText = hMsg;
    document.getElementById('weapon-popup').style.display = hMsg ? 'block' : 'none';

    drops.forEach((d, i) => { if(Math.hypot(p.x-d.x, p.y-d.y) < 50) { Game.hp = Math.min(Game.maxHp, Game.hp+(d.type==='big_heal'?6:1)); drops.splice(i,1); } });

    // Room Progression
    if(enemies.length === 0) {
        if(Math.hypot(p.x-Game.roomW/2, p.y) < 70) { Game.room++; Game.isHealRoom=false; initRoom(); }
        if(Game.room > 0 && Game.room % 10 === 0 && Math.hypot(p.x, p.y-Game.roomH/2) < 70) { Game.isHealRoom=true; initRoom(); }
    }

    if(p.iframe > 0) p.iframe--;
    if(Game.hp <= 0 && !p.dead) { p.dead = true; document.getElementById('death-screen').style.display = 'flex'; }
    p.timer++;
}

function draw() {
    ctx.clearRect(0,0, canvas.width, canvas.height);
    ctx.save();
    Game.camX += (p.x - canvas.width/2 - Game.camX) * 0.1;
    Game.camY += (p.y - canvas.height/2 - Game.camY) * 0.1;
    ctx.translate(-Game.camX, -Game.camY);

    // Scenario
    ctx.fillStyle = Game.isHealRoom ? "#1a332d" : (Game.room % 10 === 0 ? "#3d1a1a" : "#242442");
    ctx.fillRect(0,0, Game.roomW, Game.roomH);
    ctx.strokeStyle = "#323266"; ctx.lineWidth = 2;
    for(let i=0; i<Game.roomW; i+=100) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i, Game.roomH); ctx.stroke(); }
    ctx.strokeRect(0,0, Game.roomW, Game.roomH);

    // Player
    let ly = Math.sin(p.legAn)*8;
    ctx.fillStyle = "#fff"; ctx.fillRect(p.x+8, p.y+38+ly, 10, 8); ctx.fillRect(p.x+22, p.y+38-ly, 10, 8);
    ctx.fillStyle = (p.iframe > 0 && p.timer % 4 < 2) ? "#ff4d6d" : "#4ecca3";
    ctx.fillRect(p.x, p.y, 40, 40);
    ctx.fillStyle="#1a1a2e"; ctx.fillRect(p.x+8, p.y+10, 6, 6); ctx.fillRect(p.x+26, p.y+10, 6, 6);

    // Enemies
    enemies.forEach(e => {
        ctx.fillStyle = e.hit > 0 ? "#fff" : (e.type==='kamikaze'?"#f1c40f":(e.type==='boss'?"#e74c3c":"#3498db"));
        if(e.ft > 0) ctx.fillStyle = "#ff8c00";
        ctx.fillRect(e.x, e.y, e.w, e.h);
        
        // Faces
        ctx.fillStyle = "#fff";
        if(e.type === 'dasher') { // Asas
            ctx.fillRect(e.x-10, e.y+10, 10, 20); ctx.fillRect(e.x+e.w, e.y+10, 10, 20);
            ctx.fillStyle="#000"; ctx.fillRect(e.x+10, e.y+15, 6, 6); ctx.fillRect(e.x+35, e.y+15, 6, 6);
        } else {
            ctx.fillStyle="#000"; 
            if(e.face === 0) { ctx.fillRect(e.x+10, e.y+15, 6, 6); ctx.fillRect(e.x+35, e.y+15, 6, 6); }
            else if(e.face === 1) { ctx.fillRect(e.x+15, e.y+10, 20, 4); ctx.fillRect(e.x+15, e.y+30, 20, 4); }
            else { ctx.beginPath(); ctx.arc(e.x+27, e.y+20, 8, 0, Math.PI*2); ctx.fill(); }
        }

        if(e.type==='boss') {
            ctx.restore(); ctx.save();
            ctx.fillStyle = "rgba(0,0,0,0.5)"; ctx.fillRect(canvas.width/2-200, 25, 400, 30);
            ctx.fillStyle = "#ff4d6d"; ctx.fillRect(canvas.width/2-200, 25, (e.hp/e.max)*400, 30);
            ctx.fillStyle="#fff"; ctx.font="bold 14px Arial"; ctx.textAlign="center"; ctx.fillText(e.name, canvas.width/2, 45);
            ctx.restore(); ctx.save(); ctx.translate(-Game.camX, -Game.camY);
        }
    });

    projectiles.forEach(pr => { ctx.fillStyle = pr.enemy ? "#fff" : Game.inv[pr.type].color; ctx.fillRect(pr.x, pr.y, 12, 12); });
    pedestals.forEach(ped => { ctx.fillStyle = "#f1c40f"; ctx.fillRect(ped.x-30, ped.y-30, 60, 60); ctx.fillStyle=Game.inv[ped.type].color; ctx.fillRect(ped.x-15, ped.y-65+Math.sin(p.timer/10)*12, 30, 30); });
    drops.forEach(d => { ctx.fillStyle="#ff4d6d"; ctx.shadowBlur=15; ctx.shadowColor="#ff4d6d"; ctx.fillRect(d.x, d.y, 20, 20); ctx.shadowBlur=0; });
    
    if(enemies.length === 0) { ctx.fillStyle="#4ecca3"; ctx.fillRect(Game.roomW/2-70, 0, 140, 20); ctx.fillStyle="#f1c40f"; ctx.fillRect(0, Game.roomH/2-70, 20, 140); }

    ctx.restore();

    // HUD
    ctx.fillStyle="#fff"; ctx.font="bold 20px Arial"; ctx.fillText(`ANDAR: ${Game.room}`, 25, 45);
    ctx.fillText(`${Game.inv[Game.weapon].name}: ${Game.inv[Game.weapon].ammo}`, 25, 115);
    for(let i=0; i<Game.maxHp; i++) { ctx.fillStyle = i < Game.hp ? "#ff4d6d" : "#333"; ctx.beginPath(); ctx.arc(40+i*35, 80, 14, 0, Math.PI*2); ctx.fill(); }

    // Minimap
    const ms = 140; const mx = canvas.width-165, my = 25;
    ctx.fillStyle = "rgba(0,0,0,0.6)"; ctx.fillRect(mx, my, ms, ms);
    ctx.strokeStyle = "#fff"; ctx.strokeRect(mx, my, ms, ms);
    enemies.forEach(e => { ctx.fillStyle="red"; ctx.fillRect(mx + (e.x/Game.roomW)*ms, my + (e.y/Game.roomH)*ms, 4, 4); });
    ctx.fillStyle="#fff"; ctx.fillRect(mx + (p.x/Game.roomW)*ms, my + (p.y/Game.roomH)*ms, 5, 5);
    if(enemies.length === 0) { ctx.fillStyle="#4ecca3"; ctx.fillRect(mx+ms/2-10, my, 20, 5); ctx.fillStyle="#f1c40f"; ctx.fillRect(mx, my+ms/2-10, 5, 20); }

    requestAnimationFrame(() => { update(); draw(); });
}

function showUpgrades() {
    Game.started = false; document.getElementById('card-screen').style.display='flex';
    const box = document.getElementById('cards-box'); box.innerHTML='';
    const pool = [
        {n:"TIRO TRIPLO", d:"Atira em 3 direÃ§Ãµes (AtÃ© 4x)", r:"rar-20", a:()=>Game.triple=Math.min(4, Game.triple+1)},
        {n:"VAMPIRISMO", d:"Cura 1 HP a cada 10 mortes", r:"rar-25", a:()=>Game.vamp++},
        {n:"RICOCHETE", d:"Balas quicam nas paredes", r:"rar-05", a:()=>Game.ric++},
        {n:"CORAÃ‡ÃƒO", d:"+2 de vida mÃ¡xima", r:"rar-50", a:()=>{Game.maxHp+=2; Game.hp+=2;}}
    ];
    if(Game.room >= 20 && Math.random() < 0.01) pool.push({n:"DUAL WIELD", d:"Use 2 armas ao mesmo tempo!", r:"rar-01", a:()=>Game.dual=true});

    for(let i=0; i<3; i++) {
        let rng = Math.random();
        let up = pool[Math.floor(Math.random()*pool.length)];
        let d = document.createElement('div'); d.className = `card ${up.r}`;
        d.innerHTML = `<h3>${up.n}</h3><p>${up.d}</p>`;
        d.onclick = () => { up.a(); document.getElementById('card-screen').style.display='none'; Game.started=true; };
        box.appendChild(d);
    }
}

// Controls
const jz = document.getElementById('joy-zone'), jb = document.getElementById('joy-bound'), js = document.getElementById('joy-stick');
jz.ontouchstart = (e) => { joy.active=true; let r=jb.getBoundingClientRect(); joy.sx=r.left+65; joy.sy=r.top+65; };
jz.ontouchmove = (e) => {
    if(!joy.active) return; let t=e.touches[0];
    let dx=t.clientX-joy.sx, dy=t.clientY-joy.sy;
    let d=Math.min(Math.hypot(dx,dy), 55); let a=Math.atan2(dy,dx);
    joy.x=(Math.cos(a)*d)/55; joy.y=(Math.sin(a)*d)/55;
    js.style.transform=`translate(${Math.cos(a)*d}px, ${Math.sin(a)*d}px)`;
};
jz.ontouchend = () => { joy.active=false; joy.x=0; joy.y=0; js.style.transform='none'; };

document.querySelectorAll('.atk-btn').forEach(b => {
    b.ontouchstart=(e)=>{ e.preventDefault(); atkDir[b.dataset.dir]=true; };
    b.ontouchend=(e)=>{ e.preventDefault(); atkDir[b.dataset.dir]=false; };
});

function swap() {
    let l = ['magnum']; if(Game.hasFire) l.push('fire'); if(Game.hasShotgun) l.push('shotgun'); if(Game.hasStaff) l.push('staff');
    Game.weapon = l[(l.indexOf(Game.weapon)+1)%l.length]; p.rel=false;
}
document.getElementById('swap-btn').onclick = swap;
window.onkeydown=e=>{ keys.add(e.key.toLowerCase()); if(e.key==='q') swap(); };
window.onkeyup=e=>keys.delete(e.key.toLowerCase());
document.getElementById('btn-start').onclick = () => { Game.started=true; document.getElementById('start-screen').style.display='none'; initRoom(); draw(); };
function toggleFS() { if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
window.onresize = () => { canvas.width=window.innerWidth; canvas.height=window.innerHeight; }; window.onresize();
</script>
</body>
</html>
