<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Game Mobile & Console</title>
    <style>
        body { margin: 0; overflow: hidden; background: #222; font-family: sans-serif; }
        canvas { display: block; }

        /* Interface UI */
        #ui {
            position: absolute; top: 10px; left: 10px; color: white;
            pointer-events: none; text-shadow: 2px 2px 4px #000;
        }

        /* Controles Mobile */
        .controls {
            position: absolute; bottom: 20px; width: 100%;
            display: flex; justify-content: space-between; padding: 0 20px;
            box-sizing: border-box;
        }
        .btn {
            width: 70px; height: 70px; background: rgba(255,255,255,0.2);
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: white; user-select: none;
            border: 2px solid white; pointer-events: auto;
        }
        #joystick-area { width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%; }
    </style>
</head>
<body>

    <div id="ui">
        <h2 id="weapon-name">Arma: Espada</h2>
        <p>Console: A/X para Atacar | R1 para Trocar</p>
        <p>Teclado: Espaço para Atacar | Q para Trocar</p>
    </div>

    <div class="controls">
        <div id="joystick-area"></div>
        <div style="display: flex; gap: 10px;">
            <div class="btn" id="btn-switch">Trocar</div>
            <div class="btn" id="btn-attack" style="background: rgba(255,0,0,0.5);">Atacar</div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Configurações do Mundo
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Estado do Jogador
    const player = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        size: 30,
        speed: 4,
        color: 'cyan',
        weapons: ['Espada', 'Arco', 'Cajado'],
        currentWeaponIndex: 0,
        isAttacking: false
    };

    // Câmera
    const camera = { x: 0, y: 0 };

    // Inputs
    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    // Lógica de Troca de Arma (Não remove o que já existe)
    function switchWeapon() {
        player.currentWeaponIndex = (player.currentWeaponIndex + 1) % player.weapons.length;
        document.getElementById('weapon-name').innerText = "Arma: " + player.weapons[player.currentWeaponIndex];
    }

    function attack() {
        player.isAttacking = true;
        setTimeout(() => player.isAttacking = false, 150);
        console.log("Atacando com " + player.weapons[player.currentWeaponIndex]);
    }

    // Eventos Mobile
    document.getElementById('btn-switch').addEventListener('touchstart', (e) => { e.preventDefault(); switchWeapon(); });
    document.getElementById('btn-attack').addEventListener('touchstart', (e) => { e.preventDefault(); attack(); });

    // Suporte a Gamepad (Console)
    function checkGamepad() {
        const gamepads = navigator.getGamepads();
        if (!gamepads[0]) return;
        
        const gp = gamepads[0];
        // Movimento (Analógico Esquerdo)
        if (Math.abs(gp.axes[0]) > 0.1) player.x += gp.axes[0] * player.speed;
        if (Math.abs(gp.axes[1]) > 0.1) player.y += gp.axes[1] * player.speed;

        // Botões (A ou X para ataque, R1 para trocar)
        if (gp.buttons[0].pressed) attack();
        if (gp.buttons[5].pressed) switchWeapon(); // R1 / RB
    }

    function update() {
        // Movimentação Teclado
        if (keys['KeyW'] || keys['ArrowUp']) player.y -= player.speed;
        if (keys['KeyS'] || keys['ArrowDown']) player.y += player.speed;
        if (keys['KeyA'] || keys['ArrowLeft']) player.x -= player.speed;
        if (keys['KeyD'] || keys['ArrowRight']) player.x += player.speed;

        // Atalhos Teclado
        if (keys['KeyQ']) { switchWeapon(); keys['KeyQ'] = false; }
        if (keys['Space']) { attack(); keys['Space'] = false; }

        checkGamepad();

        // CENTRALIZAÇÃO DA CÂMERA
        // A câmera segue o jogador mantendo-o no centro da tela
        camera.x = player.x - canvas.width / 2;
        camera.y = player.y - canvas.height / 2;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.save();
        // Aplica o deslocamento da câmera
        ctx.translate(-camera.x, -camera.y);

        // Desenha um "Chão" para referência de movimento
        ctx.strokeStyle = "#444";
        for(let i=0; i<2000; i+=100) {
            ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, 2000); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(2000, i); ctx.stroke();
        }

        // Desenha o Jogador
        ctx.fillStyle = player.isAttacking ? "white" : player.color;
        ctx.fillRect(player.x - player.size/2, player.y - player.size/2, player.size, player.size);

        // Desenha a "Arma" (visual simples)
        ctx.fillStyle = "yellow";
        if (player.currentWeaponIndex === 0) ctx.fillRect(player.x + 20, player.y - 5, 20, 10); // Espada
        if (player.currentWeaponIndex === 1) ctx.arc(player.x + 25, player.y, 10, 0, Math.PI*2); // Arco

        ctx.restore();

        requestAnimationFrame(() => {
            update();
            draw();
        });
    }

    draw();
</script>
</body>
</html>
