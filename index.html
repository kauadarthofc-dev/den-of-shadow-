<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Den of Shadow ðŸ’€</title>
    <style>
        :root {
            --c-comum: #3498db; --c-incomum: #2ecc71; --c-raro: #f1c40f; 
            --c-epico: #9b59b6; --c-lendario: linear-gradient(45deg, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff);
        }
        * { touch-action: none; user-select: none; box-sizing: border-box; outline: none; }
        body { margin: 0; background: #0f0c29; color: white; font-family: 'Verdana', sans-serif; overflow: hidden; }
        canvas { display: block; image-rendering: pixelated; }

        /* UI de Menus */
        .ui-screen { position: absolute; inset: 0; background: rgba(5, 5, 15, 0.98); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .title-box { border: 4px solid #fff; padding: 20px; border-radius: 15px; background: rgba(231, 76, 60, 0.2); }
        .title-text { font-size: 50px; color: #e74c3c; margin: 0; text-transform: uppercase; }
        .hint-bar { color: #2ecc71; margin: 15px; font-weight: bold; background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 10px; }
        .btn-main { padding: 15px 40px; background: #2ecc71; border: none; color: white; font-size: 22px; font-weight: bold; border-radius: 30px; cursor: pointer; transition: 0.2s; box-shadow: 0 5px #27ae60; }
        .btn-main:active { transform: translateY(3px); box-shadow: none; }

        /* Controles Mobile/Console */
        #mobile-hud { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 1000; }
        #joy-base { position: absolute; bottom: 40px; left: 40px; width: 140px; height: 140px; background: rgba(255,255,255,0.1); border: 3px solid #fff; border-radius: 50%; pointer-events: auto; }
        #joy-stick { position: absolute; width: 60px; height: 60px; background: #00eaff; border-radius: 50%; left: 37px; top: 37px; box-shadow: 0 0 15px #00eaff; }
        #atk-grid { position: absolute; bottom: 30px; right: 30px; display: grid; grid-template-columns: repeat(3, 90px); gap: 10px; pointer-events: auto; }
        .btn-atk { width: 90px; height: 90px; background: rgba(255,255,255,0.15); border: 4px solid #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 30px; color: white; }
        #swap-mob { position: absolute; bottom: 40px; right: 350px; width: 100px; height: 100px; background: #f1c40f; border: 4px solid #fff; border-radius: 20px; pointer-events: auto; display: flex; align-items: center; justify-content: center; color: #000; font-weight: bold; }
        #fs-mob { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); padding: 10px 25px; background: #333; color: #fff; border: 2px solid #fff; border-radius: 20px; pointer-events: auto; z-index: 2500; font-size: 12px; }

        #weapon-tag { position: absolute; bottom: 150px; left: 50%; transform: translateX(-50%); background: #000; border: 2px solid #f1c40f; padding: 10px 20px; border-radius: 10px; display: none; z-index: 500; text-align: center; }
    </style>
</head>
<body>

<div id="fs-mob" onclick="toggleFS()">TELA CHEIA</div>

<div id="start-screen" class="ui-screen">
    <div class="title-box">
        <h1 class="title-text">Den of Shadow ðŸ’€</h1>
    </div>
    <div id="plat-info" class="hint-bar"></div>
    <button class="btn-main" id="btn-play">ENTRAR NA MASMORRA</button>
    <div style="margin-top:30px; text-align: center;">
        <a href="mailto:kauadarthofc@gmail.com" style="color:#bdc3c7; text-decoration:none;">ðŸ“§ kauadarthofc@gmail.com</a><br><br>
        <a href="https://youtube.com/@kaua_darth" target="_blank" style="color:#ff0000; text-decoration:none; font-weight:bold;">ðŸŽ¬ YouTube: @kaua_darth</a>
    </div>
</div>

<div id="death-screen" class="ui-screen" style="display:none;">
    <h1 style="color:#e74c3c; font-size:60px;">VOCÃŠ CAIU</h1>
    <button class="btn-main" onclick="location.reload()">RENASCER</button>
</div>

<div id="weapon-tag"></div>
<canvas id="gameCanvas"></canvas>

<div id="mobile-hud">
    <div id="joy-base"><div id="joy-stick"></div></div>
    <div id="atk-grid">
        <div></div><div class="btn-atk" data-dir="up">â–²</div><div></div>
        <div class="btn-atk" data-dir="left">â—€</div><div class="btn-atk" data-dir="down">â–¼</div><div class="btn-atk" data-dir="right">â–¶</div>
    </div>
    <div id="swap-mob">ðŸ”„ SWAP</div>
</div>

<script>
/** @type {HTMLCanvasElement} */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

// REBALANCEAMENTO GLOBAL
const G = {
    play: false, room: 1, 
    w: 2400, h: 1800, cx: 0, cy: 0,
    hp: 12, maxHp: 12, kills: 0,
    weapon: 'magnum', triple: 0, 
    inv: {
        magnum: { a: 18, m: 18, d: 15, c: "#00eaff", n: "Magnum", cd: 15 }, // Mais rÃ¡pida e forte
        fire: { a: 40, m: 40, d: 5, c: "#ff6a00", n: "LanÃ§a-Chamas", cd: 4 }, // Mais muniÃ§Ã£o
        shotgun: { a: 8, m: 8, d: 22, c: "#f1c40f", n: "Shotgun", cd: 50 }   // Dano massivo
    }
};

let p = { x: 1200, y: 900, r: 25, iframe: 0, t: 0, leg: 0, rel: false, relT: 0, alive: true, rot: 0, speed: 8.5 };
let enemies = [], projectiles = [], drops = [];
const keys = new Set();
const mobAtk = { up: false, down: false, left: false, right: false };
const joy = { active: false, x: 0, y: 0, sx: 0, sy: 0 };

const pInfo = document.getElementById('plat-info');
if(isMobile) {
    document.getElementById('mobile-hud').style.display = 'block';
    pInfo.innerText = "ðŸ“± MOBILE: Use os controles na tela!";
} else {
    pInfo.innerText = "ðŸ’» PC: WASD e SETAS para atirar!";
}

function fire(dx, dy) {
    const w = G.inv[G.weapon];
    if(p.rel || w.a <= 0) return;
    if(p.t % w.cd === 0) {
        let ang = Math.atan2(dy, dx);
        p.rot = ang; // PRIORIDADE TIRO
        
        if(G.weapon === 'shotgun') {
            for(let j=-2; j<=2; j++) projectiles.push({x:p.x, y:p.y, dx:Math.cos(ang+j*0.2)*22, dy:Math.sin(ang+j*0.2)*22, type:'shotgun', life:15, dmg:w.d});
        } else {
            projectiles.push({x:p.x, y:p.y, dx:Math.cos(ang)*24, dy:Math.sin(ang)*24, type:G.weapon, life:100, dmg:w.d});
        }
        
        w.a--; if(w.a <= 0) p.rel = true;
    }
}

function update() {
    if(!G.play || !p.alive) return;

    // Movimento Prioridade Teclado/Joy
    let mx = joy.active ? joy.x : (keys.has('a')?-1:keys.has('d')?1:0);
    let my = joy.active ? joy.y : (keys.has('w')?-1:keys.has('s')?1:0);
    p.x = Math.max(60, Math.min(G.w-60, p.x + mx * p.speed));
    p.y = Math.max(60, Math.min(G.h-60, p.y + my * p.speed));

    let ax = (keys.has('arrowleft')?-1:keys.has('arrowright')?1:0);
    let ay = (keys.has('arrowup')?-1:keys.has('arrowdown')?1:0);
    if(mobAtk.up) ay=-1; if(mobAtk.down) ay=1; if(mobAtk.left) ax=-1; if(mobAtk.right) ax=1;

    if(ax || ay) { p.rot = Math.atan2(ay, ax); fire(ax, ay); }
    else if(mx || my) { p.rot = Math.atan2(my, mx); }

    if(mx||my) p.leg += 0.3;
    if(p.rel) { p.relT++; if(p.relT > 45){ G.inv[G.weapon].a = G.inv[G.weapon].m; p.rel=false; p.relT=0; }}

    enemies.forEach((e, i) => {
        let ang = Math.atan2(p.y-e.y, p.x-e.x);
        e.x += Math.cos(ang) * e.spd; e.y += Math.sin(ang) * e.spd;
        if(Math.hypot(p.x-e.x, p.y-e.y) < p.r + e.r && p.iframe <= 0) { G.hp -= e.dmg; p.iframe=40; }
    });

    projectiles.forEach((pr, i) => {
        pr.x += pr.dx; pr.y += pr.dy; pr.life--;
        enemies.forEach((e, ei) => {
            if(Math.hypot(pr.x-e.x, pr.y-e.y) < e.r + 20) {
                e.hp -= pr.dmg; projectiles.splice(i, 1);
                if(e.hp <= 0) {
                    if(Math.random() < 0.2) drops.push({x: e.x, y: e.y, type: Math.random() < 0.5 ? 'hp' : 'ammo'});
                    enemies.splice(ei, 1); G.kills++;
                }
            }
        });
        if(pr.life <= 0) projectiles.splice(i, 1);
    });

    drops.forEach((d, i) => {
        if(Math.hypot(p.x-d.x, p.y-d.y) < 50) {
            if(d.type === 'hp') G.hp = Math.min(G.maxHp, G.hp+2);
            else G.inv[G.weapon].a = G.inv[G.weapon].m;
            drops.splice(i,1);
        }
    });

    if(p.iframe > 0) p.iframe--;
    if(G.hp <= 0) p.alive = false, document.getElementById('death-screen').style.display='flex';
    p.t++;
}

function draw() {
    ctx.clearRect(0,0, canvas.width, canvas.height);
    if(!G.play) return;

    ctx.save();
    G.cx += (p.x - canvas.width/2 - G.cx) * 0.1;
    G.cy += (p.y - canvas.height/2 - G.cy) * 0.1;
    ctx.translate(-G.cx, -G.cy);

    // ChÃ£o Dungeon
    ctx.fillStyle = "#1a1a2e"; ctx.fillRect(0,0, G.w, G.h);
    ctx.strokeStyle="rgba(0,234,255,0.1)";
    for(let i=0; i<G.w; i+=120) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,G.h); ctx.stroke(); }

    // Lorde da Luz
    let ly = Math.sin(p.leg)*10;
    ctx.fillStyle="#fff"; ctx.fillRect(p.x-15, p.y+20+ly, 10, 12); ctx.fillRect(p.x+5, p.y+20-ly, 10, 12);
    ctx.shadowBlur = 20; ctx.shadowColor = "#00eaff";
    ctx.fillStyle = (p.iframe>0 && p.t%4<2) ? "#ff0000" : "#fff";
    ctx.fillRect(p.x-25, p.y-35, 50, 60); 
    ctx.shadowBlur = 0;
    
    // Olhos Lorde da Luz
    ctx.fillStyle="#000"; ctx.fillRect(p.x-15, p.y-15, 8, 8); ctx.fillRect(p.x+7, p.y-15, 8, 8);

    // Inimigos com OLHOS DIFERENTES
    enemies.forEach(e => {
        ctx.fillStyle = e.color; 
        ctx.fillRect(e.x-e.r, e.y-e.r, e.r*2, e.r*2);
        
        ctx.fillStyle = "#fff"; // Fundo do olho
        if(e.type === 'stalker') { // Olhos redondos simples
            ctx.beginPath(); ctx.arc(e.x-10, e.y-5, 6, 0, 7); ctx.arc(e.x+10, e.y-5, 6, 0, 7); ctx.fill();
            ctx.fillStyle="#000"; ctx.beginPath(); ctx.arc(e.x-10, e.y-5, 3, 0, 7); ctx.arc(e.x+10, e.y-5, 3, 0, 7); ctx.fill();
        } else if(e.type === 'kamikaze') { // Olhos de raiva (v)
            ctx.fillStyle="yellow";
            ctx.beginPath(); ctx.moveTo(e.x-15, e.y-10); ctx.lineTo(e.x-5, e.y-2); ctx.lineTo(e.x-15, e.y+2); ctx.fill();
            ctx.beginPath(); ctx.moveTo(e.x+15, e.y-10); ctx.lineTo(e.x+5, e.y-2); ctx.lineTo(e.x+15, e.y+2); ctx.fill();
        } else if(e.type === 'tank') { // Um Ãºnico olho grande central
            ctx.beginPath(); ctx.arc(e.x, e.y-5, 12, 0, 7); ctx.fill();
            ctx.fillStyle="red"; ctx.beginPath(); ctx.arc(e.x, e.y-5, 5, 0, 7); ctx.fill();
        }
    });

    projectiles.forEach(pr => {
        ctx.fillStyle = G.inv[pr.type]?.c;
        ctx.beginPath(); ctx.arc(pr.x, pr.y, 10, 0, 7); ctx.fill();
    });

    drops.forEach(d => {
        ctx.fillStyle = d.type==='hp'?"#ff4d6d":"#f1c40f";
        ctx.fillRect(d.x-15, d.y-15, 30, 30);
    });

    ctx.restore();
    
    // HUD Rebalanceada
    ctx.fillStyle="rgba(0,0,0,0.5)"; ctx.fillRect(10, 10, 300, 80);
    ctx.fillStyle="#fff"; ctx.font="bold 20px Arial";
    ctx.fillText(`HP: ${G.hp} / ${G.maxHp}`, 25, 40);
    ctx.fillText(`${G.inv[G.weapon].n}: ${G.inv[G.weapon].a}`, 25, 70);

    requestAnimationFrame(() => { update(); draw(); });
}

function spawn() {
    if(!G.play || enemies.length > 12) return;
    let type = Math.random() < 0.6 ? 'stalker' : (Math.random() < 0.8 ? 'kamikaze' : 'tank');
    let e = { type: type, x: Math.random()*G.w, y: Math.random()*G.h, r: 30, hp: 40, spd: 3, dmg: 1, color: "#34495e" };
    
    if(type === 'kamikaze') { e.color = "#e67e22"; e.spd = 5.5; e.hp = 20; e.dmg = 3; }
    if(type === 'tank') { e.color = "#2c3e50"; e.spd = 1.5; e.hp = 150; e.r = 45; e.dmg = 2; }
    
    if(Math.hypot(p.x-e.x, p.y-e.y) > 400) enemies.push(e);
}
setInterval(spawn, 1500);

window.onkeydown=e=>{ keys.add(e.key.toLowerCase()); if(e.key==='q') swap(); };
window.onkeyup=e=>keys.delete(e.key.toLowerCase());
document.getElementById('btn-play').onclick = () => { G.play=true; document.getElementById('start-screen').style.display='none'; draw(); };
function swap() {
    let l = Object.keys(G.inv);
    G.weapon = l[(l.indexOf(G.weapon)+1)%l.length];
}
function toggleFS() { if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
window.onresize = () => { canvas.width=window.innerWidth; canvas.height=window.innerHeight; }; window.onresize();

// Joystick
const knob=document.getElementById('joy-stick'), base=document.getElementById('joy-base');
base.ontouchstart = (e) => { joy.active=true; let r=base.getBoundingClientRect(); joy.sx=r.left+70; joy.sy=r.top+70; };
base.ontouchmove = (e) => {
    if(!joy.active) return; let t=e.touches[0];
    let dx=t.clientX-joy.sx, dy=t.clientY-joy.sy;
    let d=Math.min(Math.hypot(dx,dy), 50); let a=Math.atan2(dy,dx);
    joy.x=(Math.cos(a)*d)/50; joy.y=(Math.sin(a)*d)/50;
    knob.style.transform=`translate(${Math.cos(a)*d}px, ${Math.sin(a)*d}px)`;
};
base.ontouchend = () => { joy.active=false; joy.x=0; joy.y=0; knob.style.transform='none'; };
document.querySelectorAll('.btn-atk').forEach(b => {
    b.ontouchstart=(e)=>{ e.preventDefault(); mobAtk[b.dataset.dir]=true; };
    b.ontouchend=(e)=>{ e.preventDefault(); mobAtk[b.dataset.dir]=false; };
});
</script>
</body>
</html>
