<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Den of Shadow ðŸ’€</title>
    <style>
        :root {
            --comum: #3498db; --incomum: #2ecc71; --raro: #f1c40f; 
            --epico: #9b59b6; --lendario: linear-gradient(45deg, #ff0, #f0f, #0ff, #f00);
        }
        * { touch-action: none; user-select: none; box-sizing: border-box; }
        body { margin: 0; background: #1a1a2e; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        canvas { display: block; image-rendering: pixelated; }

        /* MENU & UI */
        .screen { position: absolute; inset: 0; background: rgba(10,10,30,0.95); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .title-card { border: 5px solid #fff; padding: 30px; background: rgba(231,76,60,0.1); border-radius: 20px; box-shadow: 0 0 40px #e74c3c; margin-bottom: 20px; }
        .title-card h1 { font-size: 60px; color: #e74c3c; margin: 0; text-shadow: 2px 2px #000; }
        
        .save-grid { display: flex; gap: 20px; margin: 20px 0; }
        .slot { width: 110px; height: 110px; border: 3px solid #555; background: #0a0a1a; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 10px; }
        .slot.active { border-color: #2ecc71; box-shadow: 0 0 20px #2ecc71; transform: scale(1.1); }
        .slot span { font-size: 11px; color: #888; margin-top: 5px; }

        /* HUD & MOBILE */
        #mobile-hud { position: absolute; inset: 0; pointer-events: none; display: none; }
        #joy-base { position: absolute; bottom: 50px; left: 50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid #fff; pointer-events: auto; }
        #joy-stick { position: absolute; width: 60px; height: 60px; background: #fff; border-radius: 50%; left: 45px; top: 45px; box-shadow: 0 0 15px #fff; }
        #atk-grid { position: absolute; bottom: 50px; right: 50px; display: grid; grid-template-columns: repeat(3, 90px); gap: 15px; pointer-events: auto; }
        .btn-m { width: 90px; height: 90px; background: rgba(255,255,255,0.1); border: 4px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; color: #fff; }
        #swap-btn { position: absolute; bottom: 60px; right: 380px; width: 100px; height: 100px; background: #f1c40f; border-radius: 20px; border: 4px solid #fff; pointer-events: auto; color: #000; font-weight: bold; }
        #fs-btn { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); padding: 12px 30px; background: #333; color: #fff; border: 2px solid #fff; border-radius: 30px; pointer-events: auto; z-index: 2500; font-weight: bold; }

        /* CARDS */
        .card-box { display: flex; gap: 20px; padding: 20px; justify-content: center; }
        .card { width: 250px; height: 360px; background: #0f172a; border: 5px solid #fff; border-radius: 20px; position: relative; cursor: pointer; transition: 0.3s; padding: 20px; overflow: hidden; }
        .card::after { content: 'ðŸ’€'; position: absolute; bottom: -20px; right: -20px; font-size: 150px; opacity: 0.05; }
        
        #boss-bar { position: absolute; top: 80px; left: 50%; transform: translateX(-50%); width: 70%; height: 25px; border: 3px solid #fff; background: #000; display: none; border-radius: 15px; overflow: hidden; }
        #boss-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #f00, #900); }
    </style>
</head>
<body>

<div id="fs-btn" onclick="toggleFS()">TELA CHEIA</div>

<div id="start-screen" class="screen">
    <div class="title-card">
        <h1>Den of Shadow ðŸ’€</h1>
    </div>
    <div id="platform-hint" style="color: #f1c40f; margin-bottom: 20px;"></div>
    
    <div class="save-grid">
        <div class="slot active" onclick="selectSlot(0)" id="slot-0">SLOT 1<span id="s0-info">Vazio</span></div>
        <div class="slot" onclick="selectSlot(1)" id="slot-1">SLOT 2<span id="s1-info">Vazio</span></div>
        <div class="slot" onclick="selectSlot(2)" id="slot-2">SLOT 3<span id="s2-info">Vazio</span></div>
    </div>

    <button style="padding: 20px 60px; background: #2ecc71; border: none; border-radius: 50px; color: #fff; font-size: 24px; font-weight: bold; cursor: pointer;" onclick="initGame()">INICIAR JOGO</button>
    
    <div style="margin-top: 40px;">
        <a href="mailto:kauadarthofc@gmail.com" style="color: #fff; text-decoration: none;">ðŸ“§ kauadarthofc@gmail.com</a><br><br>
        <a href="https://youtube.com/@kaua_darth" target="_blank" style="color: #ff0000; text-decoration: none; font-weight: bold;">ðŸŽ¬ @kaua_darth</a>
    </div>
</div>

<div id="upgrade-screen" class="screen" style="display:none;">
    <h2 style="color: #f1c40f; font-size: 40px;">UPGRADE ENCONTRADO</h2>
    <div id="card-container" class="card-box"></div>
</div>

<div id="boss-bar"><div id="boss-fill"></div></div>
<canvas id="gameCanvas"></canvas>

<div id="mobile-hud">
    <div id="joy-base"><div id="joy-stick"></div></div>
    <div id="atk-grid">
        <div></div><div class="btn-m" id="btn-up">â–²</div><div></div>
        <div class="btn-m" id="btn-left">â—€</div><div class="btn-m" id="btn-down">â–¼</div><div class="btn-m" id="btn-right">â–¶</div>
    </div>
    <button id="swap-btn">SWAP ðŸ”„</button>
</div>

<script>
/** @type {HTMLCanvasElement} */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const isMob = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

// --- CONFIGURAÃ‡ÃƒO ---
let G = {
    play: false, slot: 0, room: 0, coins: 0,
    hp: 12, maxHp: 12, weapon: 'magnum',
    w: 2600, h: 1800, cx: 0, cy: 0,
    inv: {
        magnum: { n: "Magnum", a: 20, m: 20, d: 15, cd: 20, c: "#00eaff" },
        fire: { n: "LanÃ§a-Chamas", a: 50, m: 50, d: 4, burn: 2, cd: 2, c: "#ff6a00" },
        shotgun: { n: "Shotgun", a: 8, m: 8, d: 12, cd: 70, c: "#f1c40f" },
        staff: { n: "Cajado MÃ­stico", a: 15, m: 15, d: 6, cd: 35, c: "#9b59b6" }
    },
    upgrades: { triple: 0, ric: 0, dual: false, vamp: 0 },
    hasFire: false, hasShot: false, hasStaff: false
};

let p = { x: 1300, y: 900, r: 50, spd: 9, rot: 0, leg: 0, iframe: 0, rel: false, relT: 0, isAtk: false, t:0, alive: true };
let enemies = [], projectiles = [], drops = [], objects = [], warns = [];
const keys = new Set();
const mobAtk = { up: false, down: false, left: false, right: false };
const joy = { active: false, x: 0, y: 0 };

// --- SISTEMA DE SALVAMENTO ---
function selectSlot(i) {
    G.slot = i;
    document.querySelectorAll('.slot').forEach(s => s.classList.remove('active'));
    document.getElementById(`slot-${i}`).classList.add('active');
}

function save() {
    localStorage.setItem(`dos_save_${G.slot}`, JSON.stringify({ room: G.room, hasFire: G.hasFire, hasShot: G.hasShot, hasStaff: G.hasStaff, maxHp: G.maxHp }));
}

function initGame() {
    document.getElementById('start-screen').style.display = 'none';
    if(isMob) document.getElementById('mobile-hud').style.display = 'block';
    G.play = true;
    spawnRoom();
    loop();
}

// --- MECÃ‚NICAS ---
function spawnRoom() {
    enemies = []; projectiles = []; objects = []; warns = [];
    if(G.room === 0) return; // Tutorial

    if(G.room % 10 === 0) {
        let hp = 1500 + (G.room * 200);
        enemies.push({ type: 'boss', x: G.w/2, y: G.h/2-300, r: 180, hp: hp, mhp: hp, t: 0, hit: 0 });
        document.getElementById('boss-bar').style.display = 'block';
    } else {
        let count = 5 + Math.floor(G.room/2);
        for(let i=0; i<count; i++) {
            let x, y;
            do { x = Math.random()*G.w; y = Math.random()*G.h; } while(Math.hypot(x-p.x, y-p.y) < 700);
            let t = G.room === 1 ? 'stalker' : (Math.random() < 0.2 ? 'kamikaze' : (Math.random() < 0.3 ? 'dasher' : 'stalker'));
            enemies.push({ type: t, x, y, r: 55, hp: 100 + G.room*10, spd: (t==='kamikaze'?1.5:2.5), hit: 0, f: Math.floor(Math.random()*4), dt: 0 });
        }
    }

    // Gerar BaÃºs
    if(Math.random() < 0.4) objects.push({ x: Math.random()*G.w, y: Math.random()*G.h, type: 'chest', r: 60 });
}

function shoot(dx, dy) {
    let w = G.inv[G.weapon];
    if(p.rel || w.a <= 0 || !p.alive) return;

    if(p.t % w.cd === 0) {
        p.rot = Math.atan2(dy, dx);
        p.isAtk = true;
        
        let n = (1 + G.upgrades.triple);
        for(let i=0; i<n; i++) {
            let a = p.rot + (i - (n-1)/2) * 0.2;
            if(G.weapon === 'fire') {
                for(let j=0; j<2; j++) projectiles.push({ x: p.x, y: p.y, dx: Math.cos(a+(Math.random()-0.5)*0.4)*22, dy: Math.sin(a+(Math.random()-0.5)*0.4)*22, type: 'fire', life: 15, dmg: 4 });
            } else if(G.weapon === 'shotgun') {
                for(let j=-1; j<=1; j++) projectiles.push({ x: p.x, y: p.y, dx: Math.cos(a+j*0.3)*25, dy: Math.sin(a+j*0.3)*25, type: 'shotgun', life: 12, dmg: 17 });
            } else if(G.weapon === 'staff') {
                projectiles.push({ x: p.x, y: p.y, dx: Math.cos(a)*15, dy: Math.sin(a)*15, type: 'staff', life: 120, dmg: 6, home: true });
            } else {
                projectiles.push({ x: p.x, y: p.y, dx: Math.cos(a)*28, dy: Math.sin(a)*28, type: 'magnum', life: 80, dmg: 15 });
            }
        }
        w.a--; if(w.a <= 0) p.rel = true;
    }
}

function update() {
    if(!G.play || !p.alive) return;

    // Movimento Player
    let mx = 0, my = 0;
    if(keys.has('a')) mx = -1; if(keys.has('d')) mx = 1;
    if(keys.has('w')) my = -1; if(keys.has('s')) my = 1;
    if(joy.active) { mx = joy.x; my = joy.y; }

    p.x = Math.max(60, Math.min(G.w-60, p.x + mx * p.spd));
    p.y = Math.max(60, Math.min(G.h-60, p.y + my * p.spd));

    // Ataque & RotaÃ§Ã£o
    let ax = 0, ay = 0;
    if(keys.has('arrowleft')) ax = -1; if(keys.has('arrowright')) ax = 1;
    if(keys.has('arrowup')) ay = -1; if(keys.has('arrowdown')) ay = 1;
    if(mobAtk.up) ay = -1; if(mobAtk.down) ay = 1; if(mobAtk.left) ax = -1; if(mobAtk.right) ax = 1;

    if(ax !== 0 || ay !== 0) {
        shoot(ax, ay);
    } else if(mx !== 0 || my !== 0) {
        p.rot = Math.atan2(my, mx);
        p.leg += 0.25;
    }

    if(p.rel) { p.relT++; if(p.relT > 60) { G.inv[G.weapon].a = G.inv[G.weapon].m; p.rel = false; p.relT = 0; } }

    // Inimigos
    enemies.forEach((e, i) => {
        let dist = Math.hypot(p.x-e.x, p.y-e.y);
        let ang = Math.atan2(p.y-e.y, p.x-e.x);

        if(e.type === 'boss') {
            e.t++; e.x += Math.cos(e.t/50)*5;
            if(e.t % 100 === 0) warns.push({ x: p.x, y: p.y, t: 90 });
            document.getElementById('boss-fill').style.width = (e.hp/e.mhp)*100 + "%";
        } else {
            let s = e.spd;
            if(e.type === 'dasher') { e.dt++; if(e.dt>80){ s=15; if(e.dt>95)e.dt=0; } }
            e.x += Math.cos(ang)*s; e.y += Math.sin(ang)*s;
        }

        // ColisÃ£o Player (EmpurrÃ£o)
        if(dist < p.r + e.r) {
            let kb = Math.atan2(e.y-p.y, e.x-p.x);
            e.x += Math.cos(kb)*40; e.y += Math.sin(kb)*40;
            if(p.iframe <= 0) { G.hp -= (e.type==='kamikaze'?2:1); p.iframe=60; if(e.type==='kamikaze') e.hp=0; }
        }

        if(e.hp <= 0) {
            if(e.type === 'kamikaze') {
                enemies.forEach(o => { if(Math.hypot(e.x-o.x, e.y-o.y) < 250) o.hp -= 200; });
            }
            if(Math.random() < 0.2) drops.push({ x: e.x, y: e.y, type: 'heal' });
            if(e.type === 'boss') { 
                document.getElementById('boss-bar').style.display='none'; 
                G.room++; spawnRoom(); // Aqui pode abrir a sala de cura
            }
            enemies.splice(i, 1);
        }
        if(e.hit > 0) e.hit--;
    });

    // ProjÃ©teis
    projectiles.forEach((pr, i) => {
        if(pr.home) {
            let t = enemies[0];
            if(t) { let ta = Math.atan2(t.y-pr.y, t.x-pr.x); pr.dx += Math.cos(ta)*0.8; pr.dy += Math.sin(ta)*0.8; }
        }
        pr.x += pr.dx; pr.y += pr.dy; pr.life--;
        enemies.forEach(e => {
            if(Math.hypot(pr.x-e.x, pr.y-e.y) < e.r + 20) {
                e.hp -= pr.dmg; e.hit = 10;
                projectiles.splice(i, 1);
            }
        });
        if(pr.life <= 0) projectiles.splice(i, 1);
    });

    // Itens
    drops.forEach((d, i) => {
        if(Math.hypot(p.x-d.x, p.y-d.y) < 70) {
            if(d.type==='heal') G.hp = Math.min(G.maxHp, G.hp+2);
            drops.splice(i, 1);
        }
    });

    if(p.iframe > 0) p.iframe--;
    if(G.hp <= 0) p.alive = false;
    p.t++;
}

// --- RENDER ---
function draw() {
    ctx.clearRect(0,0, canvas.width, canvas.height);
    if(!G.play) return;

    ctx.save();
    G.cx += (p.x - canvas.width/2 - G.cx) * 0.1;
    G.cy += (p.y - canvas.height/2 - G.cy) * 0.1;
    ctx.translate(-G.cx, -G.cy);

    // CenÃ¡rio Profissional
    ctx.fillStyle = "#2c3e50"; ctx.fillRect(0,0, G.w, G.h);
    ctx.strokeStyle="rgba(255,255,255,0.05)";
    for(let i=0; i<G.w; i+=150) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,G.h); ctx.stroke(); }

    // LORDE DA LUZ
    if(p.alive) {
        let ly = Math.sin(p.leg)*15;
        ctx.fillStyle="#fff"; ctx.fillRect(p.x-20, p.y+35+ly, 15, 20); ctx.fillRect(p.x+5, p.y+35-ly, 15, 20);
        ctx.shadowBlur = 30; ctx.shadowColor = "#00eaff";
        ctx.fillStyle = (p.iframe>0 && p.t%4<2)?"#f00":"#fff";
        ctx.fillRect(p.x-45, p.y-55, 90, 100); ctx.shadowBlur = 0;
        
        // Arma
        ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
        ctx.fillStyle="#7f8c8d"; ctx.fillRect(40, -10, 50, 25); ctx.restore();
    }

    // Inimigos
    enemies.forEach(e => {
        ctx.fillStyle = e.hit>0?"#fff":(e.type==='kamikaze'?"#c0392b":"#2c3e50");
        ctx.fillRect(e.x-e.r, e.y-e.r, e.r*2, e.r*2);
        ctx.fillStyle=e.type==='kamikaze'?"#f00":"#000"; ctx.font="30px Arial";
        ctx.fillText(e.type==='kamikaze'?"Ã²_Ã³":["o_o","-_-",">_<"][e.f], e.x-25, e.y+10);
    });

    projectiles.forEach(pr => { ctx.fillStyle=G.inv[pr.type].c; ctx.beginPath(); ctx.arc(pr.x, pr.y, 15, 0, 7); ctx.fill(); });
    drops.forEach(d => { ctx.fillStyle="#ff4d6d"; ctx.fillRect(d.x-25, d.y-25, 50, 50); });

    ctx.restore();

    // MINIMAPA
    const mx=canvas.width-220, my=20, ms=200;
    ctx.fillStyle="rgba(0,0,0,0.8)"; ctx.fillRect(mx, my, ms, ms);
    enemies.forEach(e => { ctx.fillStyle="red"; ctx.fillRect(mx+(e.x/G.w)*ms, my+(e.y/G.h)*ms, 5, 5); });
    ctx.fillStyle="#00eaff"; ctx.fillRect(mx+(p.x/G.w)*ms, my+(p.y/G.h)*ms, 8, 8);

    // HUD
    ctx.fillStyle="#fff"; ctx.font="bold 24px Arial";
    ctx.fillText(`SALA: ${G.room} | ${G.inv[G.weapon].n}: ${G.inv[G.weapon].a}/${G.inv[G.weapon].m}`, 30, 50);
    for(let i=0; i<G.hp/2; i++) ctx.fillText('â¤ï¸', 30 + i*35, 90);
}

function loop() { update(); draw(); requestAnimationFrame(loop); }

// --- CONTROLES ---
const jStick=document.getElementById('joy-stick'), jBase=document.getElementById('joy-base');
jBase.ontouchstart = () => joy.active = true;
jBase.ontouchmove = (e) => {
    let t = e.touches[0]; let r = jBase.getBoundingClientRect();
    let dx = t.clientX - (r.left+75), dy = t.clientY - (r.top+75);
    let d = Math.min(Math.hypot(dx,dy), 55); let a = Math.atan2(dy,dx);
    joy.x = (Math.cos(a)*d)/55; joy.y = (Math.sin(a)*d)/55;
    jStick.style.transform = `translate(${Math.cos(a)*d}px, ${Math.sin(a)*d}px)`;
};
jBase.ontouchend = () => { joy.active=false; joy.x=0; joy.y=0; jStick.style.transform='none'; };

document.querySelectorAll('.btn-m').forEach(b => {
    let d = b.id.split('-')[1];
    b.ontouchstart = (e) => { e.preventDefault(); mobAtk[d]=true; };
    b.ontouchend = (e) => { e.preventDefault(); mobAtk[d]=false; };
});

window.onkeydown=e=>keys.add(e.key.toLowerCase());
window.onkeyup=e=>keys.delete(e.key.toLowerCase());
function toggleFS() { if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
window.onresize = () => { canvas.width=window.innerWidth; canvas.height=window.innerHeight; }; window.onresize();

if(!isMob) document.getElementById('platform-hint').innerText = "WASD: Mover | SETAS: Atirar | Q: Trocar Arma";
</script>
</body>
</html>   

// --- SISTEMA DE 15 ARMAS E CLASSES ---
G.weaponsData = {
    // PISTOLAS (Azul/Comum)
    magnum: { n: "Magnum", d: 15, m: 20, a: 20, cd: 20, r: 'comum', type: 'pistol', desc: "Pistola padrÃ£o de luz." },
    dual_glocks: { n: "Glocks Duplas", d: 8, m: 40, a: 40, cd: 8, r: 'incomum', type: 'dual', desc: "CadÃªncia altÃ­ssima." },
    revolver_gold: { n: "RevÃ³lver Dourado", d: 45, m: 6, a: 6, cd: 50, r: 'raro', type: 'pistol', desc: "Lento, mas fatal." },

    // LANÃ‡A-CHAMAS / BAFORADAS (Laranja/Queima)
    fire_breath: { n: "Sopro de DragÃ£o", d: 4, burn: 2, m: 50, a: 50, cd: 2, r: 'incomum', type: 'flame', desc: "Dano de fogo contÃ­nuo." },
    acid_spreader: { n: "Espalhador de Ãcido", d: 3, burn: 5, m: 40, a: 40, cd: 4, r: 'raro', type: 'flame', desc: "Derrete armaduras." },
    plasma_thrower: { n: "LanÃ§a-Plasma", d: 10, m: 30, a: 30, cd: 5, r: 'epico', type: 'flame', desc: "Fogo azul devastador." },

    // ESPINGARDAS (Amarelo/Impacto)
    shotgun: { n: "Shotgun Velha", d: 12, m: 8, a: 8, cd: 60, r: 'comum', type: 'shotgun', desc: "3 tiros, alcance curto." },
    boomstick: { n: "Boomstick", d: 25, m: 2, a: 2, cd: 80, r: 'raro', type: 'shotgun', desc: "Joga inimigos para longe." },
    hydra: { n: "Hydra", d: 15, m: 12, a: 12, cd: 40, r: 'epico', type: 'shotgun', desc: "5 tiros em leque." },

    // CAJADOS (Roxo/MÃ¡gico)
    magic_staff: { n: "Cajado de PÃ©rola", d: 6, m: 15, a: 15, cd: 30, r: 'raro', type: 'staff', desc: "Tiros teleguiados." },
    void_wand: { n: "Varinha do Vazio", d: 20, m: 10, a: 10, cd: 45, r: 'epico', type: 'staff', desc: "Atravessa paredes e inimigos." },
    god_staff: { n: "Cajado Divino", d: 35, m: 5, a: 5, cd: 60, r: 'lendario', type: 'staff', desc: "RelÃ¢mpagos que buscam alvos." },

    // ESPECIAIS (Arco-Ã­ris/LendÃ¡rio)
    minigun: { n: "Minigun de Luz", d: 5, m: 100, a: 100, cd: 3, r: 'epico', type: 'heavy', desc: "Chuva de balas." },
    crossbow: { n: "Besta de PrecisÃ£o", d: 80, m: 1, a: 1, cd: 100, r: 'raro', type: 'bow', desc: "Dano massivo num sÃ³ tiro." },
    shadow_fury: { n: "FÃºria das Sombras", d: 25, m: 30, a: 30, cd: 15, r: 'lendario', type: 'dual', desc: "Arma suprema do Lorde." }
};

// --- SISTEMA DE LOJA (SALA 11, 22, 33...) ---
function checkShop() {
    if (G.room > 0 && G.room % 11 === 0) {
        G.mode = 'shop';
        enemies = [];
        // Gera 3 armas aleatÃ³rias para vender
        G.shopInventory = [];
        let keys = Object.keys(G.weaponsData);
        for(let i=0; i<3; i++) {
            let weaponKey = keys[Math.floor(Math.random() * keys.length)];
            G.shopInventory.push({ key: weaponKey, price: Math.floor(Math.random() * 50) + 20 });
        }
        spawnShopNPC();
    }
}

// --- SISTEMA DE BAÃšS E DROPS ---
function openChest(chest) {
    let rng = Math.random();
    if (rng < 0.4) {
        G.coins += Math.floor(Math.random() * 20) + 10;
        spawnText(chest.x, chest.y, "MOEDAS!");
    } else if (rng < 0.7) {
        G.inv[G.weapon].a = G.inv[G.weapon].m;
        spawnText(chest.x, chest.y, "MUNIÃ‡ÃƒO!");
    } else {
        G.hp = Math.min(G.maxHp, G.hp + 2);
        spawnText(chest.x, chest.y, "CURA!");
    }
    // Pequena chance (5%) de dropar uma arma aleatÃ³ria do baÃº
    if (Math.random() < 0.05) {
        spawnWeaponDrop(chest.x, chest.y);
    }
}

// --- RENDERIZAÃ‡ÃƒO DAS ARMAS (SPRITES) ---
function drawWeaponSprite(x, y, weapon, rot) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rot);
    
    let color = getRarityColor(weapon.r);
    ctx.strokeStyle = "#000";
    ctx.lineWidth = 2;

    switch(weapon.type) {
        case 'pistol':
            ctx.fillStyle = "#7f8c8d"; ctx.fillRect(45, -8, 35, 18); // Cano
            ctx.fillStyle = "#34495e"; ctx.fillRect(40, -5, 15, 25); // Cabo
            break;
        case 'flame':
            ctx.fillStyle = "#e67e22"; ctx.fillRect(40, -15, 60, 30); // Tanque
            ctx.fillStyle = "#d35400"; ctx.fillRect(90, -10, 20, 20); // Bico
            break;
        case 'shotgun':
            ctx.fillStyle = "#5d4037"; ctx.fillRect(40, -10, 70, 22); // Madeira
            ctx.fillStyle = "#2c3e50"; ctx.fillRect(60, -12, 55, 12); // Cano duplo
            break;
        case 'staff':
            ctx.fillStyle = "#8e44ad"; ctx.fillRect(40, -6, 75, 12); // BastÃ£o
            ctx.shadowBlur = 15; ctx.shadowColor = color;
            ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(115, 0, 15, 0, 7); ctx.fill(); // PÃ©rola
            break;
    }
    ctx.restore();
}

function getRarityColor(rarity) {
    switch(rarity) {
        case 'comum': return '#3498db';
        case 'incomum': return '#2ecc71';
        case 'raro': return '#f1c40f';
        case 'epico': return '#9b59b6';
        case 'lendario': return '#e74c3c';
        default: return '#fff';
    }
}
