<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Capivaras vs Estudantes Zumbis</title>
    <style>
        :root {
            --bg: #1e1e26;
            --grid-bg: #2d2d3a;
            --slot-empty: rgba(255, 255, 255, 0.05);
            --defense-line: #3a3a4d;
        }
        body {
            margin: 0;
            background: var(--bg);
            color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
        }

        #game-header {
            padding: 20px;
            text-align: center;
        }

        /* Container Principal */
        #game-world {
            display: flex;
            gap: 30px;
            background: #252531;
            padding: 20px;
            border-radius: 20px;
            border: 4px solid #444;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
        }

        /* Grade de Invent√°rio/Merge */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 80px);
            grid-template-rows: repeat(3, 80px);
            gap: 10px;
            background: var(--grid-bg);
            padding: 15px;
            border-radius: 12px;
        }

        /* Linha de Defesa (Onde o player coloca as capis) */
        #defense-slots {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            background: var(--defense-line);
            padding: 10px;
            border-radius: 12px;
            border-right: 5px dashed #555;
        }

        /* Campo de Batalha (Onde os estudantes andam) */
        #battle-field {
            width: 350px;
            height: 300px;
            background: #1a1a24;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
        }

        .slot {
            width: 80px;
            height: 80px;
            background: var(--slot-empty);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid transparent;
        }
        .slot.drag-over { border-color: #ffd700; background: rgba(255,215,0,0.1); }

        /* Sprites */
        .capi {
            width: 60px;
            height: 60px;
            cursor: grab;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            position: relative;
            transition: transform 0.2s;
            image-rendering: pixelated;
        }
        .capi:active { cursor: grabbing; }
        .capi-lvl {
            position: absolute;
            bottom: -5px;
            background: #000;
            color: gold;
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 5px;
        }

        .student {
            position: absolute;
            font-size: 40px;
            right: -50px;
            transition: right 0.05s linear;
        }

        .bullet {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffec3d;
            border-radius: 50%;
            box-shadow: 0 0 10px #fadb14;
        }

        #buy-area { margin-top: 20px; }
        #buy-btn {
            background: #52c41a;
            border: none;
            color: white;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="game-header">
        <h1>Capivara Defense: School Breakout üè´</h1>
        <h2>üí∞ Moedas: <span id="coin-txt">100</span></h2>
    </div>

    <div id="game-world">
        <div class="grid-container" id="inventory">
            <div class="slot merge-slot"></div><div class="slot merge-slot"></div><div class="slot merge-slot"></div>
            <div class="slot merge-slot"></div><div class="slot merge-slot"></div><div class="slot merge-slot"></div>
            <div class="slot merge-slot"></div><div class="slot merge-slot"></div><div class="slot merge-slot"></div>
        </div>

        <div id="defense-slots">
            <div class="slot combat-slot" data-row="0"></div>
            <div class="slot combat-slot" data-row="1"></div>
            <div class="slot combat-slot" data-row="2"></div>
        </div>

        <div id="battle-field"></div>
    </div>

    <div id="buy-area">
        <button id="buy-btn">COMPRAR CAPIVARA (20üí∞)</button>
    </div>

    <script>
        const CAPI_DATA = {
            1: { emoji: 'üêπ', power: 10 },
            2: { emoji: 'ü¶¶', power: 25 },
            3: { emoji: 'ü¶´', power: 60 },
            4: { emoji: 'üêæ', power: 150 }
        };

        let coins = 100;
        let draggedElement = null;

        // --- SISTEMA DE ARRASTAR E SOLTAR ---
        function setupDraggable(el) {
            el.draggable = true;
            el.ondragstart = (e) => {
                draggedElement = el;
                el.style.opacity = '0.5';
            };
            el.ondragend = () => {
                el.style.opacity = '1';
                draggedElement = null;
            };
        }

        document.querySelectorAll('.slot').forEach(slot => {
            slot.ondragover = e => {
                e.preventDefault();
                slot.classList.add('drag-over');
            };
            slot.ondragleave = () => slot.classList.remove('drag-over');
            
            slot.ondrop = (e) => {
                slot.classList.remove('drag-over');
                const sourceSlot = draggedElement.parentElement;
                
                if (!slot.hasChildNodes()) {
                    // Mover para slot vazio
                    slot.appendChild(draggedElement);
                } else {
                    const targetCapi = slot.firstChild;
                    // L√≥gica de MERGE (Somente se for na grade de invent√°rio ou entre si)
                    if (targetCapi.dataset.level === draggedElement.dataset.level && targetCapi !== draggedElement) {
                        const nextLvl = parseInt(targetCapi.dataset.level) + 1;
                        if (CAPI_DATA[nextLvl]) {
                            targetCapi.remove();
                            draggedElement.remove();
                            const newCapi = createCapi(nextLvl);
                            slot.appendChild(newCapi);
                        }
                    }
                }
            };
        });

        function createCapi(lvl) {
            const div = document.createElement('div');
            div.className = 'capi';
            div.dataset.level = lvl;
            div.innerHTML = `${CAPI_DATA[lvl].emoji} <span class="capi-lvl">Lvl ${lvl}</span>`;
            setupDraggable(div);
            return div;
        }

        // --- COMPRA ---
        document.getElementById('buy-btn').onclick = () => {
            if (coins >= 20) {
                const emptySlot = Array.from(document.querySelectorAll('.merge-slot')).find(s => !s.hasChildNodes());
                if (emptySlot) {
                    coins -= 20;
                    emptySlot.appendChild(createCapi(1));
                    document.getElementById('coin-txt').innerText = coins;
                }
            }
        };

        // --- SISTEMA DE COMBATE ---
        function spawnStudent() {
            const row = Math.floor(Math.random() * 3);
            const student = document.createElement('div');
            student.className = 'student';
            student.innerHTML = 'üßë‚Äçüéì'; // Estudante zumbi
            student.dataset.hp = 100;
            student.dataset.row = row;
            student.style.top = (row * 100 + 20) + 'px';
            document.getElementById('battle-field').appendChild(student);
        }

        function gameLoop() {
            // Mover estudantes
            document.querySelectorAll('.student').forEach(st => {
                let right = parseFloat(st.style.right) || -50;
                st.style.right = (right + 1.5) + 'px';
                if (right > 350) st.remove();
            });

            // Atacar
            document.querySelectorAll('.combat-slot').forEach(slot => {
                if (slot.hasChildNodes()) {
                    const capi = slot.firstChild;
                    const row = slot.dataset.row;
                    const targets = Array.from(document.querySelectorAll('.student'))
                                         .filter(s => s.dataset.row == row);
                    
                    if (targets.length > 0) shoot(slot, targets[0], CAPI_DATA[capi.dataset.level].power);
                }
            });

            if (Math.random() > 0.97) spawnStudent();
        }

        function shoot(slot, target, pwr) {
            const bullet = document.createElement('div');
            bullet.className = 'bullet';
            const field = document.getElementById('battle-field');
            field.appendChild(bullet);

            let bLeft = 0;
            bullet.style.top = (slot.dataset.row * 100 + 45) + 'px';
            bullet.style.left = bLeft + 'px';

            const moveBullet = setInterval(() => {
                bLeft += 8;
                bullet.style.left = bLeft + 'px';

                const targetRight = 350 - parseFloat(target.style.right);
                if (bLeft >= targetRight - 20) {
                    clearInterval(moveBullet);
                    bullet.remove();
                    target.dataset.hp -= pwr;
                    if (target.dataset.hp <= 0) {
                        target.remove();
                        coins += 10;
                        document.getElementById('coin-txt').innerText = coins;
                    }
                }
                if (bLeft > 350) { clearInterval(moveBullet); bullet.remove(); }
            }, 20);
        }

        setInterval(gameLoop, 100);
    </script>
</body>
</html>
