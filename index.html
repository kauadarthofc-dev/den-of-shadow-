<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Den of Shadow ðŸ’€ Lord of Light</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Nosifer&family=Special+Elite&display=swap');
        
        * { touch-action: none; user-select: none; box-sizing: border-box; outline: none; }
        body { margin: 0; background: #000; color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; }
        canvas { display: block; }

        /* INTERFACES */
        .ui-screen { 
            position: absolute; inset: 0; 
            background: radial-gradient(circle at center, #4a0404 0%, #000000 100%);
            z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        
        #start-screen h1 { font-family: 'Nosifer', cursive; font-size: clamp(30px, 8vw, 70px); color: #ff0000; text-shadow: 0 0 30px #ff0000; }
        .btn-main { padding: 15px 50px; font-size: 20px; background: transparent; border: 2px solid #ff0000; color: #fff; cursor: pointer; font-family: 'Orbitron'; margin: 10px; transition: 0.3s; }
        .btn-main:hover { background: #ff0000; box-shadow: 0 0 40px #ff0000; }

        /* IDIOMA */
        .lang-select { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 4000; }
        .lang-btn { background: rgba(255,0,0,0.2); border: 1px solid #ff0000; color: white; padding: 5px 15px; cursor: pointer; font-family: 'Orbitron'; }
        .lang-btn.active { background: #ff0000; box-shadow: 0 0 10px #ff0000; }

        /* CUTSCENE */
        #cutscene-screen { background: #000; cursor: pointer; text-align: center; padding: 20px; }
        #cutscene-text { font-family: 'Special Elite', cursive; font-size: 26px; color: #ccc; max-width: 800px; line-height: 1.6; }
        
        /* HUD */
        #hud { position: absolute; top: 20px; left: 20px; z-index: 1000; display: none; flex-direction: column; gap: 8px; }
        .stat-container { background: rgba(0,0,0,0.8); padding: 6px; border-left: 3px solid #ff0000; width: 180px; }
        .bar-bg { width: 100%; height: 6px; background: #222; margin-top: 4px; }
        .bar-fill { height: 100%; transition: width 0.2s; }

        .social-footer { position: absolute; bottom: 30px; text-align: center; }
        .social-link { color: #ff0000; text-decoration: none; display: block; margin: 5px; font-size: 14px; }
    </style>
</head>
<body>

<div class="lang-select" id="lang-area">
    <button class="lang-btn active" onclick="changeLang('pt')">PT</button>
    <button class="lang-btn" onclick="changeLang('en')">EN</button>
</div>

<div id="start-screen" class="ui-screen">
    <h1>DEN OF SHADOW</h1>
    <p id="subtitle" style="letter-spacing: 5px; color: #ff0000; margin-bottom: 30px;">LORD OF LIGHT</p>
    <button class="btn-main" id="play-btn" onclick="initCutscene()">JOGAR</button>
    <div class="social-footer">
        <a href="mailto:kauaderthofc@gmail.com" class="social-link">kauaderthofc@gmail.com</a>
        <a href="https://youtube.com/@kaua_darth" target="_blank" class="social-link">YouTube: @kaua_darth</a>
    </div>
</div>

<div id="cutscene-screen" class="ui-screen" style="display:none;" onclick="nextHistory()">
    <div id="cutscene-text"></div>
    <div style="margin-top:40px; color:#444; font-size:12px;" id="hint">CLIQUE PARA CONTINUAR / CLICK TO CONTINUE</div>
</div>

<div id="hud">
    <div class="stat-container"><div id="label-hp">VIDA</div><div class="bar-bg"><div id="hp-fill" class="bar-fill" style="width: 100%; background: #ff0000;"></div></div></div>
    <div class="stat-container" style="border-color:#f1c40f;"><div id="label-ammo">MUNIÃ‡ÃƒO</div><div class="bar-bg"><div id="ammo-fill" class="bar-fill" style="width: 100%; background: #f1c40f;"></div></div></div>
    <div style="font-weight: bold; color: #ff0000;"><span id="label-room">SALA</span>: <span id="room-txt">0</span></div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const ROOM = { w: 1200, h: 800, wallSize: 60 };
const G = { 
    play: false, room: 0, hp: 100, ammo: 20, maxAmmo: 20, 
    reloading: false, enemiesDefeated: false, lang: 'pt' 
};

const texts = {
    pt: {
        sub: "LORDE DA LUZ", play: "JOGAR", hp: "VIDA", ammo: "MUNIÃ‡ÃƒO", room: "SALA",
        tut: "WASD PARA MOVER | SETAS PARA ATIRAR",
        history: [
            "O Lorde da Luz foi traÃ­do por sua prÃ³pria sombra...",
            "Agora ele estÃ¡ preso no abismo mais profundo.",
            "Cada sala Ã© um fragmento de sua mente corrompida.",
            "Tutorial: Use WASD para mover e as SETAS para atirar nas 4 direÃ§Ãµes."
        ]
    },
    en: {
        sub: "LORD OF LIGHT", play: "PLAY", hp: "HEALTH", ammo: "AMMO", room: "ROOM",
        tut: "WASD TO MOVE | ARROWS TO SHOOT",
        history: [
            "The Lord of Light was betrayed by his own shadow...",
            "Now he is trapped in the deepest abyss.",
            "Every room is a fragment of his corrupted mind.",
            "Tutorial: Use WASD to move and ARROWS to shoot in 4 directions."
        ]
    }
};

function changeLang(l) {
    G.lang = l;
    document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase() === l));
    document.getElementById('subtitle').innerText = texts[l].sub;
    document.getElementById('play-btn').innerText = texts[l].play;
    document.getElementById('label-hp').innerText = texts[l].hp;
    document.getElementById('label-ammo').innerText = texts[l].ammo;
    document.getElementById('label-room').innerText = texts[l].room;
}

let historyIndex = 0;
function initCutscene() {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('lang-area').style.display = 'none';
    document.getElementById('cutscene-screen').style.display = 'flex';
    nextHistory();
}

function nextHistory() {
    const h = texts[G.lang].history;
    if (historyIndex < h.length) {
        document.getElementById('cutscene-text').innerText = h[historyIndex];
        historyIndex++;
    } else {
        startGame();
    }
}

let player = { x: 600, y: 400, r: 25, spd: 7 };
let enemies = [], projectiles = [], doors = [];
const keys = {};

function startGame() {
    document.getElementById('cutscene-screen').style.display = 'none';
    document.getElementById('hud').style.display = 'flex';
    G.play = true;
    initRoom();
}

function initRoom() {
    enemies = []; projectiles = []; doors = [];
    G.enemiesDefeated = false;
    player.x = ROOM.w/2; player.y = ROOM.h/2;
    
    if(G.room > 0) {
        let count = 2 + Math.floor(G.room * 0.5);
        for(let i=0; i<count; i++) {
            enemies.push({ 
                x: 200 + Math.random()*(ROOM.w-400), 
                y: 200 + Math.random()*(ROOM.h-400), 
                hp: 40 + G.room*10, r: 30, spd: 1.5 + (G.room * 0.1) 
            });
        }
    } else {
        G.enemiesDefeated = true;
        spawnDoors();
    }
}

function spawnDoors() {
    // Porta Norte
    doors.push({ x: ROOM.w/2 - 60, y: 0, w: 120, h: 65 });
}

function update() {
    if(!G.play) return;

    let mx = 0, my = 0;
    if(keys['w']) my = -1; if(keys['s']) my = 1; if(keys['a']) mx = -1; if(keys['d']) mx = 1;
    player.x = Math.max(ROOM.wallSize + player.r, Math.min(ROOM.w - ROOM.wallSize - player.r, player.x + mx * player.spd));
    player.y = Math.max(ROOM.wallSize + player.r, Math.min(ROOM.h - ROOM.wallSize - player.r, player.y + my * player.spd));

    let ax = 0, ay = 0;
    if(keys['arrowup']) ay = -1; if(keys['arrowdown']) ay = 1; if(keys['arrowleft']) ax = -1; if(keys['arrowright']) ax = 1;
    if((ax || ay) && !G.reloading && G.ammo > 0) {
        projectiles.push({ x: player.x, y: player.y, vx: ax*14, vy: ay*14, r: 8 });
        G.ammo--;
        if(G.ammo <= 0) {
            G.reloading = true;
            setTimeout(() => { G.ammo = G.maxAmmo; G.reloading = false; }, 1000);
        }
    }

    projectiles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy;
        enemies.forEach((en, ei) => {
            if(Math.hypot(p.x-en.x, p.y-en.y) < en.r) {
                en.hp -= 20; projectiles.splice(i, 1);
                if(en.hp <= 0) enemies.splice(ei, 1);
            }
        });
    });

    if(enemies.length === 0 && !G.enemiesDefeated) {
        G.enemiesDefeated = true;
        spawnDoors();
    }

    // ColisÃ£o REAL com portas
    doors.forEach(d => {
        if(player.x > d.x && player.x < d.x + d.w && player.y < d.y + d.h + 10) {
            G.room++;
            initRoom();
        }
    });
}

function draw() {
    ctx.fillStyle = "#000"; ctx.fillRect(0,0,canvas.width, canvas.height);
    if(!G.play) { requestAnimationFrame(draw); return; }
    update();

    ctx.save();
    let s = Math.min(canvas.width/ROOM.w, canvas.height/ROOM.h)*0.95;
    ctx.translate(canvas.width/2, canvas.height/2); ctx.scale(s,s); ctx.translate(-ROOM.w/2, -ROOM.h/2);

    // ChÃ£o
    ctx.fillStyle = "#080000"; ctx.fillRect(0,0,ROOM.w,ROOM.h);
    
    // Tutorial
    if(G.room === 0) {
        ctx.fillStyle = "rgba(255,0,0,0.3)"; ctx.font = "20px Orbitron"; ctx.textAlign = "center";
        ctx.fillText(texts[G.lang].tut, ROOM.w/2, ROOM.h/2 + 100);
        ctx.fillText("VÃ PARA O NORTE / GO NORTH", ROOM.w/2, ROOM.h/2 - 100);
    }

    // Paredes
    ctx.fillStyle = "#150000";
    ctx.fillRect(0,0,ROOM.w,ROOM.wallSize); ctx.fillRect(0,ROOM.h-ROOM.wallSize,ROOM.w,ROOM.wallSize);
    ctx.fillRect(0,0,ROOM.wallSize,ROOM.h); ctx.fillRect(ROOM.w-ROOM.wallSize,0,ROOM.wallSize,ROOM.h);

    // Portas Ativas
    if(G.enemiesDefeated) {
        ctx.fillStyle = "#ff0000"; ctx.shadowBlur = 20; ctx.shadowColor = "#f00";
        doors.forEach(d => ctx.fillRect(d.x, d.y, d.w, d.h));
        ctx.shadowBlur = 0;
    }

    // Entidades
    ctx.fillStyle = "#ff0000"; enemies.forEach(en => { ctx.beginPath(); ctx.arc(en.x, en.y, en.r, 0, Math.PI*2); ctx.fill(); });
    ctx.fillStyle = G.reloading ? "#444" : "#fff"; ctx.beginPath(); ctx.arc(player.x, player.y, player.r, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = "#fff"; projectiles.forEach(p => { ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill(); });

    ctx.restore();
    document.getElementById('hp-fill').style.width = G.hp + "%";
    document.getElementById('ammo-fill').style.width = (G.ammo/G.maxAmmo*100) + "%";
    document.getElementById('room-txt').innerText = G.room;
    requestAnimationFrame(draw);
}

window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => delete keys[e.key.toLowerCase()]);
window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
window.onresize(); draw();
</script>
</body>
</html>
