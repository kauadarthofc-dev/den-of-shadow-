<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Den of Shadow üíÄ</title>
    <style>
        :root {
            --primary: #ff69b4; --secondary: #00eaff; --bg: #0f172a;
            --comum: #3498db; --incomum: #2ecc71; --raro: #f1c40f; 
            --epico: #9b59b6; --lendario: linear-gradient(45deg, #ff00ff, #00ffff);
        }
        * { touch-action: none; user-select: none; box-sizing: border-box; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
        canvas { display: block; image-rendering: pixelated; }

        /* TELA INICIAL BONITA */
        #start-screen {
            position: fixed; inset: 0; 
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s;
        }
        .title-container { text-align: center; margin-bottom: 40px; animation: float 3s ease-in-out infinite; }
        .title-container h1 { 
            font-size: 70px; margin: 0; color: white; text-shadow: 0 0 20px var(--primary);
            font-weight: 900; letter-spacing: -2px;
        }
        .title-container h1 span { color: var(--primary); }

        .save-slots { display: flex; gap: 20px; margin-bottom: 30px; }
        .slot {
            width: 130px; height: 160px; background: rgba(255,255,255,0.05);
            border: 3px solid #334155; border-radius: 20px; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.3s; position: relative;
        }
        .slot:hover { border-color: var(--secondary); background: rgba(0,234,255,0.1); transform: translateY(-5px); }
        .slot.active { border-color: var(--primary); background: rgba(255,105,180,0.1); box-shadow: 0 0 20px var(--primary); }
        .slot i { font-size: 40px; margin-bottom: 10px; }

        .btn-play {
            padding: 20px 80px; font-size: 24px; font-weight: bold; color: white;
            background: var(--primary); border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 10px 0 #c026d3; transition: 0.2s;
        }
        .btn-play:active { transform: translateY(5px); box-shadow: 0 5px 0 #c026d3; }

        /* HUD FOFA */
        #hud { position: absolute; top: 20px; left: 20px; z-index: 100; pointer-events: none; }
        .hud-box { 
            background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 15px;
            border: 2px solid var(--primary); display: flex; align-items: center; gap: 15px;
            margin-bottom: 10px; backdrop-filter: blur(5px);
        }
        .hp-bar-outer { width: 200px; height: 15px; background: #334155; border-radius: 10px; overflow: hidden; }
        .hp-bar-inner { width: 100%; height: 100%; background: var(--primary); transition: 0.3s; }

        /* MOBILE UI */
        #mobile-controls { position: absolute; inset: 0; pointer-events: none; display: none; }
        .joy-base { position: absolute; bottom: 50px; left: 50px; width: 160px; height: 160px; background: rgba(255,255,255,0.1); border: 4px solid white; border-radius: 50%; pointer-events: auto; }
        .joy-stick { position: absolute; top: 40px; left: 40px; width: 80px; height: 80px; background: white; border-radius: 50%; }
        .btn-action { 
            position: absolute; bottom: 60px; right: 60px; width: 100px; height: 100px; 
            background: var(--primary); border: 4px solid white; border-radius: 50%; 
            pointer-events: auto; display: flex; align-items: center; justify-content: center; font-size: 40px;
        }
        #btn-swap { right: 180px; bottom: 50px; background: var(--secondary); width: 80px; height: 80px; }
        #btn-fs { top: 20px; left: 50%; transform: translateX(-50%); pointer-events: auto; padding: 10px 20px; border-radius: 10px; background: white; color: black; font-weight: bold; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

<div id="start-screen">
    <div class="title-container">
        <h1>DEN OF <span>SHADOW</span> üíÄ</h1>
        <p style="color: var(--secondary); letter-spacing: 5px;">KAUA DARTH PRESENTS</p>
    </div>

    <div class="save-slots">
        <div class="slot active" onclick="selectSlot(1)"><i>üíÄ</i><span>SAVE 1</span></div>
        <div class="slot" onclick="selectSlot(2)"><i>üíÄ</i><span>SAVE 2</span></div>
        <div class="slot" onclick="selectSlot(3)"><i>üíÄ</i><span>SAVE 3</span></div>
    </div>

    <button class="btn-play" onclick="initGame()">JOGAR</button>

    <div style="margin-top: 40px; text-align: center; font-size: 14px;">
        <a href="mailto:kauadarthofc@gmail.com" style="color: white; text-decoration: none;">kauadarthofc@gmail.com</a><br>
        <a href="https://youtube.com/@kaua_darth" style="color: var(--primary); text-decoration: none; font-weight: bold;">@kaua_darth</a>
    </div>
</div>

<div id="hud">
    <div class="hud-box">
        <span>‚ù§Ô∏è</span>
        <div class="hp-bar-outer"><div id="hp-bar" class="hp-bar-inner"></div></div>
    </div>
    <div class="hud-box" style="border-color: var(--secondary);">
        <span id="weapon-display">üî´ Magnum: 15/15</span>
    </div>
    <div class="hud-box" style="border-color: var(--raro);">
        <span>üí∞ <span id="coin-count">0</span></span>
        <span style="margin-left: 20px;">üö™ SALA: <span id="room-count">0</span></span>
    </div>
</div>

<div id="mobile-controls">
    <div id="btn-fs" onclick="toggleFS()">TELA CHEIA</div>
    <div class="joy-base" id="joy-base"><div class="joy-stick" id="joy-stick"></div></div>
    <div class="btn-action" id="btn-shoot" onpointerdown="isShooting=true" onpointerup="isShooting=false">üî•</div>
    <div class="btn-action" id="btn-swap" onclick="swapWeapon()">üîÑ</div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);

// --- CONFIGURA√á√ÉO ---
let gameActive = false;
let isShooting = false;
let room = 0;
let coins = 0;
let worldSize = 2500;

const WEAPONS = [
    { id: 'magnum', name: 'Magnum', dmg: 10, ammo: 15, max: 15, cd: 20, spd: 25, color: '#fff', type: 'single' },
    { id: 'shotgun', name: 'Shotgun', dmg: 8, ammo: 8, max: 8, cd: 45, spd: 20, color: '#f1c40f', type: 'spread' },
    { id: 'flame', name: 'Lan√ßa-Chamas', dmg: 4, ammo: 50, max: 50, cd: 4, spd: 15, color: '#ff4500', type: 'flame' }
];

let player = {
    x: 1250, y: 1250, r: 40, hp: 12, maxHp: 12, 
    weaponIdx: 0, spd: 7, 
    rot: 0, legAnim: 0, iframe: 0
};

let enemies = [], bullets = [], doors = [], particles = [], drops = [];
let keys = {};
let joystick = { active: false, x: 0, y: 0 };

// --- CORE ---
function initGame() {
    document.getElementById('start-screen').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('start-screen').style.display = 'none';
        if(isMobile) document.getElementById('mobile-controls').style.display = 'block';
        gameActive = true;
        nextRoom();
        render();
    }, 500);
}

function nextRoom() {
    room++;
    enemies = []; bullets = []; doors = []; drops = [];
    player.x = worldSize/2; player.y = worldSize/2;
    
    // Tutorial (Sala 0/1) sem inimigos
    if(room > 1) {
        let count = 3 + Math.floor(room / 2);
        for(let i=0; i<count; i++) {
            let ex, ey;
            do { ex = Math.random() * (worldSize-400)+200; ey = Math.random() * (worldSize-400)+200; } 
            while(Math.hypot(ex-player.x, ey-player.y) < 600);
            enemies.push({
                x: ex, y: ey, hp: 30 + (room*5), r: 35, 
                spd: 2 + Math.random()*2, 
                type: room > 2 && Math.random() > 0.8 ? 'kamikaze' : 'stalker'
            });
        }
    }

    // Portas aleat√≥rias (Garantidas)
    let sides = [{x: worldSize/2, y: 100}, {x: worldSize/2, y: worldSize-100}, {x: 100, y: worldSize/2}, {x: worldSize-100, y: worldSize/2}];
    let doorPos = sides[Math.floor(Math.random()*sides.length)];
    doors.push({ x: doorPos.x, y: doorPos.y, open: room <= 1 });
}

function update() {
    if(!gameActive) return;

    // Movimento
    let vx = 0, vy = 0;
    if(keys['KeyW'] || joystick.y < -0.1) vy = -1;
    if(keys['KeyS'] || joystick.y > 0.1) vy = 1;
    if(keys['KeyA'] || joystick.x < -0.1) vx = -1;
    if(keys['KeyD'] || joystick.x > 0.1) vx = 1;

    if(vx !== 0 || vy !== 0) {
        player.rot = Math.atan2(vy, vx);
        player.x += vx * player.spd;
        player.y += vy * player.spd;
        player.legAnim += 0.15;
    }

    // Tiro
    if(player.cd > 0) player.cd--;
    if((isShooting || keys['Space']) && player.cd <= 0) {
        let w = WEAPONS[player.weaponIdx];
        if(w.ammo > 0) {
            fireWeapon(w);
            player.cd = w.cd;
            w.ammo--;
        }
    }

    // Inimigos
    enemies.forEach((en, i) => {
        let dist = Math.hypot(player.x-en.x, player.y-en.y);
        let ang = Math.atan2(player.y-en.y, player.x-en.x);
        en.x += Math.cos(ang) * en.spd;
        en.y += Math.sin(ang) * en.spd;

        if(dist < player.r + en.r && player.iframe <= 0) {
            player.hp -= (en.type === 'kamikaze' ? 2 : 1);
            player.iframe = 60;
            if(en.type === 'kamikaze') en.hp = 0;
        }

        if(en.hp <= 0) {
            if(Math.random() < 0.3) drops.push({x: en.x, y: en.y, type: 'coin'});
            enemies.splice(i, 1);
            if(enemies.length === 0) doors.forEach(d => d.open = true);
        }
    });

    // Bullets
    bullets.forEach((b, i) => {
        b.x += b.vx; b.y += b.vy; b.life--;
        enemies.forEach(en => {
            if(Math.hypot(b.x-en.x, b.y-en.y) < en.r + 10) {
                en.hp -= b.dmg; b.life = 0;
            }
        });
        if(b.life <= 0) bullets.splice(i, 1);
    });

    // Portas
    doors.forEach(d => {
        if(d.open && Math.hypot(player.x-d.x, player.y-d.y) < 100) nextRoom();
    });

    // Drops
    drops.forEach((d, i) => {
        if(Math.hypot(player.x-d.x, player.y-d.y) < 60) {
            if(d.type === 'coin') coins++;
            drops.splice(i, 1);
        }
    });

    player.x = Math.max(100, Math.min(worldSize-100, player.x));
    player.y = Math.max(100, Math.min(worldSize-100, player.y));
    if(player.iframe > 0) player.iframe--;
    if(player.hp <= 0) location.reload();

    updateHUD();
}

function fireWeapon(w) {
    let angle = player.rot;
    if(w.type === 'spread') {
        for(let i=-1; i<=1; i++) {
            bullets.push({ x: player.x, y: player.y, vx: Math.cos(angle + i*0.2)*w.spd, vy: Math.sin(angle + i*0.2)*w.spd, dmg: w.dmg, color: w.color, life: 30 });
        }
    } else {
        bullets.push({ x: player.x, y: player.y, vx: Math.cos(angle)*w.spd, vy: Math.sin(angle)*w.spd, dmg: w.dmg, color: w.color, life: 60 });
    }
}

function render() {
    ctx.fillStyle = '#0f172a';
    ctx.fillRect(0,0,canvas.width, canvas.height);

    ctx.save();
    ctx.translate(-player.x + canvas.width/2, -player.y + canvas.height/2);

    // Grid de Ch√£o (N√£o Preto)
    ctx.strokeStyle = '#1e293b';
    ctx.lineWidth = 5;
    for(let i=0; i<=worldSize; i+=100) {
        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, worldSize); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(worldSize, i); ctx.stroke();
    }

    // Portas
    doors.forEach(d => {
        ctx.fillStyle = d.open ? varProp('--incomum') : '#334155';
        ctx.fillRect(d.x-60, d.y-60, 120, 120);
    });

    // Inimigos
    enemies.forEach(en => {
        ctx.fillStyle = en.type === 'kamikaze' ? '#ff4757' : '#747d8c';
        ctx.fillRect(en.x-en.r, en.y-en.r, en.r*2, en.r*2);
        ctx.fillStyle = 'white'; ctx.font = '20px Arial';
        ctx.fillText(en.type === 'kamikaze' ? '√≤_√≥' : 'o_o', en.x-15, en.y+5);
    });

    // Drops
    drops.forEach(d => {
        ctx.fillStyle = '#f1c40f';
        ctx.beginPath(); ctx.arc(d.x, d.y, 15, 0, 7); ctx.fill();
    });

    // Bullets
    bullets.forEach(b => {
        ctx.fillStyle = b.color;
        ctx.beginPath(); ctx.arc(b.x, b.y, 10, 0, 7); ctx.fill();
    });

    // Player (Lorde da Luz)
    ctx.save();
    ctx.translate(player.x, player.y);
    
    // Perninhas Fofas
    ctx.fillStyle = '#cbd5e1';
    let legY = Math.sin(player.legAnim) * 10;
    ctx.fillRect(-25, 20 + legY, 15, 20);
    ctx.fillRect(10, 20 - legY, 15, 20);

    // Corpo
    ctx.rotate(player.rot);
    ctx.shadowBlur = 20; ctx.shadowColor = varProp('--secondary');
    ctx.fillStyle = (player.iframe > 0 && Math.floor(Date.now()/100)%2) ? 'red' : 'white';
    ctx.beginPath();
    ctx.moveTo(40, 0); ctx.lineTo(-30, 35); ctx.lineTo(-30, -35);
    ctx.closePath(); ctx.fill();
    ctx.restore();

    ctx.restore();

    // Minimapa
    renderMinimap();

    update();
    requestAnimationFrame(render);
}

function renderMinimap() {
    let size = 150;
    let mx = canvas.width - size - 20;
    let my = 20;
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.fillRect(mx, my, size, size);
    ctx.strokeStyle = 'white'; ctx.strokeRect(mx, my, size, size);

    let scale = size / worldSize;
    // Portas no mapa
    ctx.fillStyle = 'yellow';
    doors.forEach(d => ctx.fillRect(mx + d.x*scale-5, my + d.y*scale-5, 10, 10));
    // Inimigos
    ctx.fillStyle = 'red';
    enemies.forEach(en => ctx.fillRect(mx + en.x*scale-2, my + en.y*scale-2, 4, 4));
    // Player
    ctx.fillStyle = varProp('--secondary');
    ctx.fillRect(mx + player.x*scale-3, my + player.y*scale-3, 6, 6);
}

function updateHUD() {
    document.getElementById('hp-bar').style.width = (player.hp/player.maxHp)*100 + "%";
    document.getElementById('coin-count').innerText = coins;
    document.getElementById('room-count').innerText = room;
    let w = WEAPONS[player.weaponIdx];
    document.getElementById('weapon-display').innerText = `üî´ ${w.name}: ${w.ammo}/${w.max}`;
}

function varProp(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

// --- CONTROLES ---
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

function swapWeapon() {
    player.weaponIdx = (player.weaponIdx + 1) % WEAPONS.length;
}

// Joystick Mobile
if(isMobile) {
    const joyBase = document.getElementById('joy-base');
    const joyStick = document.getElementById('joy-stick');
    joyBase.addEventListener('touchstart', () => joystick.active = true);
    window.addEventListener('touchmove', e => {
        if(!joystick.active) return;
        let touch = e.touches[0];
        let rect = joyBase.getBoundingClientRect();
        let dx = touch.clientX - (rect.left + 80);
        let dy = touch.clientY - (rect.top + 80);
        let dist = Math.min(Math.hypot(dx, dy), 60);
        let ang = Math.atan2(dy, dx);
        joystick.x = (Math.cos(ang)*dist)/60;
        joystick.y = (Math.sin(ang)*dist)/60;
        joyStick.style.transform = `translate(${Math.cos(ang)*dist}px, ${Math.sin(ang)*dist}px)`;
    });
    window.addEventListener('touchend', () => {
        joystick.active = false; joystick.x = 0; joystick.y = 0;
        joyStick.style.transform = `translate(0,0)`;
    });
}

function toggleFS() {
    if(!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
}

window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
window.onresize();
</script>
</body>
</html>
