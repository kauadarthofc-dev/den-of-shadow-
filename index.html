<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Capivara Merge Battle</title>
    <style>
        :root {
            --bg: #2c3e50;
            --slot: #34495e;
            --highlight: #27ae60;
        }
        body {
            margin: 0;
            background: var(--bg);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
        }

        /* Top Bar - Progress√£o */
        #progress-container {
            width: 80%;
            max-width: 600px;
            height: 20px;
            background: #1a252f;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            border: 3px solid #000;
        }
        #progress-bar {
            width: 10%;
            height: 100%;
            background: #f1c40f;
            border-radius: 5px;
            transition: width 0.3s;
        }

        #game-layout {
            display: flex;
            gap: 40px;
            padding: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* √Årea de Merge (Esquerda) */
        #merge-area {
            background: var(--slot);
            padding: 15px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(3, 80px);
            grid-template-rows: repeat(3, 80px);
            gap: 10px;
        }
        .slot {
            width: 80px;
            height: 80px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* √Årea de Batalha (Direita) */
        #battle-area {
            width: 300px;
            height: 280px;
            background: #1a252f;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            border: 2px dashed #555;
        }
        .platform {
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.1);
        }

        /* Elementos do Jogo */
        .entity {
            width: 50px;
            height: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            transition: transform 0.1s;
        }
        .capivara {
            z-index: 10;
        }
        .enemy {
            position: absolute;
            right: 20px;
            filter: hue-rotate(150deg); /* Diferenciar inimigos */
        }
        .hp-bar {
            position: absolute;
            top: -10px;
            width: 40px;
            height: 5px;
            background: red;
            border: 1px solid #000;
        }
        .hp-fill {
            height: 100%;
            background: #2ecc71;
            width: 100%;
        }

        /* Proj√©teis */
        .projectile {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #f1c40f;
            border-radius: 50%;
            pointer-events: none;
        }

        #controls {
            margin-top: 20px;
            text-align: center;
        }
        #buy-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px #1e8449;
        }
        #buy-btn:active {
            box-shadow: 0 0;
            transform: translateY(4px);
        }
    </style>
</head>
<body>

    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>

    <h1>Capivara Merge Battle üêæ</h1>
    <div id="score">Moedas: <span id="coin-count">50</span></div>

    <div id="game-layout">
        <div id="merge-area">
            <div class="slot" data-id="0"></div>
            <div class="slot" data-id="1"></div>
            <div class="slot" data-id="2"></div>
            <div class="slot" data-id="3"></div>
            <div class="slot" data-id="4"></div>
            <div class="slot" data-id="5"></div>
            <div class="slot" data-id="6"></div>
            <div class="slot" data-id="7"></div>
            <div class="slot" data-id="8"></div>
        </div>

        <div id="battle-area" id="battle-field">
            <div class="platform" style="top: 80px;"></div>
            <div class="platform" style="top: 170px;"></div>
            <div id="entities-layer"></div>
        </div>
    </div>

    <div id="controls">
        <button id="buy-btn">Comprar Capi (10üí∞)</button>
    </div>

    <script>
        let coins = 50;
        let experience = 10;
        const slots = document.querySelectorAll('.slot');
        const battleField = document.getElementById('entities-layer');
        let draggedCapi = null;

        // Configura√ß√µes das Capivaras
        const capiLevels = {
            1: { emoji: 'üêπ', power: 10, hp: 50 },
            2: { emoji: 'üê≠', power: 25, hp: 100 },
            3: { emoji: 'ü¶´', power: 60, hp: 250 },
            4: { emoji: 'ü¶¶', power: 150, hp: 600 }
        };

        // --- SISTEMA DE COMBATE ---
        function spawnEnemy(row) {
            const level = Math.floor(experience / 100) + 1;
            const enemy = document.createElement('div');
            enemy.className = 'entity enemy';
            enemy.style.top = (row * 90 + 20) + 'px';
            enemy.dataset.hp = 30 * level;
            enemy.dataset.maxHp = 30 * level;
            enemy.innerHTML = `<div class="hp-bar"><div class="hp-fill"></div></div>üíÄ<br><small>Lvl ${level}</small>`;
            battleField.appendChild(enemy);
        }

        function updateBattle() {
            const capis = document.querySelectorAll('.capivara-battle');
            const enemies = document.querySelectorAll('.enemy');

            capis.forEach(capi => {
                const row = capi.dataset.row;
                const enemyInRow = Array.from(enemies).find(e => e.style.top === (row * 90 + 20) + 'px');
                
                if (enemyInRow) {
                    shoot(capi, enemyInRow);
                }
            });

            // Se n√£o houver inimigos, spawna novos aleatoriamente
            if (enemies.length < 2) spawnEnemy(Math.floor(Math.random() * 3));
        }

        function shoot(from, to) {
            const bullet = document.createElement('div');
            bullet.className = 'projectile';
            bullet.style.left = '60px';
            bullet.style.top = (parseInt(from.style.top) + 20) + 'px';
            battleField.appendChild(bullet);

            let pos = 60;
            const interval = setInterval(() => {
                pos += 5;
                bullet.style.left = pos + 'px';
                if (pos > 240) {
                    clearInterval(interval);
                    bullet.remove();
                    damageEnemy(to, parseInt(from.dataset.power));
                }
            }, 20);
        }

        function damageEnemy(enemy, dmg) {
            let hp = parseInt(enemy.dataset.hp) - dmg;
            enemy.dataset.hp = hp;
            const fill = enemy.querySelector('.hp-fill');
            fill.style.width = (hp / parseInt(enemy.dataset.maxHp) * 100) + '%';

            if (hp <= 0) {
                enemy.remove();
                coins += 5;
                experience += 15;
                updateUI();
            }
        }

        // --- SISTEMA DE MERGE ---
        function createCapivara(lvl) {
            const div = document.createElement('div');
            div.className = 'entity capivara';
            div.draggable = true;
            div.dataset.level = lvl;
            div.innerHTML = `${capiLevels[lvl].emoji}<br><small>Lvl ${lvl}</small>`;
            
            div.ondragstart = (e) => {
                draggedCapi = div;
                setTimeout(() => div.style.opacity = '0.4', 0);
            };
            div.ondragend = () => {
                div.style.opacity = '1';
                draggedCapi = null;
                updateBattleLineup();
            };
            return div;
        }

        function updateBattleLineup() {
            // Limpa √°rea de batalha e coloca as capivaras da grade nos "andares"
            battleField.innerHTML = '';
            const activeCapis = Array.from(slots).map(s => s.firstChild).filter(c => c !== null);
            
            // Pega as 3 melhores capivaras para lutar (uma em cada andar)
            activeCapis.slice(0, 3).forEach((capi, index) => {
                const battleClone = document.createElement('div');
                battleClone.className = 'entity capivara-battle';
                battleClone.style.top = (index * 90 + 20) + 'px';
                battleClone.style.left = '20px';
                battleClone.style.position = 'absolute';
                battleClone.dataset.row = index;
                battleClone.dataset.power = capiLevels[capi.dataset.level].power;
                battleClone.innerHTML = capi.innerHTML;
                battleField.appendChild(battleClone);
            });
        }

        slots.forEach(slot => {
            slot.ondragover = e => e.preventDefault();
            slot.ondrop = e => {
                const targetCapi = slot.firstChild;
                if (!targetCapi) {
                    slot.appendChild(draggedCapi);
                } else if (targetCapi !== draggedCapi && targetCapi.dataset.level === draggedCapi.dataset.level) {
                    const newLvl = parseInt(targetCapi.dataset.level) + 1;
                    if (capiLevels[newLvl]) {
                        slot.removeChild(targetCapi);
                        draggedCapi.remove();
                        slot.appendChild(createCapivara(newLvl));
                        experience += 50;
                        updateUI();
                    }
                }
                updateBattleLineup();
            };
        });

        document.getElementById('buy-btn').onclick = () => {
            if (coins >= 10) {
                const emptySlot = Array.from(slots).find(s => !s.firstChild);
                if (emptySlot) {
                    coins -= 10;
                    emptySlot.appendChild(createCapivara(1));
                    updateUI();
                    updateBattleLineup();
                }
            }
        };

        function updateUI() {
            document.getElementById('coin-count').innerText = coins;
            document.getElementById('progress-bar').style.width = (experience % 100) + '%';
        }

        // Loops do Jogo
        setInterval(updateBattle, 1500); // Ataca a cada 1.5s
        
    </script>
</body>
</html>
