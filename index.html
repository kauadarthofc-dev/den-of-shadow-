<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Capivara vs Zombies: Merge Art</title>
    <style>
        :root {
            --bg: #1a1a1a;
            --slot: #3d2b1f;
            --accent: #8b5a2b;
        }
        body {
            margin: 0;
            background: var(--bg);
            color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* Estiliza√ß√£o das Entidades */
        .sprite {
            width: 64px;
            height: 64px;
            image-rendering: pixelated; /* Mant√©m o aspecto de Pixel Art */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        /* √Årea Superior */
        #ui-top {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #progress-container {
            width: 200px;
            height: 15px;
            background: #333;
            border: 3px solid #000;
            border-radius: 5px;
        }
        #progress-bar {
            width: 0%;
            height: 100%;
            background: #ffd700;
            transition: width 0.3s;
        }

        /* Layout Principal */
        #main-container {
            display: flex;
            gap: 20px;
            padding: 10px;
            background: #2c2c2c;
            border-radius: 15px;
            border: 4px solid #444;
        }

        /* Grade de Merge */
        #grid {
            display: grid;
            grid-template-columns: repeat(3, 85px);
            grid-template-rows: repeat(3, 85px);
            gap: 8px;
            background: var(--slot);
            padding: 10px;
            border-radius: 8px;
        }
        .slot {
            width: 85px;
            height: 85px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Campo de Batalha Procedural */
        #battle-field {
            width: 400px;
            height: 280px;
            background: #252525;
            position: relative;
            border-radius: 8px;
            border-left: 4px solid #555;
            background-image: linear-gradient(#333 1px, transparent 1px);
            background-size: 100% 90px;
        }

        /* Inimigos e Capis na Luta */
        .enemy { position: absolute; right: -70px; transition: right 0.1s linear; }
        .capi-battle { position: absolute; left: 10px; }

        .hp-bar {
            position: absolute;
            top: -5px;
            width: 100%;
            height: 4px;
            background: #500;
        }
        .hp-fill { height: 100%; background: #f00; width: 100%; }

        /* Controles */
        #controls { margin-top: 20px; }
        #buy-btn {
            background: #4caf50;
            border: none;
            color: white;
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 5px #2e7d32;
        }
        #buy-btn:active { transform: translateY(3px); box-shadow: 0 2px #2e7d32; }

        /* Estilo do Proj√©til */
        .bullet {
            position: absolute;
            width: 12px;
            height: 6px;
            background: #ffa500;
            border-radius: 3px;
            box-shadow: 0 0 5px #ff4500;
        }
    </style>
</head>
<body>

    <div id="ui-top">
        <div>üí∞ Moedas: <span id="coins">50</span></div>
        <div id="progress-container"><div id="progress-bar"></div></div>
    </div>

    <div id="main-container">
        <div id="grid">
            <div class="slot" data-index="0"></div><div class="slot" data-index="1"></div><div class="slot" data-index="2"></div>
            <div class="slot" data-index="3"></div><div class="slot" data-index="4"></div><div class="slot" data-index="5"></div>
            <div class="slot" data-index="6"></div><div class="slot" data-index="7"></div><div class="slot" data-index="8"></div>
        </div>

        <div id="battle-field">
            </div>
    </div>

    <div id="controls">
        <button id="buy-btn">NOVA CAPIVARA (15üí∞)</button>
    </div>

    <script>
        // Imagens de Sprites (Pixel Art)
        const SPRITES = {
            capi: [
                'https://i.ibb.co/Vmq9fH0/capy1.png', // Lvl 1
                'https://i.ibb.co/9H6S0m6/capy2.png', // Lvl 2
                'https://i.ibb.co/L5pGz17/capy3.png'  // Lvl 3
            ],
            zombie: 'https://i.ibb.co/yYv7p7X/zombie.png'
        };

        let coins = 50;
        let xp = 0;
        let dragged = null;

        // Configura√ß√µes
        const levels = [
            { img: 'https://cdn-icons-png.flaticon.com/512/9616/9616990.png', power: 10 }, // Baby Capi
            { img: 'https://cdn-icons-png.flaticon.com/512/9617/9617013.png', power: 30 }, // Knight Capi
            { img: 'https://cdn-icons-png.flaticon.com/512/9617/9617028.png', power: 80 }  // King Capi
        ];

        // L√≥gica de Compra e Drag/Drop
        document.getElementById('buy-btn').onclick = () => {
            if (coins >= 15) {
                const emptySlot = Array.from(document.querySelectorAll('.slot')).find(s => !s.hasChildNodes());
                if (emptySlot) {
                    coins -= 15;
                    createCapi(0, emptySlot);
                    updateUI();
                }
            }
        };

        function createCapi(lvl, target) {
            const div = document.createElement('div');
            div.className = 'sprite';
            div.style.backgroundImage = `url(${levels[lvl].img})`;
            div.draggable = true;
            div.dataset.lvl = lvl;
            
            div.ondragstart = () => { dragged = div; };
            target.appendChild(div);
            syncBattle();
        }

        document.querySelectorAll('.slot').forEach(slot => {
            slot.ondragover = e => e.preventDefault();
            slot.ondrop = () => {
                if (!slot.hasChildNodes()) {
                    slot.appendChild(dragged);
                } else {
                    const target = slot.firstChild;
                    if (target.dataset.lvl == dragged.dataset.lvl && target.dataset.lvl < levels.length - 1) {
                        const nextLvl = parseInt(target.dataset.lvl) + 1;
                        target.remove();
                        dragged.remove();
                        createCapi(nextLvl, slot);
                        xp += 20;
                    }
                }
                syncBattle();
                updateUI();
            };
        });

        // Campo de Batalha
        function syncBattle() {
            const field = document.getElementById('battle-field');
            field.querySelectorAll('.capi-battle').forEach(c => c.remove());
            
            // Pega as 3 capivaras mais fortes para as 3 linhas
            const allCapis = Array.from(document.querySelectorAll('.slot .sprite'))
                                .sort((a,b) => b.dataset.lvl - a.dataset.lvl);

            allCapis.slice(0, 3).forEach((capi, i) => {
                const bCapi = capi.cloneNode(true);
                bCapi.className = 'sprite capi-battle';
                bCapi.style.top = (i * 90 + 15) + 'px';
                bCapi.dataset.row = i;
                bCapi.dataset.pwr = levels[capi.dataset.lvl].power;
                field.appendChild(bCapi);
            });
        }

        function spawnZombie() {
            const row = Math.floor(Math.random() * 3);
            const zombie = document.createElement('div');
            zombie.className = 'sprite enemy';
            zombie.style.backgroundImage = `url('https://cdn-icons-png.flaticon.com/512/1141/1141771.png')`;
            zombie.style.top = (row * 90 + 15) + 'px';
            zombie.dataset.hp = 100;
            zombie.dataset.row = row;
            zombie.innerHTML = `<div class="hp-bar"><div class="hp-fill"></div></div>`;
            document.getElementById('battle-field').appendChild(zombie);
        }

        // Loop de Movimento e Ataque
        setInterval(() => {
            // Mover Zumbis
            document.querySelectorAll('.enemy').forEach(z => {
                let currentRight = parseInt(z.style.right) || -70;
                z.style.right = (currentRight + 2) + 'px';
                if (currentRight > 350) z.remove(); // Chegou na base
            });

            // Capivaras Atacam
            document.querySelectorAll('.capi-battle').forEach(c => {
                const target = Array.from(document.querySelectorAll('.enemy'))
                                    .find(z => z.dataset.row == c.dataset.row);
                if (target) shoot(c, target);
            });

            if (Math.random() > 0.95) spawnZombie();
        }, 1000);

        function shoot(from, to) {
            const bullet = document.createElement('div');
            bullet.className = 'bullet';
            bullet.style.left = '70px';
            bullet.style.top = (parseInt(from.style.top) + 32) + 'px';
            document.getElementById('battle-field').appendChild(bullet);

            let bPos = 70;
            const bInt = setInterval(() => {
                bPos += 10;
                bullet.style.left = bPos + 'px';
                
                // Colis√£o simples por posi√ß√£o
                const zPos = 400 - parseInt(to.style.right);
                if (bPos >= zPos - 20) {
                    clearInterval(bInt);
                    bullet.remove();
                    hitZombie(to, from.dataset.pwr);
                }
                if (bPos > 400) { clearInterval(bInt); bullet.remove(); }
            }, 30);
        }

        function hitZombie(z, pwr) {
            z.dataset.hp -= pwr;
            z.querySelector('.hp-fill').style.width = z.dataset.hp + '%';
            if (z.dataset.hp <= 0) {
                z.remove();
                coins += 5;
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('coins').innerText = coins;
            document.getElementById('progress-bar').style.width = (xp % 100) + '%';
        }
    </script>
</body>
</html>
