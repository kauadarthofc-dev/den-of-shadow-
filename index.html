<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Den of Shadow ðŸ’€ Lord of Light</title>
    <style>
        :root {
            --c-comum: #3498db; --c-incomum: #2ecc71; --c-raro: #f1c40f; 
            --c-epico: #9b59b6; --c-lendario: linear-gradient(45deg, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff);
            --glow: 0 0 15px rgba(0, 234, 255, 0.5);
        }
        * { touch-action: none; user-select: none; box-sizing: border-box; outline: none; }
        body { margin: 0; background: #05050a; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
        canvas { display: block; image-rendering: auto; }

        /* Interface Estilizada */
        .ui-screen { position: absolute; inset: 0; background: radial-gradient(circle, rgba(15,12,41,0.9) 0%, rgba(5,5,15,1) 100%); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .title-box { border: 2px solid #fff; padding: 30px; border-radius: 20px; background: rgba(231, 76, 60, 0.1); box-shadow: 0 0 30px rgba(231, 76, 60, 0.3); text-align: center; }
        .title-text { font-size: clamp(40px, 10vw, 80px); color: #e74c3c; margin: 0; text-transform: uppercase; letter-spacing: 8px; text-shadow: 0 0 20px #e74c3c; }
        .hint-bar { color: #2ecc71; margin: 20px; font-weight: bold; letter-spacing: 1px; text-transform: uppercase; font-size: 14px; }
        .btn-main { padding: 18px 50px; background: #2ecc71; border: none; color: white; font-size: 24px; font-weight: 900; border-radius: 50px; cursor: pointer; transition: 0.3s; box-shadow: 0 6px 0 #1c8d4c, 0 10px 20px rgba(0,0,0,0.5); }
        .btn-main:hover { transform: scale(1.05); filter: brightness(1.2); }
        .btn-main:active { transform: translateY(4px); box-shadow: 0 2px 0 #1c8d4c; }

        /* Controles Mobile Robustos */
        #mobile-hud { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 1000; }
        #joy-base { position: absolute; bottom: 50px; left: 50px; width: 150px; height: 150px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; pointer-events: auto; backdrop-filter: blur(2px); }
        #joy-stick { position: absolute; width: 65px; height: 65px; background: radial-gradient(circle, #00eaff, #0072ff); border-radius: 50%; left: 42.5px; top: 42.5px; box-shadow: 0 0 20px #00eaff; }
        #atk-grid { position: absolute; bottom: 40px; right: 40px; display: grid; grid-template-columns: repeat(3, 95px); gap: 15px; pointer-events: auto; }
        .btn-atk { width: 95px; height: 95px; background: rgba(255,255,255,0.05); border: 3px solid rgba(255,255,255,0.5); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 35px; color: white; backdrop-filter: blur(2px); }
        .btn-atk:active { background: rgba(0, 234, 255, 0.3); border-color: #00eaff; }
        #swap-mob { position: absolute; bottom: 45px; right: 380px; width: 110px; height: 110px; background: #f1c40f; border: 4px solid #fff; border-radius: 25px; pointer-events: auto; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #000; font-weight: 900; box-shadow: 0 0 15px #f1c40f; }

        /* Cartas de Upgrade */
        .card { width: 240px; height: 350px; background: linear-gradient(135deg, #1a1a2e 0%, #0f0c29 100%); border: 4px solid #fff; border-radius: 20px; padding: 20px; cursor: pointer; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); text-align: center; }
        .card:hover { transform: translateY(-15px) rotate(2deg); box-shadow: 0 20px 40px rgba(0,0,0,0.8); }
        
        #weapon-tag { position: absolute; bottom: 180px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); border: 2px solid #f1c40f; padding: 15px 30px; border-radius: 15px; display: none; z-index: 500; text-align: center; animation: float 2s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translate(-50%, 0); } 50% { transform: translate(-50%, -10px); } }
    </style>
</head>
<body>

<div id="start-screen" class="ui-screen">
    <div class="title-box">
        <h1 class="title-text">Den of Shadow ðŸ’€</h1>
        <p style="letter-spacing: 3px; font-weight: 100; color: #fff; margin-top: 10px;">LORD OF LIGHT EDITION</p>
    </div>
    <div id="plat-info" class="hint-bar"></div>
    <button class="btn-main" id="btn-play">INICIAR JORNADA</button>
    <div style="margin-top:40px; text-align: center;">
        <a href="mailto:kauadarthofc@gmail.com" style="color:#bdc3c7; text-decoration:none; font-size: 14px;">ðŸ“§ kauadarthofc@gmail.com</a><br><br>
        <a href="https://youtube.com/@kaua_darth" target="_blank" style="color:#ff0000; text-decoration:none; font-weight:bold; font-size: 16px;">ðŸŽ¬ YouTube: @kaua_darth</a>
    </div>
</div>

<div id="upgrade-screen" class="ui-screen">
    <h2 style="color:#f1c40f; font-size:40px; margin-bottom:30px; text-shadow: 0 0 20px #f1c40f;">BENÃ‡ÃƒO DIVINA</h2>
    <div id="cards-container" style="display:flex; gap:25px;"></div>
</div>

<div id="death-screen" class="ui-screen" style="display:none;">
    <h1 style="color:#e74c3c; font-size:80px; text-shadow: 0 0 30px #e74c3c;">FIM DA LUZ</h1>
    <button class="btn-main" onclick="location.reload()">RENAESCER</button>
</div>

<div id="weapon-tag"></div>
<canvas id="gameCanvas"></canvas>

<div id="mobile-hud">
    <div id="joy-base"><div id="joy-stick"></div></div>
    <div id="atk-grid">
        <div></div><div class="btn-atk" data-dir="up">â–²</div><div></div>
        <div class="btn-atk" data-dir="left">â—€</div><div class="btn-atk" data-dir="down">â–¼</div><div class="btn-atk" data-dir="right">â–¶</div>
    </div>
    <div id="swap-mob">ðŸ”„<br>ARMA</div>
</div>

<script>
/** @type {HTMLCanvasElement} */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

const G = {
    play: false, room: 0, mode: 'normal',
    w: 2200, h: 1600, cx: 0, cy: 0, shake: 0,
    hp: 12, maxHp: 12, kills: 0,
    weapon: 'magnum', triple: 0, ric: 0, dual: false, vamp: 0,
    hasFire: false, hasShot: false, hasStaff: false,
    inv: {
        magnum: { a: 15, m: 15, d: 12, c: "#00eaff", n: "Magnum Prime", cd: 18, info: "Pistola Precisa | Dano: 12" },
        fire: { a: 40, m: 40, d: 5, c: "#ff4500", n: "LanÃ§a-Chamas Inferno", cd: 3, info: "Fogo ContÃ­nuo | Dano: 5" },
        shotgun: { a: 7, m: 7, d: 15, c: "#f1c40f", n: "Escopeta de Elite", cd: 60, info: "Disparo Triplo | Dano: 15x3" },
        staff: { a: 14, m: 14, d: 10, c: "#9b59b6", n: "Cajado do Caos", cd: 30, info: "Orbe Teleguiado | Dano: 10" }
    }
};

let p = { x: 1100, y: 800, r: 28, iframe: 0, t: 0, leg: 0, rel: false, relT: 0, alive: true, rot: 0, trails: [] };
let enemies = [], projectiles = [], drops = [], pedestals = [], warns = [], particles = [];
const keys = new Set();
const mobAtk = { up: false, down: false, left: false, right: false };
const joy = { active: false, x: 0, y: 0, sx: 0, sy: 0 };

if(isMobile) {
    document.getElementById('mobile-hud').style.display = 'block';
    document.getElementById('plat-info').innerText = "ðŸ“± CONTROLES MOBILE ATIVOS";
} else {
    document.getElementById('plat-info').innerText = "ðŸ’» WASD + SETAS + Q (TROCAR ARMA)";
}

function spawnRoom() {
    enemies = []; projectiles = []; drops = []; pedestals = []; warns = [];
    p.x = G.w/2; p.y = G.h/2; p.iframe = 60;
    if(G.room === 0) return;

    if(G.room % 10 === 0 && G.mode !== 'heal') {
        enemies.push({ 
            type:'boss', x:G.w/2, y:450, hp:2500+G.room*200, max:2500+G.room*200, r:130, hit:0, t:0, 
            name: G.room === 10 ? "COLOSSO DE SANGUE" : "SOBERANO DO ABISMO" 
        });
    } else if(G.mode === 'heal') {
        drops.push({x:G.w/2, y:G.h/2, type:'full_heal'});
    } else {
        let count = 5 + Math.floor(G.room/1.5);
        for(let i=0; i<count; i++) {
            let ex, ey;
            do { ex = 300+Math.random()*(G.w-600); ey = 300+Math.random()*(G.h-600); } while(Math.hypot(ex-p.x, ey-p.y) < 600);
            let t = (G.room < 3) ? 'stalker' : (Math.random()<0.25 ? 'kamikaze' : (Math.random()<0.2 ? 'dasher' : 'stalker'));
            enemies.push({ type:t, x:ex, y:ey, r:38, hp:120+G.room*20, hit:0, burn:0, dt:0, f: Math.floor(Math.random()*4) });
        }
    }
    if(G.room === 5 && !G.hasFire) pedestals.push({x:G.w/2, y:450, type:'fire'});
    if(G.room === 15 && !G.hasShot) pedestals.push({x:G.w/2, y:450, type:'shotgun'});
}

function fire(dx, dy) {
    const w = G.inv[G.weapon];
    if(p.rel || w.a <= 0) return;
    if(p.t % w.cd === 0) {
        let ang = Math.atan2(dy, dx);
        p.rot = ang;
        G.shake = 5;
        let n = (1 + G.triple) * (G.dual ? 2 : 1);
        for(let i=0; i<n; i++) {
            let a = ang + (i - (n-1)/2) * 0.2;
            if(G.weapon === 'fire') {
                projectiles.push({x:p.x, y:p.y, dx:Math.cos(a)*16, dy:Math.sin(a)*16, type:'fire', life:25, dmg:w.d});
                for(let k=0; k<2; k++) particles.push({x:p.x, y:p.y, dx:Math.cos(a+Math.random()*0.5)*10, dy:Math.sin(a+Math.random()*0.5)*10, c:"#ff4500", l:15, r: 5});
            } else if(G.weapon === 'shotgun') {
                for(let j=-1; j<=1; j++) projectiles.push({x:p.x, y:p.y, dx:Math.cos(a+j*0.3)*20, dy:Math.sin(a+j*0.3)*20, type:'shotgun', life:15, dmg:w.d});
            } else {
                projectiles.push({x:p.x, y:p.y, dx:Math.cos(a)*22, dy:Math.sin(a)*22, type:G.weapon, life:100, dmg:w.d});
            }
        }
        w.a--; if(w.a <= 0) p.rel = true;
    }
}

function update() {
    if(!G.play || !p.alive) return;

    let mx = joy.active ? joy.x : (keys.has('a')?-1:keys.has('d')?1:0);
    let my = joy.active ? joy.y : (keys.has('w')?-1:keys.has('s')?1:0);
    p.x = Math.max(60, Math.min(G.w-60, p.x + mx * 8));
    p.y = Math.max(60, Math.min(G.h-60, p.y + my * 8));
    
    if(mx||my) {
        p.leg += 0.3;
        if(!mobAtk.up && !mobAtk.down && !mobAtk.left && !mobAtk.right) p.rot = Math.atan2(my, mx);
        if(p.t % 3 === 0) p.trails.push({x:p.x, y:p.y, l:20});
    }
    p.trails.forEach((tr,i) => { tr.l--; if(tr.l<=0) p.trails.splice(i,1); });

    if(p.rel) { p.relT++; if(p.relT > 70){ G.inv[G.weapon].a = G.inv[G.weapon].m; p.rel=false; p.relT=0; }}

    let ax = (keys.has('arrowleft')?-1:keys.has('arrowright')?1:0);
    let ay = (keys.has('arrowup')?-1:keys.has('arrowdown')?1:0);
    if(mobAtk.up) ay=-1; if(mobAtk.down) ay=1; if(mobAtk.left) ax=-1; if(mobAtk.right) ax=1;
    if(ax||ay) fire(ax, ay);

    enemies.forEach((e, i) => {
        let ang = Math.atan2(p.y-e.y, p.x-e.x);
        let dist = Math.hypot(p.x-e.x, p.y-e.y);

        if(e.type === 'boss') {
            e.t++; e.x += Math.cos(e.t/50)*7; e.y += Math.sin(e.t/40)*4;
            if(e.t % 100 === 0) warns.push({x: 300+Math.random()*(G.w-600), y: 300+Math.random()*(G.h-600), t:80});
        } else {
            let s = e.type==='kamikaze'?1.5:2.8;
            if(e.type==='dasher') {
                e.dt++; if(e.dt>110){ e.x+=Math.cos(ang)*20; e.y+=Math.sin(ang)*20; if(e.dt>125)e.dt=0; }
                else { e.x+=Math.cos(ang)*s; e.y+=Math.sin(ang)*s; }
            } else { e.x+=Math.cos(ang)*s; e.y+=Math.sin(ang)*s; }
        }

        if(dist < p.r + e.r) {
            let k = Math.atan2(e.y-p.y, e.x-p.x);
            e.x += Math.cos(k)*40; e.y += Math.sin(k)*40; 
            if(p.iframe <= 0) { G.hp -= (e.type==='kamikaze'?3:1); p.iframe=50; G.shake=15; if(e.type==='kamikaze') e.hp=0; }
        }

        if(e.hp <= 0) {
            for(let k=0; k<15; k++) particles.push({x:e.x, y:e.y, dx:(Math.random()-0.5)*12, dy:(Math.random()-0.5)*12, c:e.type==='kamikaze'?"#ff0000":"#34495e", l:25, r: Math.random()*8});
            G.kills++;
            if(G.vamp>0 && G.kills%8===0) G.hp = Math.min(G.maxHp, G.hp+1);
            if(Math.random()<0.25) drops.push({x:e.x, y:e.y, type:'heal'});
            if(e.type==='boss') showUpgrades();
            enemies.splice(i,1);
        }
        if(e.hit>0) e.hit--;
    });

    projectiles.forEach((pr, i) => {
        if(pr.type==='staff' && !pr.enemy) {
            let target = enemies[0];
            if(target) { let ta=Math.atan2(target.y-pr.y, target.x-pr.x); pr.dx+=Math.cos(ta)*1.8; pr.dy+=Math.sin(ta)*1.8; }
        }
        pr.x += pr.dx; pr.y += pr.dy; pr.life--;
        if(!pr.enemy) {
            enemies.forEach(e => {
                if(Math.hypot(pr.x-e.x, pr.y-e.y) < e.r+15) {
                    e.hp -= pr.dmg; e.hit=5;
                    for(let k=0; k<3; k++) particles.push({x:pr.x, y:pr.y, dx:-pr.dx*0.2+(Math.random()-0.5)*5, dy:-pr.dy*0.2+(Math.random()-0.5)*5, c:"#fff", l:10, r:3});
                    if(G.ric>0 && !pr.rd) { pr.dx*=-1; pr.dy*=-1; pr.rd=true; } else projectiles.splice(i,1);
                }
            });
        }
        if(pr.life<=0) projectiles.splice(i,1);
    });

    warns.forEach((w, i) => { w.t--; if(w.t<=0){ projectiles.push({x:w.x, y:w.y-800, dx:0, dy:25, type:'rock', life:100, dmg:2, enemy:true}); warns.splice(i,1); } });
    particles.forEach((pa, i) => { pa.x+=pa.dx; pa.y+=pa.dy; pa.l--; if(pa.l<=0) particles.splice(i,1); });

    let info = "";
    pedestals.forEach((ped, i) => {
        let d = Math.hypot(p.x-ped.x, p.y-ped.y);
        if(d < 180) info = `<b>${G.inv[ped.type].n}</b><br>${G.inv[ped.type].info}`;
        if(d < 70) { G['has'+ped.type.charAt(0).toUpperCase()+ped.type.slice(1)]=true; pedestals.splice(i,1); }
    });
    const tag = document.getElementById('weapon-tag');
    tag.innerHTML = info; tag.style.display = info ? 'block' : 'none';

    drops.forEach((d, i) => {
        if(Math.hypot(p.x-d.x, p.y-d.y) < 70) {
            if(d.type==='heal') G.hp = Math.min(G.maxHp, G.hp+1);
            if(d.type==='full_heal') G.hp = G.maxHp;
            drops.splice(i,1);
        }
    });

    if(enemies.length === 0 && Math.hypot(p.x-G.w/2, p.y) < 120) { G.room++; G.mode='normal'; spawnRoom(); }
    if(G.shake > 0) G.shake *= 0.9;
    if(p.iframe > 0) p.iframe--;
    if(G.hp <= 0 && p.alive) { p.alive = false; document.getElementById('death-screen').style.display='flex'; }
    p.t++;
}

function draw() {
    ctx.fillStyle = "#05050a";
    ctx.fillRect(0,0, canvas.width, canvas.height);
    if(!p.alive) return;

    ctx.save();
    let sx = (Math.random()-0.5)*G.shake;
    let sy = (Math.random()-0.5)*G.shake;
    G.cx += (p.x - canvas.width/2 - G.cx) * 0.1;
    G.cy += (p.y - canvas.height/2 - G.cy) * 0.1;
    ctx.translate(-G.cx + sx, -G.cy + sy);

    // ChÃ£o com IluminaÃ§Ã£o DinÃ¢mica
    ctx.fillStyle = G.mode==='heal'?"#0a2e28":"#0f0c29";
    ctx.fillRect(0,0, G.w, G.h);
    
    // Aura de Luz do Player
    let grad = ctx.createRadialGradient(p.x, p.y, 0, p.
