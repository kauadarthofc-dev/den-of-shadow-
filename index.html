<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Den of Shadow üíÄ Lord of Light</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Nosifer&family=Special+Elite&display=swap');
        
        * { touch-action: none; user-select: none; box-sizing: border-box; outline: none; }
        body { margin: 0; background: #000; color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; }
        canvas { display: block; }

        /* TELAS */
        .ui-screen { 
            position: absolute; inset: 0; 
            background: radial-gradient(circle at center, #4a0404 0%, #000000 100%);
            z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        
        #start-screen h1 { font-family: 'Nosifer', cursive; font-size: clamp(30px, 8vw, 70px); color: #ff0000; text-shadow: 0 0 30px #ff0000; margin: 10px; }
        .btn-main { padding: 15px 50px; font-size: 20px; background: transparent; border: 2px solid #ff0000; color: #fff; cursor: pointer; font-family: 'Orbitron'; margin: 10px; transition: 0.3s; z-index: 3100; }
        .btn-main:hover { background: #ff0000; box-shadow: 0 0 40px #ff0000; }

        .social-links { margin-top: 30px; text-align: center; }
        .social-links a { color: #ff0000; text-decoration: none; font-size: 14px; display: block; margin: 5px; font-family: 'Orbitron'; transition: 0.3s; }
        .social-links a:hover { color: white; text-shadow: 0 0 10px #ff0000; }

        .lang-select { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 4000; }
        .lang-btn { background: rgba(255,0,0,0.2); border: 1px solid #ff0000; color: white; padding: 5px 15px; cursor: pointer; font-family: 'Orbitron'; }
        .lang-btn.active { background: #ff0000; }

        #cutscene-screen { background: #000; cursor: pointer; text-align: center; padding: 40px; display: none; }
        #cutscene-text { font-family: 'Special Elite', cursive; font-size: clamp(18px, 4vw, 26px); color: #ccc; max-width: 800px; line-height: 1.6; }
        .click-hint { position: absolute; bottom: 40px; color: #444; font-size: 12px; animation: blink 1.5s infinite; }

        #hud { position: absolute; top: 20px; left: 20px; z-index: 1000; display: none; flex-direction: column; gap: 8px; }
        .stat-container { background: rgba(0,0,0,0.8); padding: 6px; border-left: 3px solid #ff0000; width: 180px; }
        .bar-bg { width: 100%; height: 6px; background: #222; margin-top: 4px; }
        .bar-fill { height: 100%; transition: width 0.2s; }

        #msg-popup { position: absolute; top: 20%; width: 100%; text-align: center; font-size: 30px; color: #ff0000; text-shadow: 0 0 20px #000; display: none; z-index: 2000; font-family: 'Nosifer'; pointer-events: none; }

        @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
    </style>
</head>
<body>

<div class="lang-select" id="lang-area">
    <button class="lang-btn active" id="btn-pt" onclick="changeLang('pt')">PT</button>
    <button class="lang-btn" id="btn-en" onclick="changeLang('en')">EN</button>
</div>

<div id="start-screen" class="ui-screen">
    <h1>DEN OF SHADOW</h1>
    <p id="subtitle" style="letter-spacing: 5px; color: #ff0000; margin-bottom: 30px;">LORD OF LIGHT</p>
    <button class="btn-main" id="play-btn" onclick="initCutscene()">JOGAR</button>
    
    <div class="social-links">
        <a href="mailto:kauaderthofc@gmail.com">kauaderthofc@gmail.com</a>
        <a href="https://youtube.com/@kaua_darth" target="_blank">YouTube: @kaua_darth</a>
    </div>
</div>

<div id="cutscene-screen" class="ui-screen" onclick="nextHistory()">
    <div id="cutscene-text"></div>
    <div class="click-hint" id="hint-text">CLIQUE PARA CONTINUAR</div>
</div>

<div id="hud">
    <div class="stat-container"><div id="label-hp">VIDA</div><div class="bar-bg"><div id="hp-fill" class="bar-fill" style="width: 100%; background: #ff0000;"></div></div></div>
    <div class="stat-container" style="border-color:#f1c40f;"><div id="label-ammo">MUNI√á√ÉO</div><div class="bar-bg"><div id="ammo-fill" class="bar-fill" style="width: 100%; background: #f1c40f;"></div></div></div>
    <div style="font-weight: bold; color: #ff0000;"><span id="label-room">SALA</span>: <span id="room-txt">0</span></div>
</div>

<div id="msg-popup"></div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// SALA AUMENTADA
const ROOM = { w: 1600, h: 1000, wallSize: 70 };
const G = { 
    play: false, room: 0, hp: 100, ammo: 30, maxAmmo: 30, 
    reloading: false, enemiesDefeated: false, lang: 'pt',
    hasFireWpn: false, lastShot: 0
};

const texts = {
    pt: {
        sub: "LORDE DA LUZ", hp: "VIDA", ammo: "MUNI√á√ÉO", room: "SALA", boss: "GUARDI√ÉO!", weapon: "ARMA DE FOGO LIBERADA!",
        hint: "CLIQUE PARA CONTINUAR",
        history: [
            "No in√≠cio, havia apenas o Vazio... e o Lorde da Luz governava tudo.",
            "Mas ele foi tra√≠do por sua pr√≥pria sombra, que desejava o caos.",
            "Jogado no Den of Shadow, ele perdeu sua majestade e seus poderes.",
            "Agora, preso neste abismo, ele deve lutar para recuperar sua ess√™ncia.",
            "Na Sala 5, uma rel√≠quia antiga o espera... se voc√™ sobreviver.",
            "Tutorial: WASD para mover, SETAS para atirar. Mobile e Console suportados."
        ]
    },
    en: {
        sub: "LORD OF LIGHT", hp: "HEALTH", ammo: "AMMO", room: "ROOM", boss: "GUARDIAN!", weapon: "FIREARM UNLOCKED!",
        hint: "CLICK TO CONTINUE",
        history: [
            "In the beginning, there was only the Void... and the Lord of Light ruled all.",
            "But he was betrayed by his own shadow, who craved chaos.",
            "Thrown into the Den of Shadow, he lost his majesty and powers.",
            "Now, trapped in this abyss, he must fight to reclaim his essence.",
            "In Room 5, an ancient relic awaits you... if you survive.",
            "Tutorial: WASD to move, ARROWS to shoot. Mobile & Console supported."
        ]
    }
};

function changeLang(l) {
    G.lang = l;
    document.getElementById('btn-pt').classList.toggle('active', l === 'pt');
    document.getElementById('btn-en').classList.toggle('active', l === 'en');
    document.getElementById('subtitle').innerText = texts[l].sub;
    document.getElementById('play-btn').innerText = (l === 'pt' ? 'JOGAR' : 'PLAY');
}

let historyIndex = 0;
function initCutscene() {
    document.getElementById('start-screen').style.display='none';
    document.getElementById('lang-area').style.display='none';
    document.getElementById('cutscene-screen').style.display='flex';
    nextHistory();
}

function nextHistory() {
    const h = texts[G.lang].history;
    if (historyIndex < h.length) {
        document.getElementById('cutscene-text').innerText = h[historyIndex++];
    } else {
        startGame();
    }
}

let player = { x: 800, y: 800, r: 25, spd: 8 };
let enemies = [], projectiles = [], drops = [], pedestal = null;
const keys = {};

function startGame() {
    document.getElementById('cutscene-screen').style.display='none';
    document.getElementById('hud').style.display='flex';
    G.play = true;
    initRoom();
}

function initRoom() {
    enemies = []; projectiles = []; drops = []; pedestal = null;
    G.enemiesDefeated = false;
    player.x = ROOM.w / 2;
    player.y = ROOM.h - 150;

    if (G.room > 0) {
        let isBossRoom = G.room % 10 === 0;
        if (isBossRoom) {
            enemies.push({ x: ROOM.w/2, y: 300, hp: 800 + (G.room * 40), r: 90, spd: 2.5, isBoss: true, angle: 0 });
            showPopup(texts[G.lang].boss);
        } else {
            // INIMIGOS MAIS RESISTENTES E EM MAIOR N√öMERO
            let count = 3 + Math.floor(G.room * 0.6);
            for(let i=0; i<count; i++) {
                enemies.push({ 
                    x: Math.random()*(ROOM.w-300)+150, 
                    y: Math.random()*(ROOM.h-500)+150, 
                    hp: 60 + G.room*12, r: 30, 
                    spd: 1.8 + (G.room*0.1),
                    offset: Math.random() * Math.PI * 2 // Para IA de movimento variado
                });
            }
        }
    } else {
        G.enemiesDefeated = true; // Sala 0
    }
}

function showPopup(t) {
    const p = document.getElementById('msg-popup');
    p.innerText = t; p.style.display = 'block';
    setTimeout(() => p.style.display = 'none', 3000);
}

function update() {
    if(!G.play) return;

    // Movimento Player
    let mx = 0, my = 0;
    if(keys['w']) my = -1; if(keys['s']) my = 1; if(keys['a']) mx = -1; if(keys['d']) mx = 1;
    player.x = Math.max(ROOM.wallSize+25, Math.min(ROOM.w-ROOM.wallSize-25, player.x + mx*player.spd));
    player.y = Math.max(ROOM.wallSize+25, Math.min(ROOM.h-ROOM.wallSize-25, player.y + my*player.spd));

    // Tiro
    let ax = 0, ay = 0;
    if(keys['arrowup']) ay = -1; if(keys['arrowdown']) ay = 1; if(keys['arrowleft']) ax = -1; if(keys['arrowright']) ax = 1;
    if((ax || ay) && !G.reloading) {
        if(G.ammo > 0) {
            if(Date.now() - G.lastShot > 170) {
                projectiles.push({ 
                    x: player.x, y: player.y, vx: ax*18, vy: ay*18, r: G.hasFireWpn ? 16 : 9, 
                    dmg: G.hasFireWpn ? 80 : 35, color: G.hasFireWpn ? "#ff4500" : "#fff" 
                });
                G.ammo--; G.lastShot = Date.now();
            }
        } else {
            G.reloading = true;
            setTimeout(() => { G.ammo = G.maxAmmo; G.reloading = false; }, 1100);
        }
    }

    // IA MELHORADA
    enemies.forEach((en) => {
        let dx = player.x - en.x;
        let dy = player.y - en.y;
        let dist = Math.hypot(dx, dy);
        
        // Movimento levemente senoidal para n√£o ser apenas linha reta
        let moveX = (dx/dist);
        let moveY = (dy/dist);
        
        if(!en.isBoss) {
            moveX += Math.cos(Date.now()*0.005 + en.offset) * 0.2;
            moveY += Math.sin(Date.now()*0.005 + en.offset) * 0.2;
        }

        en.x += moveX * en.spd;
        en.y += moveY * en.spd;

        if(dist < player.r + en.r) G.hp -= en.isBoss ? 0.8 : 0.5;
    });

    // Colis√µes Proj√©teis
    projectiles.forEach((p, pi) => {
        p.x += p.vx; p.y += p.vy;
        if(p.x < 0 || p.x > ROOM.w || p.y < 0 || p.y > ROOM.h) projectiles.splice(pi, 1);
        
        enemies.forEach((en, ei) => {
            if(Math.hypot(p.x-en.x, p.y-en.y) < en.r) {
                en.hp -= p.dmg; projectiles.splice(pi, 1);
                if(en.hp <= 0) {
                    if(Math.random() < 0.35) drops.push({x: en.x, y: en.y});
                    enemies.splice(ei, 1);
                }
            }
        });
    });

    // Drops e Pedestal
    drops.forEach((d, i) => {
        if(Math.hypot(player.x-d.x, player.y-d.y) < 50) { G.hp = Math.min(100, G.hp+20); drops.splice(i, 1); }
    });

    if(pedestal && Math.hypot(player.x-pedestal.x, player.y-pedestal.y) < 60) {
        G.hasFireWpn = true; pedestal = null; showPopup(texts[G.lang].weapon);
    }

    // L√ìGICA DE LIMPEZA DE SALA
    if(enemies.length === 0 && !G.enemiesDefeated) {
        G.enemiesDefeated = true;
        // APARECER ARMA NA SALA 5 OU BOSS
        if(G.room === 5 || (G.room % 10 === 0 && G.room !== 0)) {
            pedestal = { x: ROOM.w/2, y: ROOM.h/2 };
        }
    }

    // PORTA NO TOPO
    if(G.enemiesDefeated && player.y < ROOM.wallSize + 30) {
        if(player.x > ROOM.w/2 - 120 && player.x < ROOM.w/2 + 120) {
            G.room++;
            initRoom();
        }
    }

    if(G.hp <= 0) { G.play = false; alert("RECOLHENDO SUA ALMA..."); location.reload(); }
}

function draw() {
    ctx.fillStyle = "#000"; ctx.fillRect(0,0,canvas.width, canvas.height);
    if(!G.play) { requestAnimationFrame(draw); return; }
    update();

    ctx.save();
    let s = Math.min(canvas.width/ROOM.w, canvas.height/ROOM.h)*0.92;
    ctx.translate(canvas.width/2, canvas.height/2); ctx.scale(s,s); ctx.translate(-ROOM.w/2, -ROOM.h/2);

    // Arena
    ctx.fillStyle = "#0d0000"; ctx.fillRect(0,0,ROOM.w,ROOM.h);
    ctx.fillStyle = "#1a0000"; 
    ctx.fillRect(0,0,ROOM.w,ROOM.wallSize); ctx.fillRect(0,ROOM.h-ROOM.wallSize,ROOM.w,ROOM.wallSize);
    ctx.fillRect(0,0,ROOM.wallSize,ROOM.h); ctx.fillRect(ROOM.w-ROOM.wallSize,0,ROOM.wallSize,ROOM.h);

    // Porta
    if(G.enemiesDefeated) {
        ctx.fillStyle = "#ff0000"; ctx.shadowBlur = 30; ctx.shadowColor = "#f00";
        ctx.fillRect(ROOM.w/2-100, 0, 200, ROOM.wallSize + 15);
        ctx.shadowBlur = 0;
    }

    // Pedestal Arma
    if(pedestal) {
        ctx.fillStyle = "#333"; ctx.fillRect(pedestal.x-50, pedestal.y-40, 100, 80);
        ctx.strokeStyle = "#ff4500"; ctx.lineWidth = 3; ctx.strokeRect(pedestal.x-50, pedestal.y-40, 100, 80);
        ctx.fillStyle = "#ff4500"; ctx.font = "45px Arial"; ctx.fillText("üî´", pedestal.x-22, pedestal.y+15);
    }

    // Entidades
    drops.forEach(d => { ctx.fillStyle = "#fff"; ctx.font = "35px Orbitron"; ctx.fillText("‚ûï", d.x-15, d.y+15); });

    enemies.forEach(en => {
        ctx.fillStyle = en.isBoss ? "#660000" : "#ff0000";
        ctx.beginPath(); ctx.arc(en.x, en.y, en.r, 0, Math.PI*2); ctx.fill();
        // Barra HP Inimigo
        let hpPct = en.hp / (en.isBoss ? 800+(G.room*40) : 60+G.room*12);
        ctx.fillStyle = "#222"; ctx.fillRect(en.x-40, en.y-en.r-20, 80, 8);
        ctx.fillStyle = "#f00"; ctx.fillRect(en.x-40, en.y-en.r-20, 80 * hpPct, 8);
    });

    // Player
    ctx.fillStyle = G.reloading ? "#444" : "#fff";
    ctx.beginPath(); ctx.arc(player.x, player.y, player.r, 0, Math.PI*2); ctx.fill();
    if(G.hasFireWpn) { 
        ctx.strokeStyle = "#ff4500"; ctx.lineWidth = 5; ctx.stroke(); 
        ctx.shadowBlur = 15; ctx.shadowColor = "#ff4500";
    }
    
    projectiles.forEach(p => { 
        ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill(); 
    });
    ctx.shadowBlur = 0;

    ctx.restore();
    document.getElementById('hp-fill').style.width = G.hp + "%";
    document.getElementById('ammo-fill').style.width = (G.ammo/G.maxAmmo*100) + "%";
    document.getElementById('room-txt').innerText = G.room;
    requestAnimationFrame(draw);
}

window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => delete keys[e.key.toLowerCase()]);
window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
window.onresize(); draw();
</script>
</body>
</html>
