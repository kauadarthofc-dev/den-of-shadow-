<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Den of Shadow</title>
    <style>
        :root {
            --common: #3498db; --uncommon: #2ecc71; --rare: #f1c40f; 
            --epic: #9b59b6; --legendary: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet);
        }
        body { margin: 0; overflow: hidden; background: #222; font-family: 'Courier New', Courier, monospace; touch-action: none; }
        #gameCanvas { display: block; background: #3d3d3d; border: 4px solid #1a1a1a; margin: auto; }
        
        /* UI Estilizada */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; color: white; }
        .hud { pointer-events: auto; }
        
        #fullscreen-btn { 
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            padding: 10px 20px; background: rgba(0,0,0,0.7); color: gold; border: 2px solid gold; 
            border-radius: 5px; cursor: pointer; pointer-events: auto; z-index: 100;
        }

        /* Bot√µes Mobile Otimizados */
        .mobile-ctrl { 
            position: absolute; bottom: 20px; background: rgba(255,255,255,0.2); 
            border: 3px solid #fff; border-radius: 50%; pointer-events: auto;
        }
        #joystick { width: 120px; height: 120px; left: 30px; }
        #swap-btn { width: 90px; height: 90px; right: 140px; bottom: 40px; background: rgba(255,165,0,0.4); display: flex; align-items: center; justify-content: center; font-weight: bold;}
        #dash-btn { width: 90px; height: 90px; right: 30px; bottom: 140px; background: rgba(0,191,255,0.4); }

        /* Cards de Upgrade */
        #upgrade-screen { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); padding: 20px; display: none; flex-direction: row; gap: 20px;
            border: 5px solid gold; border-radius: 15px; pointer-events: auto;
        }
        .card { 
            width: 180px; height: 260px; border: 3px solid #fff; position: relative;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            padding: 10px; cursor: pointer; transition: 0.3s;
        }
        .card:hover { transform: scale(1.05); }
        .card .bg-skull { position: absolute; font-size: 80px; opacity: 0.1; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none;}
        
        #boss-hp-bar { 
            position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
            width: 60%; height: 20px; background: #333; border: 2px solid #fff; display: none;
        }
        #boss-hp-fill { width: 100%; height: 100%; background: #e74c3c; transition: width 0.3s; }
        #boss-name { text-align: center; color: #ff4757; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }

    </style>
</head>
<body>

    <button id="fullscreen-btn">TELA CHEIA</button>

    <div id="ui-layer">
        <div id="boss-hp-bar" class="hud">
            <div id="boss-name">BOSS</div>
            <div id="boss-hp-fill"></div>
        </div>
        
        <div id="upgrade-screen"></div>

        <div id="joystick" class="mobile-ctrl hud"></div>
        <div id="swap-btn" class="mobile-ctrl hud">SWAP</div>
        <div id="dash-btn" class="mobile-ctrl hud">DASH</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
/** * DEN OF SHADOW - ENGINE PRINCIPAL
 * Suporte: PC/Mobile/Console
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// Configura√ß√£o de Tela
function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// --- ESTADO DO JOGO ---
const Game = {
    title: "DEN OF SHADOW üíÄ",
    author: "kauadarthofc@gmail",
    yt: "@kaua_darth",
    floor: 0,
    room: 0,
    state: 'MENU', // MENU, PLAYING, UPGRADE, GAMEOVER
    minimapOpen: true,
    platform: isMobile ? "MOBILE" : "PC",
    tutorialDone: false
};

// --- PLAYER ---
const player = {
    x: 100, y: 100,
    w: 50, h: 65,
    speed: 5,
    hp: 10, maxHp: 10,
    invincible: false,
    vampirismCount: 0,
    tripleShotLevel: 0,
    ricochet: false,
    dualWield: false,
    weapons: [
        { name: 'Magnum', type: 'pistol', damage: 8, ammo: Infinity, maxAmmo: Infinity, cd: 400, lastFire: 0, color: '#f1c40f' },
        { name: 'Flame Breath', type: 'flamethrower', damage: 6, burn: 2, ammo: 25, maxAmmo: 25, cd: 80, lastFire: 0, color: '#e67e22' }
    ],
    currentWeaponIndex: 0,
    velX: 0, velY: 0,
    angle: 0,
    animFrame: 0,
    isDead: false
};

// --- INPUTS ---
const keys = {};
let mouse = { x: 0, y: 0, down: false };
window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;
canvas.onmousemove = e => { mouse.x = e.clientX; mouse.y = e.clientY; };
canvas.onmousedown = () => mouse.down = true;
canvas.onmouseup = () => mouse.down = false;

// Swap Weapon Fix
document.getElementById('swap-btn').onclick = () => {
    player.currentWeaponIndex = (player.currentWeaponIndex + 1) % player.weapons.length;
};

// --- SISTEMA DE SALAS E MAPA ---
let enemies = [];
let projectiles = [];
let particles = [];
let drops = [];
let doors = [];
let currentBoss = null;

class Enemy {
    constructor(x, y, type) {
        this.x = x; this.y = y;
        this.type = type;
        this.w = 55; this.h = 55;
        this.hp = type === 'kamikaze' ? 5 : 15;
        this.speed = type === 'kamikaze' ? 1.5 : 2;
        this.color = type === 'kamikaze' ? '#ff4d4d' : '#2ecc71';
        this.face = Math.floor(Math.random() * 3);
        this.dashCooldown = 0;
    }

    update() {
        // Evitar sobreposi√ß√£o de inimigos
        enemies.forEach(other => {
            if(other === this) return;
            let dx = this.x - other.x;
            let dy = this.y - other.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            if(dist < 50) {
                this.x += dx/dist * 2;
                this.y += dy/dist * 2;
            }
        });

        // Movimento
        let dx = player.x - this.x;
        let dy = player.y - this.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        
        if (this.type === 'dasher' && dist < 300 && this.dashCooldown <= 0) {
            this.speed = 12;
            this.dashCooldown = 100;
        } else {
            this.speed = this.type === 'kamikaze' ? 1.5 : 2.5;
            if(this.dashCooldown > 0) this.dashCooldown--;
        }

        this.x += (dx/dist) * this.speed;
        this.y += (dy/dist) * this.speed;

        // Dano no player
        if (dist < 40 && !player.invincible) {
            takeDamage(this.type === 'kamikaze' ? 2 : 1);
            // Knockback
            player.x += (dx/dist) * 20;
            player.y += (dy/dist) * 20;
            if(this.type === 'kamikaze') this.die();
        }
    }

    die() {
        if(this.type === 'kamikaze') {
            // Explos√£o d√° dano em inimigos pr√≥ximos
            enemies.forEach(e => {
                let d = Math.hypot(this.x - e.x, this.y - e.y);
                if(d < 120) e.hp -= 10;
            });
            createExplosion(this.x, this.y, '#f39c12');
        }
        this.hp = 0;
        if(Math.random() < 0.15) spawnDrop(this.x, this.y);
        
        player.vampirismCount++;
        if(player.vampirismCount >= 10) {
            player.hp = Math.min(player.maxHp, player.hp + 1);
            player.vampirismCount = 0;
        }
    }

    draw() {
        ctx.fillStyle = this.color;
        if(this.type === 'kamikaze') ctx.strokeStyle = 'red', ctx.lineWidth = 3;
        ctx.fillRect(this.x - this.w/2, this.y - this.h/2, this.w, this.h);
        if(this.type === 'kamikaze') ctx.strokeRect(this.x - this.w/2, this.y - this.h/2, this.w, this.h);
        
        // Rostos Variados
        ctx.fillStyle = "white";
        ctx.fillRect(this.x - 15, this.y - 15, 8, 8);
        ctx.fillRect(this.x + 7, this.y - 15, 8, 8);
        ctx.fillStyle = "black";
        ctx.fillRect(this.x - 10, this.y + 5, 20, 5);
    }
}

// --- LOOP PRINCIPAL ---
function update() {
    if (Game.state === 'PLAYING') {
        // Movimenta√ß√£o Player
        let moveX = 0, moveY = 0;
        if(keys['KeyW']) moveY = -1;
        if(keys['KeyS']) moveY = 1;
        if(keys['KeyA']) moveX = -1;
        if(keys['KeyD']) moveX = 1;
        
        player.x += moveX * player.speed;
        player.y += moveY * player.speed;

        // Limite do mapa (impedir sair)
        player.x = Math.max(50, Math.min(canvas.width - 50, player.x));
        player.y = Math.max(50, Math.min(canvas.height - 50, player.y));

        // Mira (Prioridade para tiro)
        if(isMobile) {
            // No mobile a dire√ß√£o √© baseada no movimento se n√£o houver toque de ataque
            if(moveX !== 0 || moveY !== 0) player.angle = Math.atan2(moveY, moveX);
        } else {
            player.angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
        }

        // Ataque
        let wp = player.weapons[player.currentWeaponIndex];
        if ((mouse.down || isMobile) && Date.now() - wp.lastFire > wp.cd) {
            fireWeapon(wp);
            wp.lastFire = Date.now();
        }

        // Atualizar Entidades
        enemies.forEach((e, i) => {
            e.update();
            if(e.hp <= 0) enemies.splice(i, 1);
        });

        projectiles.forEach((p, i) => {
            p.x += Math.cos(p.angle) * p.speed;
            p.y += Math.sin(p.angle) * p.speed;
            
            // Colis√£o Inimigo
            enemies.forEach(e => {
                if(Math.hypot(p.x - e.x, p.y - e.y) < 30) {
                    e.hp -= p.damage;
                    if(p.burn) e.hp -= p.burn; // Dano extra fogo
                    projectiles.splice(i, 1);
                }
            });

            if(p.x < 0 || p.x > canvas.width || p.y < 0 || p.y > canvas.height) projectiles.splice(i, 1);
        });
        
        // Checar Vit√≥ria da Sala
        if(enemies.length === 0 && Game.room > 0) {
            // Abrir portas
        }
    }
}

function draw() {
    // Fundo Profissional
    ctx.fillStyle = "#3d3d3d";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Grid do Ch√£o
    ctx.strokeStyle = "#4a4a4a";
    for(let i=0; i<canvas.width; i+=50) {
        ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i, canvas.height); ctx.stroke();
    }
    for(let i=0; i<canvas.height; i+=50) {
        ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width, i); ctx.stroke();
    }

    if (Game.state === 'MENU') {
        drawMenu();
    } else {
        // Desenhar Player (Lord da Luz com perninhas)
        drawPlayer();

        enemies.forEach(e => e.draw());
        projectiles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size || 5, 0, Math.PI*2);
            ctx.fill();
        });

        drawUI();
        if(Game.minimapOpen) drawMinimap();
    }
    
    requestAnimationFrame(() => {
        update();
        draw();
    });
}

function drawPlayer() {
    ctx.save();
    ctx.translate(player.x, player.y);
    
    // Perninhas fofas
    player.animFrame += 0.15;
    let legY = Math.sin(player.animFrame) * 5;
    ctx.fillStyle = "#fff";
    ctx.fillRect(-15, 20 + legY, 8, 12);
    ctx.fillRect(7, 20 - legY, 8, 12);

    // Corpo Lord da Luz
    ctx.fillStyle = "white";
    ctx.shadowBlur = 15;
    ctx.shadowColor = "cyan";
    ctx.fillRect(-20, -30, 40, 55);
    
    // Rosto
    ctx.fillStyle = "black";
    ctx.fillRect(-10, -15, 5, 5);
    ctx.fillRect(5, -15, 5, 5);
    
    // Arma apontando para a mira
    ctx.rotate(player.angle);
    ctx.fillStyle = "#7f8c8d";
    ctx.fillRect(20, -5, 30, 10);
    
    ctx.restore();
}

function drawMenu() {
    ctx.fillStyle = "rgba(0,0,0,0.8)";
    ctx.fillRect(0,0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    ctx.font = "60px Georgia";
    ctx.textAlign = "center";
    ctx.fillText("DEN OF SHADOW üíÄ", canvas.width/2, canvas.height/2 - 50);
    
    ctx.font = "20px Arial";
    ctx.fillText("kauadarthofc@gmail.com | YouTube: @kaua_darth", canvas.width/2, canvas.height - 50);
    ctx.fillText("Plataforma Detectada: " + Game.platform, canvas.width/2, canvas.height/2 + 20);
    ctx.fillText(Game.platform === "PC" ? "Clique para Iniciar [WASD + Mouse]" : "Toque para Iniciar", canvas.width/2, canvas.height/2 + 60);
}

function drawMinimap() {
    let size = 150;
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(canvas.width - size - 20, 20, size, size);
    ctx.strokeStyle = "white";
    ctx.strokeRect(canvas.width - size - 20, 20, size, size);
    
    // Player no minimapa
    ctx.fillStyle = "cyan";
    ctx.fillRect(canvas.width - size/2 - 25, 20 + size/2 - 5, 5, 5);
    
    // Inimigos no minimapa
    ctx.fillStyle = "red";
    enemies.forEach(e => {
        let relX = (e.x / canvas.width) * size;
        let relY = (e.y / canvas.height) * size;
        ctx.fillRect(canvas.width - size - 20 + relX, 20 + relY, 3, 3);
    });
}

function fireWeapon(wp) {
    if(wp.ammo <= 0 && wp.maxAmmo !== Infinity) return;
    
    let speed = 10;
    let damage = wp.damage;
    
    if(wp.type === 'flamethrower') {
        // Baforada (V√°rios proj√©teis curtos)
        for(let i=0; i<5; i++) {
            projectiles.push({
                x: player.x, y: player.y,
                angle: player.angle + (Math.random()-0.5)*0.4,
                speed: 7 + Math.random()*3,
                damage: 4, burn: 2,
                color: 'orange', size: 8
            });
        }
        wp.ammo--;
    } else if(wp.type === 'shotgun') {
        for(let i=0; i<3; i++) {
            projectiles.push({
                x: player.x, y: player.y,
                angle: player.angle + (i-1)*0.2,
                speed: 12, damage: 17, color: 'silver'
            });
        }
    } else {
        projectiles.push({
            x: player.x, y: player.y,
            angle: player.angle,
            speed: 15, damage: damage, color: wp.color
        });
    }
}

function takeDamage(amt) {
    if(player.isDead) return;
    player.hp -= amt;
    player.invincible = true;
    setTimeout(() => player.invincible = false, 1000);
    if(player.hp <= 0) {
        player.isDead = true;
        alert("GAME OVER! A escurid√£o te consumiu.");
        location.reload();
    }
}

// Inicializa√ß√£o
canvas.onclick = () => {
    if(Game.state === 'MENU') {
        Game.state = 'PLAYING';
        startRoom();
    }
};

function startRoom() {
    enemies = [];
    let count = 3 + Game.room;
    for(let i=0; i<count; i++) {
        let ex = Math.random() < 0.5 ? 100 : canvas.width - 100;
        let ey = Math.random() * canvas.height;
        enemies.push(new Enemy(ex, ey, Math.random() > 0.7 ? 'dasher' : 'kamikaze'));
    }
}

function createExplosion(x, y, color) {
    for(let i=0; i<20; i++) {
        particles.push({x, y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, life: 30, color});
    }
}

function drawUI() {
    ctx.fillStyle = "white";
    ctx.font = "20px Arial";
    ctx.fillText(`HP: ${player.hp} | Sala: ${Game.room} | Arma: ${player.weapons[player.currentWeaponIndex].name}`, 20, 30);
}

// Bot√£o Fullscreen
document.getElementById('fullscreen-btn').addEventListener('click', () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
});

</script>
</body>
</html>
