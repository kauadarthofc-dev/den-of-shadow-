<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Capivaras vs Estudantes - Final</title>
    <style>
        body {
            background: #121212;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            overflow: hidden;
        }

        #ui { padding: 20px; text-align: center; }
        .money { color: #2ecc71; font-size: 28px; font-weight: bold; }

        #game-container {
            display: flex;
            gap: 15px;
            background: #252525;
            padding: 15px;
            border-radius: 15px;
            border: 4px solid #444;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* √Årea de Invent√°rio (Merge) */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 85px);
            gap: 10px;
        }

        /* Slots de Defesa */
        #defense-slots {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            background: #333;
            padding: 10px;
            border-radius: 10px;
            border-right: 4px dashed #555;
        }

        /* Campo de Batalha */
        #battlefield {
            width: 450px;
            height: 300px;
            background: #1a1a1a;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 100% 100px;
        }

        .slot {
            width: 85px;
            height: 85px;
            background: #2a2a2a;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid transparent;
        }

        /* Estiliza√ß√£o dos Sprites */
        .sprite {
            width: 75px;
            height: 75px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            image-rendering: pixelated;
            cursor: grab;
            position: relative;
        }

        .student {
            position: absolute;
            width: 65px;
            height: 65px;
            right: -80px;
            background-size: contain;
            background-repeat: no-repeat;
            transition: right 0.1s linear;
        }

        .bullet {
            position: absolute;
            width: 14px;
            height: 7px;
            background: #f1c40f;
            border-radius: 4px;
            box-shadow: 0 0 10px #f39c12;
        }

        #buy-btn {
            margin-top: 25px;
            padding: 15px 50px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px #1e8449;
        }
        #buy-btn:active { transform: translateY(3px); box-shadow: 0 2px #1e8449; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="money">üí∞ Moedas: <span id="coin-val">100</span></div>
        <p>Arraste a capivara para o slot de defesa para atirar!</p>
    </div>

    <div id="game-container">
        <div class="grid" id="inventory">
            <div class="slot merge-slot"></div><div class="slot merge-slot"></div><div class="slot merge-slot"></div>
            <div class="slot merge-slot"></div><div class="slot merge-slot"></div><div class="slot merge-slot"></div>
            <div class="slot merge-slot"></div><div class="slot merge-slot"></div><div class="slot merge-slot"></div>
        </div>

        <div id="defense-slots">
            <div class="slot def-slot" data-row="0"></div>
            <div class="slot def-slot" data-row="1"></div>
            <div class="slot def-slot" data-row="2"></div>
        </div>

        <div id="battlefield"></div>
    </div>

    <button id="buy-btn">NOVA CAPIVARA (20üí∞)</button>

    <script>
        // Imagens embutidas para garantir que NUNCA fiquem sem foto
        const IMAGES = {
            capis: [
                'https://cdn-icons-png.flaticon.com/512/9616/9616990.png', // Lvl 1
                'https://cdn-icons-png.flaticon.com/512/9617/9617013.png', // Lvl 2
                'https://cdn-icons-png.flaticon.com/512/9617/9617028.png'  // Lvl 3
            ],
            student: 'https://cdn-icons-png.flaticon.com/512/3468/3468192.png'
        };

        let coins = 100;
        let dragged = null;

        function createCapi(lvl) {
            const div = document.createElement('div');
            div.className = 'sprite';
            div.style.backgroundImage = `url('${IMAGES.capis[lvl]}')`;
            div.dataset.lvl = lvl;
            div.dataset.lastShot = 0;
            div.draggable = true;
            div.ondragstart = () => { dragged = div; };
            return div;
        }

        document.querySelectorAll('.slot').forEach(slot => {
            slot.ondragover = e => e.preventDefault();
            slot.ondrop = () => {
                if (!slot.hasChildNodes()) {
                    slot.appendChild(dragged);
                } else {
                    const target = slot.firstChild;
                    if (target.dataset.lvl == dragged.dataset.lvl && target.dataset.lvl < 2) {
                        const newLvl = parseInt(target.dataset.lvl) + 1;
                        target.remove();
                        dragged.remove();
                        slot.appendChild(createCapi(newLvl));
                    }
                }
            };
        });

        document.getElementById('buy-btn').onclick = () => {
            if (coins >= 20) {
                const empty = Array.from(document.querySelectorAll('.merge-slot')).find(s => !s.hasChildNodes());
                if (empty) {
                    coins -= 20;
                    empty.appendChild(createCapi(0));
                    document.getElementById('coin-val').innerText = coins;
                }
            }
        };

        function spawnStudent() {
            const row = Math.floor(Math.random() * 3);
            const st = document.createElement('div');
            st.className = 'student';
            st.style.backgroundImage = `url('${IMAGES.student}')`;
            st.dataset.hp = 100;
            st.dataset.row = row;
            st.style.top = (row * 100 + 15) + 'px';
            document.getElementById('battlefield').appendChild(st);
        }

        // Loop principal
        setInterval(() => {
            // Mover estudantes
            document.querySelectorAll('.student').forEach(st => {
                let r = parseFloat(st.style.right) || -80;
                st.style.right = (r + 1.5) + 'px';
                if (r > 450) st.remove();
            });

            // Atirar com cad√™ncia equilibrada
            const now = Date.now();
            document.querySelectorAll('.def-slot').forEach(slot => {
                if (slot.hasChildNodes()) {
                    const capi = slot.firstChild;
                    const cooldown = 1500 - (capi.dataset.lvl * 300); // 1.5s, 1.2s ou 0.9s
                    
                    if (now - capi.dataset.lastShot > cooldown) {
                        const target = Array.from(document.querySelectorAll('.student'))
                                            .find(s => s.dataset.row == slot.dataset.row);
                        if (target) {
                            shoot(slot, target, (parseInt(capi.dataset.lvl) + 1) * 35);
                            capi.dataset.lastShot = now;
                        }
                    }
                }
            });

            if (Math.random() > 0.98) spawnStudent();
        }, 50);

        function shoot(slot, target, dmg) {
            const b = document.createElement('div');
            b.className = 'bullet';
            b.style.top = (slot.dataset.row * 100 + 50) + 'px';
            b.style.left = '0px';
            document.getElementById('battlefield').appendChild(b);

            let pos = 0;
            const bInt = setInterval(() => {
                pos += 10;
                b.style.left = pos + 'px';
                const tPos = 450 - parseFloat(target.style.right);
                
                if (pos >= tPos - 30) {
                    clearInterval(bInt);
                    b.remove();
                    target.dataset.hp -= dmg;
                    if (target.dataset.hp <= 0) {
                        target.remove();
                        coins += 15;
                        document.getElementById('coin-val').innerText = coins;
                    }
                }
                if (pos > 450) { clearInterval(bInt); b.remove(); }
            }, 20);
        }
    </script>
</body>
</html>
