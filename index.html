<!DOCTYPE html>

<html lang="pt-br">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <title>Den of Shadow üíÄ King's Blade Update</title>

    <style>

        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Nosifer&family=Special+Elite&display=swap');

        

        * { touch-action: none; user-select: none; box-sizing: border-box; outline: none; }

        body { margin: 0; background: #000; color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; }

        canvas { display: block; }



        .ui-screen { 

            position: absolute; inset: 0; 

            background: radial-gradient(circle at center, #4a0404 0%, #000000 100%);

            z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; 

        }

        

        #start-screen h1 { font-family: 'Nosifer', cursive; font-size: clamp(30px, 8vw, 70px); color: #ff0000; text-shadow: 0 0 30px #ff0000; }

        .btn-main { padding: 15px 50px; font-size: 20px; background: transparent; border: 2px solid #ff0000; color: #fff; cursor: pointer; font-family: 'Orbitron'; margin: 10px; transition: 0.3s; }

        .btn-main:hover { background: #ff0000; box-shadow: 0 0 40px #ff0000; }



        #hud { position: absolute; top: 20px; left: 20px; z-index: 1000; display: none; flex-direction: column; gap: 8px; }

        .stat-container { background: rgba(0,0,0,0.8); padding: 6px; border-left: 3px solid #ff0000; width: 220px; }

        .bar-bg { width: 100%; height: 8px; background: #222; margin-top: 4px; border-radius: 4px; overflow: hidden; }

        .bar-fill { height: 100%; transition: width 0.2s; }



        #weapon-ui { position: absolute; bottom: 20px; left: 20px; z-index: 1000; display: none; background: rgba(0,0,0,0.7); padding: 10px; border: 1px solid #ff0000; }

        #msg-popup { position: absolute; bottom: 120px; width: 100%; text-align: center; font-size: 24px; color: #f1c40f; text-shadow: 0 0 10px #000; display: none; z-index: 2000; pointer-events: none; }

    </style>

</head>

<body>



<div id="start-screen" class="ui-screen">

    <h1>DEN OF SHADOW</h1>

    <p id="subtitle" style="letter-spacing: 5px; color: #ff0000; margin-bottom: 30px;">LORD OF LIGHT</p>

    <button class="btn-main" onclick="startGame()">JOGAR</button>

</div>



<div id="hud">

    <div class="stat-container">VIDA<div class="bar-bg"><div id="hp-fill" class="bar-fill" style="width: 100%; background: #ff0000;"></div></div></div>

    <div class="stat-container" style="border-color:#f1c40f;">ENERGIA/MUNI√á√ÉO<div class="bar-bg"><div id="ammo-fill" class="bar-fill" style="width: 100%; background: #f1c40f;"></div></div></div>

    <div style="font-weight: bold; color: #ff0000;">SALA: <span id="room-txt">0</span></div>

</div>



<div id="weapon-ui">

    EQUIPADO: <span id="wpn-name" style="color: #fff;">MAGIA B√ÅSICA</span><br>

    <small style="opacity: 0.6;">[Q] TROCAR ARMA</small>

</div>



<div id="msg-popup"></div>

<canvas id="gameCanvas"></canvas>



<script>

const canvas = document.getElementById('gameCanvas');

const ctx = canvas.getContext('2d');



// Configura√ß√µes do Mundo (Expandido para a c√¢mera funcionar)

const WORLD = { w: 3000, h: 3000 }; 

const G = { 

    play: false, room: 1, hp: 100, ammo: 20, maxAmmo: 20, 

    reloading: false, lastShot: 0,

    curWpn: 0, // 0: Magia, 1: Espada

    unlockedWeapons: [0, 1],

    weapons: [

        { name: "MAGIA B√ÅSICA", type: "range", color: "#fff", dmg: 25, rate: 200 },

        { name: "ESPADA DO REI", type: "melee", color: "#9932CC", dmg: 80, rate: 400 }

    ]

};



let player = { x: 1500, y: 1500, r: 25, spd: 7, angle: 0 };

let enemies = [], projectiles = [], visuals = [], doors = [];



function showPopup(t) { 

    const p = document.getElementById('msg-popup'); 

    p.innerText = t; p.style.display = 'block'; 

    setTimeout(() => p.style.display = 'none', 3000); 

}



function startGame() {

    document.getElementById('start-screen').style.display='none';

    document.getElementById('hud').style.display='flex';

    document.getElementById('weapon-ui').style.display='block';

    G.play = true;

    initRoom();

}



function initRoom() {

    enemies = []; projectiles = []; visuals = []; doors = [];

    player.x = WORLD.w / 2; player.y = WORLD.h / 2;

    

    // Spawn de inimigos ao redor

    let count = 5 + G.room;

    for(let i=0; i<count; i++) {

        enemies.push({

            x: Math.random() * WORLD.w,

            y: Math.random() * WORLD.h,

            hp: 50 + G.room*10, r: 30, spd: 2 + (G.room*0.1),

            isBoss: G.room % 10 === 0 && i === 0

        });

    }

}



function swapWeapon() {

    G.curWpn = (G.curWpn + 1) % G.unlockedWeapons.length;

    const w = G.weapons[G.curWpn];

    document.getElementById('wpn-name').innerText = w.name;

    document.getElementById('wpn-name').style.color = w.color;

}



function update() {

    if(!G.play) return;



    // Movimento

    let mx = 0, my = 0;

    if(keys['w']) my = -1; if(keys['s']) my = 1; if(keys['a']) mx = -1; if(keys['d']) mx = 1;

    player.x += mx * player.spd;

    player.y += my * player.spd;



    // Ataque

    let ax = 0, ay = 0;

    if(keys['arrowup']) ay = -1; if(keys['arrowdown']) ay = 1; if(keys['arrowleft']) mx = -1; if(keys['arrowright']) mx = 1;

    // Mouse ou Teclado para dire√ß√£o

    if(ax !== 0 || ay !== 0) player.angle = Math.atan2(ay, ax);



    if((keys['arrowup'] || keys['arrowdown'] || keys['arrowleft'] || keys['arrowright'] || keys[' '])) {

        const w = G.weapons[G.curWpn];

        if(Date.now() - G.lastShot > w.rate) {

            if(w.type === "range" && G.ammo > 0) {

                let dirX = keys['arrowright'] ? 1 : keys['arrowleft'] ? -1 : 0;

                let dirY = keys['arrowdown'] ? 1 : keys['arrowup'] ? -1 : 0;

                if(dirX === 0 && dirY === 0) dirY = -1; // Tiro padr√£o para cima



                projectiles.push({ x: player.x, y: player.y, vx: dirX*15, vy: dirY*15, r: 8, color: w.color, dmg: w.dmg });

                G.ammo--;

            } else if(w.type === "melee") {

                // Efeito Visual da Espada

                visuals.push({ type: 'slash', x: player.x, y: player.y, angle: player.angle, life: 10, color: w.color });

                // Dano Melee

                enemies.forEach(en => {

                    let d = Math.hypot(en.x - player.x, en.y - player.y);

                    if(d < 120) { 

                        en.hp -= w.dmg;

                        en.x += Math.cos(Math.atan2(en.y-player.y, en.x-player.x)) * 40; // Empurr√£o

                    }

                });

            }

            G.lastShot = Date.now();

        }

    }



    // Reload passivo

    if(G.ammo < G.maxAmmo) G.ammo += 0.05;



    // Inimigos

    enemies.forEach((en, i) => {

        let ang = Math.atan2(player.y - en.y, player.x - en.x);

        en.x += Math.cos(ang) * en.spd; en.y += Math.sin(ang) * en.spd;

        if(Math.hypot(player.x-en.x, player.y-en.y) < player.r + en.r) G.hp -= 0.3;

        

        if(en.hp <= 0) enemies.splice(i, 1);

    });



    // Proj√©teis

    projectiles.forEach((p, i) => {

        p.x += p.vx; p.y += p.vy;

        enemies.forEach(en => {

            if(Math.hypot(p.x-en.x, p.y-en.y) < en.r) { en.hp -= p.dmg; projectiles.splice(i, 1); }

        });

    });



    if(G.hp <= 0) location.reload();

}



function draw() {

    canvas.width = window.innerWidth;

    canvas.height = window.innerHeight;

    ctx.clearRect(0,0,canvas.width, canvas.height);

    

    if(!G.play) { requestAnimationFrame(draw); return; }

    update();



    // CENTRALIZA√á√ÉO DA C√ÇMERA

    ctx.save();

    ctx.translate(canvas.width/2 - player.x, canvas.height/2 - player.y);



    // Ch√£o/Grid

    ctx.strokeStyle = "#1a0000"; ctx.lineWidth = 2;

    for(let i=0; i<WORLD.w; i+=100) {

        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, WORLD.h); ctx.stroke();

        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(WORLD.w, i); ctx.stroke();

    }



    // Inimigos

    enemies.forEach(en => {

        ctx.fillStyle = en.isBoss ? "#8b0000" : "#ff0000";

        ctx.beginPath(); ctx.arc(en.x, en.y, en.r, 0, Math.PI*2); ctx.fill();

        // Barra de vida simples

        ctx.fillStyle = "red"; ctx.fillRect(en.x-30, en.y-en.r-10, 60, 5);

        ctx.fillStyle = "green"; ctx.fillRect(en.x-30, en.y-en.r-10, 60 * (en.hp/(50+G.room*10)), 5);

    });



    // Visuais (Espada)

    visuals.forEach((v, i) => {

        ctx.strokeStyle = v.color; ctx.lineWidth = 10;

        ctx.beginPath(); ctx.arc(v.x, v.y, 80, player.angle-1, player.angle+1); ctx.stroke();

        v.life--; if(v.life <= 0) visuals.splice(i, 1);

    });



    // Player

    ctx.fillStyle = "#fff";

    ctx.beginPath(); ctx.arc(player.x, player.y, player.r, 0, Math.PI*2); ctx.fill();

    

    // Proj√©teis

    projectiles.forEach(p => { ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill(); });



    ctx.restore();



    // UI

    document.getElementById('hp-fill').style.width = G.hp + "%";

    document.getElementById('ammo-fill').style.width = (G.ammo/G.maxAmmo*100) + "%";

    document.getElementById('room-txt').innerText = G.room;



    requestAnimationFrame(draw);

}



const keys = {};

window.addEventListener('keydown', e => {

    keys[e.key.toLowerCase()] = true;

    if(e.key.toLowerCase() === 'q') swapWeapon();

});

window.addEventListener('keyup', e => delete keys[e.key.toLowerCase()]);



draw();

</script>

</body>

</html>
